define("core/utils/getEmbeddedData",[],function(){"use strict";return function(e){var t=window.document.getElementById("disqus-"+e);try{return t&&JSON.parse(t.textContent||t.innerHTML)}catch(n){return null}}}),define("core/utils/cookies",["underscore"],function(e){"use strict";var t=window.document,n={create:function(n,i,s){s||(s={});var a=n+"="+i+"; path="+(s.path||"/"),r=s.domain,o=s.expiresIn;if(r&&(a+="; domain=."+r),e.isNumber(o)){var l=new Date((new Date).getTime()+o);a+="; expires="+l.toGMTString()}"https:"===t.location.protocol&&(a+="; secure"),t.cookie=a},read:function(e){for(var n,i=e+"=",s=t.cookie.split(";"),a=0;a<s.length;a++)if(n=s[a].replace(/^\s+/,""),0===n.indexOf(i))return n.substring(i.length);return null},erase:function(t,i){return n.create(t,"",e.extend({},i,{expiresIn:-1}))}};return n}),define("core/utils/fingerprint",[],function(){"use strict";function e(e){e=e||{};var t=e.Math||window.Math,n=e.Date||window.Date;try{var i=(new n).getTimezoneOffset(),s=1,a=window.screen;a&&a.availWidth?s=a.availWidth*a.availHeight+a.colorDepth:a&&a.width&&(s=a.width*a.height);var r=window.document.documentElement,o=r.clientWidth*r.clientHeight;return t.abs(17*i+25*s-o)}catch(l){return 1}}return{get:e}}),define("core/utils/guid",["core/utils/fingerprint"],function(e){"use strict";function t(e){e=e||{};var t=e.Uint32Array||window.Uint32Array,n=e.crypto||window.crypto,i=e.Math||window.Math;try{var s=new t(1);return n.getRandomValues(s),s[0]}catch(a){return i.floor(1e9*i.random())}}function n(){var e=window.performance,t=e&&e.timing;if(!t)return 1e5;var n=t.domainLookupEnd-t.domainLookupStart,i=t.connectEnd-t.connectStart,s=t.responseStart-t.navigationStart;return 11*n+13*i+17*s}function i(i){i=i||{};var s=i.Math||window.Math,a=Number((new Date).getTime().toString().substring(3)),r=s.abs(a+n()-e.get()).toString(32);return r+=t(i).toString(32)}return{generate:i}}),define("core/utils/hash",[],function(){"use strict";var e=function(e){var t,n,i,s=0;if(0===e.length)return s;for(t=0,n=e.length;n>t;t++)i=e.charCodeAt(t),s=(s<<5)-s+i,s|=0;return s};return{calculate:e}}),define("core/analytics/identity",["exports","core/utils/cookies","core/utils/guid","core/utils/hash","core/utils/fingerprint"],function(e,t,n,i,s){"use strict";var a=e.ImpressionManager=function(){this.prevImp=t.read(this.COOKIE_NAME),this.setImpressionId(n.generate())};a.prototype.COOKIE_NAME="__jid",a.prototype.TTL=18e5,a.prototype.setImpressionId=function(e){this.impId=e,this.persist()},a.prototype.persist=function(){t.create(this.COOKIE_NAME,this.impId,{expiresIn:this.TTL})},e.impression=new a;var r=e.UniqueManager=function(){var e=t.read(this.COOKIE_NAME)||n.generate();t.create(this.COOKIE_NAME,e,{domain:window.location.host.split(":")[0],expiresIn:this.TTL}),this.value=e};r.prototype.COOKIE_NAME="disqus_unique",r.prototype.TTL=31536e6,r.prototype.isPersistent=function(){return t.read(this.COOKIE_NAME)===this.value},e.unique=new r,e.clientId=function(){var t,n=e.unique;return n.isPersistent()&&(t=n.value),t||s.get().toString()},e.getPercentBucketForString=function(e){return Math.abs(i.calculate(e)%100)},e.clientPercent=function(){return e.getPercentBucketForString(e.clientId())}}),define("core/config/urls",["common/urls"],function(e){"use strict";return e}),define("core/analytics/jester",["jquery","underscore","backbone","core/analytics/identity","core/config/urls"],function(e,t,n,i,s){"use strict";var a=n.Model.extend({url:s.jester+"/event.js",defaults:{experiment:"default",variant:"control"},setHostReferrer:function(e){if(e){if(-1===e.indexOf("http"))return;this.set("page_referrer",e)}else this.set("page_referrer","direct")},decoratePayload:function(n){n.event||(n.event="activity"),n=t.extend(this.toJSON(),n),t.extend(n,{imp:i.impression.impId,prev_imp:i.impression.prevImp}),n.section||(n.section="default"),n.area||(n.area="n/a");var s=e.param(n).length;if(s>2048&&this.has("page_referrer")){var a=window.document.createElement("a");a.href=this.get("page_referrer");var r=a.hostname;r&&(n.page_referrer_domain=r),delete n.page_referrer}return n},emit:function(n){return e.ajax({url:t.result(this,"url"),data:this.decoratePayload(n),dataType:"script",cache:!0})}}),r=function(t){var n=new window.Image;return n.src=s.jester+"/stat.gif?"+e.param({event:t}),n},o=function(n,i){if(!t.any(i,function(e){return 0>e})){t.each(i,function(e,t){i[t]=Math.round(e)});var a=new window.Image;return a.src=s.jester+"/telemetry/"+n+".gif?"+e.param(i),a}},l=new a;return l.setHostReferrer(window.document.referrer),{ActivityClient:a,client:l,logStat:r,telemetry:o}}),define("core/utils/urls",[],function(){"use strict";var e={},t=window.document.createElement("a");return e.getOrigin=function(e){t.href=e;var n=t.href.split("/");return n[0]+"//"+n[2]},e.getHostName=function(e){return t.href=e,t.hostname},e.getDomainPart=function(t,n){"undefined"==typeof n&&(n=0);var i=e.getHostName(t),s=i.split(".").reverse();return s[n]},e.getQuery=function(e){return t.href=e,t.search},e.getPathname=function(e){return t.href=e,t.pathname},e}),define("core/frameBus",["jquery","underscore","backbone","core/utils/urls"],function(e,t,n,i){"use strict";var s=window.opener||window.parent,a=window.name,r=window.document.referrer,o={};o.client=i.getOrigin(window.document.location.href),o.secureClient=o.client.replace(/^\w+:\/\//,"https://"),o.host=r?i.getOrigin(r):o.client;var l={origins:o,messageHandler:function(e){e=e.originalEvent;var t;try{t=JSON.parse(e.data)}catch(n){return}t.name&&"!"===t.name[0]&&e.origin!==o.client&&e.origin!==o.secureClient||"client"===t.scope&&l.trigger(t.name,t.data)},postMessage:function(e){e=JSON.stringify(e),s.postMessage(e,"*")},sendHostMessage:function(e,t){t=t||[],l.postMessage({scope:"host",sender:a,name:e,data:t})}};return t.extend(l,n.Events),e(window).on("message",l.messageHandler),e(window).on("unload",function(){l.sendHostMessage("die")}),window.DISQUS=window.DISQUS||{},window.DISQUS.Bus=l,l}),define("core/bus",["backbone","underscore","core/frameBus"],function(e,t,n){"use strict";var i=t.extend({},e.Events);return i.frame=n,i}),define("core/utils/isAdBlockEnabled",[],function(){"use strict";var e="adsbox",t=100,n=window.document;return function(i){if(i){var s=n.createElement("div");s.innerHTML="&nbsp;",s.className=e,n.body.appendChild(s),setTimeout(function(){i(0===s.offsetHeight),n.body.removeChild(s)},t)}}}),define("core/utils/html/toRGBColorString",[],function(){"use strict";var e="Color components should be numbers.";return function(t){var n=Number(t.red),i=Number(t.green),s=Number(t.blue);if(isNaN(n)||isNaN(i)||isNaN(s))throw new Error(e);var a="rgb",r=[n,i,s],o=t.alpha;if(o){if(o=Number(o),isNaN(o))throw new Error(e);a+="a",r.push(o)}return a+"("+r+")"}}),define("common/analytics/google",["require","common/keys","common/defines"],function(e,t,n){"use strict";var i,s=function(e){i=e},a=function(e){i?i(e):window._gaq.push(e)},r=function(){var i="";if(!n.debug||i){d(t.googleAnalytics),h(".disqus.com");var s=function(){};e([i?"ga-debug":"ga"],s,s)}},o={component:1,"package":2,forum:3,version:4,userType:5},l=function(e,t){a(["_setCustomVar",o[e],e,t])},c=function(){a(["_trackPageview"])},u=function(e,t,n){a(["_trackEvent",t,e,n,1])},d=function(e){a(["_setAccount",e])},h=function(e){a(["_setDomainName",e])};return window._gaq||(window._gaq=[]),r(),{setCaller:s,setAccount:d,setCustomVar:l,trackPageview:c,trackEvent:u,setDomainName:h}}),define("common/intelligence",["underscore","common/analytics/google"],function(e,t){"use strict";function n(e){return e.has("remote")?e.get("remote").domain:e.id?"disqus":"not_logged_in"}function i(e){return e.support_preferred?"plus":e.support_priority?"pro":e.support_vip?"vip":"free"}function s(){t.trackPageview()}function a(e,n){t.setCustomVar(e,n)}function r(){this.version="next",this.forum=null,this.userType=null}return r.prototype.init=function(e){e=e||{},a("component","embed"),e.version&&(this.version=e.version),a("version",this.version),e.forum&&(this.forum=e.forum,a("forum",e.forum)),e.features&&a("package",i(e.features)),this.setSession(e.session||"not_logged_in"),s()},r.prototype.setSession=function(t){var i=e.isString(t)?t:n(t);i!==this.userType&&(this.userType=i,a("userType",i))},r.prototype.trackEvent=function(e){t.trackEvent(e,this.version,this.forum)},{Intelligence:r,setCustomVar:a,trackPageview:s,getUserType:n,getPackageType:i}}),define("common/utils",["jquery","underscore","loglevel","common/urls","core/utils/cookies"],function(e,t,n,i,s){"use strict";var a=window.document,r={};r.globalUniqueId=function(e){return t.uniqueId(e)+"_"+Number(new Date)},r.addStylesheetRules=function(e){function n(){var s=t.find(a.styleSheets,function(e){var t=e.ownerNode||e.owningElement;return t.id===i});if(!s)return void setTimeout(n,50);for(var r=0,o=e.length;o>r;r++){var l=1,c=e[r],u=c[0],d="";"[object Array]"===Object.prototype.toString.call(c[1][0])&&(c=c[1],l=0);for(var h=c.length;h>l;l++){var p=c[l];d+=p[0]+":"+p[1]+(p[2]?" !important":"")+";\n"}s.insertRule?s.insertRule(u+"{"+d+"}",s.cssRules.length):s.addRule(u,d,-1)}}var i="css_"+(new Date).getTime(),s=a.createElement("style");s.id=i,a.getElementsByTagName("head")[0].appendChild(s),window.createPopup||s.appendChild(a.createTextNode("")),n()};var o=r.CORS={handler:function(e,t,n){e&&n>=200&&300>n?e():t&&(200>n||n>=300)&&t()},XHR2:function(e,t,n,i){var s=o.handler,a=new window.XMLHttpRequest;return a.open(e,t,!0),a.onreadystatechange=function(){a.readyState===window.XMLHttpRequest.DONE&&s(n,i,a.status)},a}};o.request=function(){return"withCredentials"in new window.XMLHttpRequest?o.XHR2:function(){return null}}(),r.isWindowClosed=function(e){if(!e)return!0;try{return e.closed||void 0===e.closed}catch(t){return!0}},r.truncate=function(e,t,n){return n=n||"...",e.length>t?e.slice(0,t)+n:e},r.extractDomainForCookies=function(e){return e.split("/")[2].replace(/:[0-9]+/,"")},r.cookies={domain:r.extractDomainForCookies(i.root),create:function(e,t){var n=31536e6;s.create(e,t,{domain:r.cookies.domain,expiresIn:n})},read:s.read,erase:function(e){s.erase(e,{domain:r.cookies.domain})}},r.updateURL=function(e,n){var i,s=a.createElement("a");return n=n||{},s.href=e,n.hostname&&n.hostname.match(/\.$/)&&(n.hostname+=s.hostname),i=t.extend({protocol:s.protocol,hostname:s.hostname,pathname:s.pathname,search:s.search},n),i.pathname.match(/^\//)||(i.pathname="/"+i.pathname),i.protocol+"//"+i.hostname+i.pathname+i.search},r.injectBaseElement=function(e,t){t=t||a;var n=t.getElementsByTagName("base")[0]||t.createElement("base");n.target="_parent",e?n.href=e:n.removeAttribute("href"),n.parentNode||(t.head||t.getElementsByTagName("head")[0]).appendChild(n)},r.syntaxHighlighter=function(){function n(){this.state=null,this.queue=[]}var i=1,s=2;return t.extend(n.prototype,{highlight:function(e){null===this.state&&this._load(),this.queue.push(e),this.state===s&&this.scheduleHighlight()},_highlight:function(t){var n=e(t).html();e(t).html(n.replace(/^<br>/,"")),this._hljs.highlightBlock(t),this.scheduleHighlight()},scheduleHighlight:function(){var e=this.queue.shift();e&&window.requestAnimationFrame(t.bind(this._highlight,this,e))},_load:function(){var e=this;e.state=i,require(["highlight"],function(t){e.state=s,e._hljs=t,e.scheduleHighlight()})}}),new n}();var l=e("html");r.getPageHeight=function(){return l.height()},r.calculatePositionFullscreen=function(){return{pageOffset:e(window).scrollTop(),height:a.documentElement.clientHeight,frameOffset:{left:0,top:0}}},r.triggerClick=function(e,t){var n,i,s=e[0],r={altKey:!1,button:0,ctrlKey:!1,metaKey:!1,shiftKey:!1};if(a.createEvent){if(n=a.createEvent("MouseEvents"),t)for(i in r)r.hasOwnProperty(i)&&t.hasOwnProperty(i)&&(r[i]=t[i]);n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,0,null),s.dispatchEvent&&s.dispatchEvent(n)}else if(a.createEventObject){if(n=a.createEventObject(),n.eventType="click",t)for(i in r)r.hasOwnProperty(i)&&t.hasOwnProperty(i)&&(n[i]=t[i]);s.fireEvent("onclick",n)}},r.delayLinkClick=function(e,n){e.preventDefault(),t.delay(t.bind(r.triggerClick,this,n,e.originalEvent),100)},r.mixin=function(e,n,i){var s=e.prototype,a=t.extend({},n,i);if(t.defaults(s,a),t.defaults(s.events,a.events),void 0!==s.initialize&&void 0!==a.initialize){var r=s.initialize;s.initialize=function(){var e=r.apply(this,arguments);return a.initialize.apply(this,arguments),e}}return e},r.extractService=function(t,n){var i="[data-action^="+n+"]",s=e(t);s=s.is(i)&&s||s.closest(i);var a=s.attr("data-action")||":",r=a.split(":")[1];return r},r.getConfigFromHash=function(e){var i,s=e.location.hash;try{i=JSON.parse(decodeURIComponent(String(s).substr(1)))}catch(a){n.debug("Failed to parse config from URL hash",a)}return t.isObject(i)?i:{}};var c=/[<>]|:\/\//;return r.isPlainText=function(e){return!e.match(c)},r.isDNTEnabled=function(e){return e||(e=window),"1"===e.navigator.doNotTrack||"yes"===e.navigator.doNotTrack||"1"===e.navigator.msDoNotTrack},r.shouldSample=function(e){var t=parseInt(e,10);return!!t&&(!(t>100)&&Math.random()<t/100)},r.decorate=function(){var e,n=t.toArray(arguments),i=n.pop();return t.isFunction(i)||(e=i,i=n.pop()),t.reduceRight(n,function(t,n){return n.call(e||this,t)},function(){return i.apply(e||this,arguments)})},r}),define("lounge/tracking",["jquery","underscore","raven","core/analytics/identity","core/analytics/jester","core/bus","core/utils/url/serialize","core/utils/isAdBlockEnabled","core/utils/html/toRGBColorString","remote/config","common/intelligence","common/urls","common/utils","common/main"],function(e,t,n,i,s,a,r,o,l,c,u,d,h,p){"use strict";function m(n,c){function m(e,s,a){var o=e.user.id,l=h.isDNTEnabled(),u=t.extend({event:"init_embed",thread:x,forum:w,forum_id:b,imp:i.impression.impId,prev_imp:i.impression.prevImp,thread_slug:y.get("slug"),user_type:e.user.get("user_type")||"anon",referrer:n.document.referrer,theme:"next",dnt:l?"1":"0",abe:a?"1":"0",tracking_enabled:s?"1":"0",embed_hidden:c.config.isBehindClick?"1":"0"},c.config.experiment);o&&"0"!==o&&(u.user_id=o);var p=v.get("settings");p&&t.has(p,"organicDiscoveryEnabled")&&t.extend(u,{organic_enabled:p.organicDiscoveryEnabled,promoted_enabled:p.promotedDiscoveryEnabled,max_enabled:p.discoveryMax,thumbnails_enabled:p.discoveryThumbnailsEnabled}),(new n.Image).src=r(d.jester+"/event.gif",u,!1)}var g=new u.Intelligence,v=c.forum,w=v.id,b=v.get("pk"),y=c.thread,x=y.id;c.session.on("change:id",function(e){s.client.set("user_id",e.id)}),c.session.once("change:id",function(){var e=this,t=f.shouldTrack(v,this.user);t&&f.load3rdParties(y),g.init({version:"next",forum:w,features:c.initialData.features,session:e.user}),c.session.on("change:id",function(e){g.setSession(e),g.trackEvent(e.id?"login":"logout")}),o(function(n){m(e,t,n)})}),s.client.set({product:"embed",thread:x,thread_id:x,forum:w,forum_id:b,zone:"thread",version:p.version}),c.once("bootstrap:complete",function(){s.client.set({page_url:c.config.referrer});var e=c.config.experiment;e&&s.client.set({experiment:e.experiment,variant:e.variant,service:e.service}),s.client.setHostReferrer(c.config.hostReferrer)});var _={inViewport:function(){var i=c.config;g.trackEvent("view_embed");var a={color_scheme:i.colorScheme,anchor_color:l(i.anchorColor),typeface:i.typeface,width:e(n.document).width()};a=t.pick(a,function(e,n){switch(n){case"width":return t.isNumber(e);default:return t.isString(e)&&""!==e}}),s.client.emit({verb:"view",object_type:"product",object_id:"embed",extra_data:JSON.stringify(a)}),c.off("inViewport")},"uiAction:createPost":function(e){c.session.user.id||g.setSession("guest"),e.get("parent")?g.trackEvent("post_comment_reply"):g.trackEvent("post_comment")},"uiCallback:postCreated":function(e,n){n=n||{},t.extend(n,{object_type:"post",object_id:e.id,verb:"post"}),e.has("parent")&&(n.target_type="post",n.target_id=e.get("parent")),s.client.emit(n)},"uiAction:seeMore":function(e){s.client.emit({verb:"open",object_type:"section",object_id:"thread/page-"+e})},"uiAction:postUpvote":function(e,t){g.trackEvent("like_comment"),s.client.emit({verb:"like",object_type:"post",object_id:e.id,area:f.getEventTrackingArea(t)})},"uiAction:postUnvote":function(e,t){s.client.emit({verb:"unlike",object_type:"post",object_id:e.id,area:f.getEventTrackingArea(t)})},"uiAction:postDownvote":function(e,t){g.trackEvent("dislike_comment"),s.client.emit({verb:"dislike",object_type:"post",object_id:e.id,area:f.getEventTrackingArea(t)})},"uiAction:upvotersCardShow":function(){g.trackEvent("upvoters_card_shown")},"uiAction:showProfileFromUpvotes":function(){g.trackEvent("upvoters_profile_click")},"uiAction:threadUnlike":function(){s.client.emit({verb:"unlike",object_type:"thread",zone:"thread"})},"uiAction:threadLike":function(){g.trackEvent("like_thread"),s.client.emit({verb:"like",object_type:"thread"})},"uiAction:postShare":function(e,t){g.trackEvent("share_comment_"+t),s.client.emit({verb:"share",object_type:"post",object_id:e.id,target_type:"service",target_id:t})},"uiAction:threadShare":function(e){g.trackEvent("share_thread_"+e),s.client.emit({verb:"share",object_type:"thread",target_type:"service",target_id:e})},"uiAction:clickLink":function(e,t){s.client.emit({verb:"click",object_type:"link",object_id:e[0].href,area:f.getEventTrackingArea(t)})},"uiAction:followUser":function(e){g.trackEvent("follow_user"),s.client.emit({verb:"follow",object_type:"user",object_id:e.id})},"uiAction:unfollowUser":function(e){s.client.emit({verb:"stop-following",object_type:"user",object_id:e.id})},"uiAction:openLogin":function(e){g.trackEvent("open_login_"+e),s.client.emit({verb:"open",object_type:"login",object_id:e})},"uiAction:finishRegistrationEmbed":function(){g.trackEvent("finish_registration_embed")},"uiAction:finishRegistrationWindow":function(){g.trackEvent("finish_registration_window")},"uiAction:finishAccountComplete":function(){g.trackEvent("finish_account_complete")},"uiAction:onboardAlertShow":function(){s.client.emit({verb:"view",object_type:"area",object_id:"onboard_alert"})},"uiAction:onboardAlertDismiss":function(){s.client.emit({verb:"close",object_type:"area",object_id:"onboard_alert"})},"uiAction:openHome":function(){s.client.emit({verb:"open",object_type:"product",object_id:"bridge"})},viewActivity:function(e,t){var n={verb:"view",object_type:e,object_id:t};s.client.emit(n)}};c.on(_),a.on(_)}var f={};return f.init=function(e){m(window,e)},f.getEventTrackingArea=function(t){return e(t.currentTarget).closest("[data-tracking-area]").attr("data-tracking-area")},f.load3rdParties=function(i){if(d.glitter){var s=c.lounge.tracking||{},a=s.iframe_limit||0,r={postCount:i.get("posts")||0,likeCount:i.get("likes")||0,postVoteCount:t.reduce(i.posts.pluck("likes"),function(e,t){return e+t},0)};e.ajax({dataType:"jsonp",cache:!0,url:d.glitter,data:{forum_shortname:i.forum.id,thread_id:i.id},jsonpCallback:"dsqGlitterResponseHandler",success:function(i){var s=e("body");t.each(i,function(i){if(!("img"!==i.type&&"iframe"!==i.type||"iframe"===i.type&&(a-=1,0>a))){var o;try{o=i.url.replace(/\{\{(.+?)\}\}/g,function(e,n){var i=n.trim();if(!r.hasOwnProperty(i))throw new Error("Unknown template variable in tracker URL: "+i);return t.escape(r[i])}),s.append(e("<"+i.type+">").hide().attr("src",o))}catch(l){n.captureException(l)}}})}})}},f.shouldTrack=function(e,t){return!(e&&e.get("settings").disable3rdPartyTrackers||t&&t.get("disable3rdPartyTrackers")||"1"===h.cookies.read("disqus_tracking_optout")||h.isDNTEnabled())},f}),define("core/api",["jquery","underscore","backbone","core/config","core/utils"],function(e,t,n,i,s){"use strict";function a(e){return d.href=e,d.origin||d.protocol+"//"+d.hostname+(d.port?":"+d.port:"")}function r(e){return e.replace(/^(http:)?\/\//,"https://")}function o(n){n=t.defaults(n,h),n.traditional=!0,a(window.location.href)!==a(n.url)&&(n.xhrFields={withCredentials:!0}),n.omitDisqusApiKey||(n.data=n.data||{},window.FormData&&n.data instanceof window.FormData?n.url=s.serialize(n.url,{api_key:i.keys.api}):n.data.api_key=i.keys.api);var r=n.error;return n.error=function(e){p.trigger("error",e),t.isFunction(r)&&r(e)},e.ajax(n)}function l(e,n){return n=n||{},n.url=c(e),n.omitDisqusApiKey||(n.data=t.extend(n.data||{},{api_key:i.keys.api})),p.trigger("call",n),o(n).always(t.bind(this.trigger,this,"complete",n))}function c(e){return/(https?:)?\/\//.test(e)?r(e):i.urls.api+e}var u=window.document,d=u.createElement("a"),h={},p={ERROR_CODES:{OBJ_NOT_FOUND:8,MAX_ITEMS_REACHED:24},ajax:o,call:l,getURL:c,defaults:function(e){Object.keys(e).forEach(function(n){var i=e[n],s=h[n];t.isObject(i)&&t.isObject(s)?t.extend(s,i):h[n]=i})},headers:function(e){var n=t.extend({},h.headers,e);return h.headers=t.pick(n,Boolean),h.headers},makeHttps:r};return t.extend(p,n.Events),p}),define("core/templates/handlebars.partials",["handlebars"],function(e){e.registerPartial("cardGuestUpvoterText",e.template({1:function(e,t,n,i,s){return" "+e.escapeExpression(n.gettext.call(null!=t?t:{},"%(guestCount)s Guest Votes",{name:"gettext",hash:{guestCount:null!=t?t.guestCount:t},data:s}))+" "},3:function(e,t,n,i,s){return" "+e.escapeExpression(n.gettext.call(null!=t?t:{},"1 Guest Vote",{name:"gettext",hash:{},data:s}))+" "},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a,r=null!=t?t:{};return(null!=(a=n["if"].call(r,n.gt.call(r,null!=t?t.guestCount:t,1,{name:"gt",hash:{},data:s}),{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.program(3,s,0),data:s}))?a:"")+"\n"},useData:!0})),e.registerPartial("cardGuestUser",e.template({1:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.lambda,l=e.escapeExpression;return'<li class="user '+(null!=(a=n["if"].call(r,null!=t?t.highlight:t,{name:"if",hash:{},fn:e.program(2,s,0),inverse:e.noop,data:s}))?a:"")+'" data-role="guest">\n<span class="avatar" title="'+l(o(null!=t?t.guestText:t,t))+'">\n<img src="'+l(o(null!=t?t.guestAvatarUrl:t,t))+'" alt="'+l(n.gettext.call(r,"Avatar",{name:"gettext",hash:{},data:s}))+'" />\n</span>\n<span class="username" title="'+l(o(null!=t?t.guestText:t,t))+'">\n'+l(o(null!=t?t.guestText:t,t))+"\n</span>\n</li>\n"},2:function(e,t,n,i,s){return"highlight"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a;return null!=(a=n["if"].call(null!=t?t:{},null!=t?t.guestCount:t,{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?a:""},useData:!0})),e.registerPartial("cardOtherUserText",e.template({1:function(e,t,n,i,s){return" "+e.escapeExpression(n.gettext.call(null!=t?t:{},"%(guestCount)s Others",{name:"gettext",hash:{guestCount:null!=t?t.guestCount:t},data:s}))+" "},3:function(e,t,n,i,s){return" "+e.escapeExpression(n.gettext.call(null!=t?t:{},"1 Other",{name:"gettext",hash:{},data:s}))+" "},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a,r=null!=t?t:{};return(null!=(a=n["if"].call(r,n.gt.call(r,null!=t?t.guestCount:t,1,{name:"gt",hash:{},data:s}),{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.program(3,s,0),data:s}))?a:"")+"\n"},useData:!0})),e.registerPartial("cardUser",e.template({1:function(e,t,n,i,s){return"highlight"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.lambda,l=e.escapeExpression;return'<li class="user '+(null!=(a=n["if"].call(r,null!=t?t.highlight:t,{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?a:"")+'" data-action="profile" data-username="'+l(o(null!=t?t.username:t,t))+'">\n<a class="avatar" href="'+l(o(null!=t?t.profileUrl:t,t))+'" title="'+l(o(null!=t?t.name:t,t))+'">\n<img src="'+l(o(null!=(a=null!=t?t.avatar:t)?a.cache:a,t))+'" alt="'+l(n.gettext.call(r,"Avatar",{name:"gettext",hash:{},data:s}))+'" />\n</a>\n<a class="username" href="'+l(o(null!=t?t.profileUrl:t,t))+'" title="'+l(o(null!=t?t.name:t,t))+'">\n'+l(o(null!=t?t.name:t,t))+"\n</a>\n</li>\n"},useData:!0})),e.registerPartial("carouselArrowLeft",e.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){return'<button class="carousel-control carousel-control__previous"><span class="icon icon-right-bracket icon-flipped"></span></button>\n'},useData:!0})),e.registerPartial("carouselArrowRight",e.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){return'<button class="carousel-control carousel-control__next"><span class="icon icon-right-bracket"></span></button>\n'},useData:!0})),e.registerPartial("channelsHeader",e.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return'<div class="align-inline spacing-top">\n<div class="module-header__icon icon-colorful spacing-right">\n<svg class="icon-discover" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 18 18" enable-background="new 0 0 18 18" xml:space="preserve" width="26" height="26"><rect x="14" width="4" height="4" class="dot"/><rect x="14" y="7" width="4" height="4" class="dot"/><rect x="14" y="14" width="4" height="4" class="dot"/><rect x="7" width="4" height="4" class="dot"/><rect x="7" y="7" width="4" height="4" class="dot"/><rect x="7" y="14" width="4" height="4" class="dot"/><rect width="4" height="4" class="dot"/><rect y="7" width="4" height="4" class="dot"/><rect y="14" width="4" height="4" class="dot"/></g></svg>\n</div>\n<div class="module-header__title">\n<h1 class="text-larger text-darker">'+r(n.gettext.call(a,"Channels",{name:"gettext",hash:{},data:s}))+'</h1>\n</div>\n</div>\n<p class="text-medium text-gray spacing-bottom-narrow">'+r(n.gettext.call(a,"Places to start your own discussions.",{name:"gettext",hash:{},data:s}))+"</p>\n"},useData:!0})),e.registerPartial("genericFollowButton",e.template({1:function(e,t,n,i,s){return" active"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression;return'<button class="btn-follow'+(null!=(a=n["if"].call(r,null!=t?t.isFollowing:t,{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?a:"")+'" data-action="toggle-follow">\n<span class="symbol-default"><span class="icon-plus"></span></span><span class="text-default">'+o(n.gettext.call(r,"Follow",{name:"gettext",hash:{},data:s}))+'</span><span class="symbol-following"><span class="icon-checkmark"></span></span><span class="text-following">'+o(n.gettext.call(r,"Following",{name:"gettext",hash:{},data:s}))+"</span>\n</button>\n"},useData:!0}))}),define("core/extensions/helpers/eq",[],function(){"use strict";return function(e,t){return e===t}}),define("core/extensions/helpers/ne",[],function(){"use strict";return function(e,t){return e!==t}}),define("core/extensions/helpers/gt",[],function(){"use strict";return function(e,t){return e>t}}),define("core/extensions/helpers/lt",[],function(){"use strict";return function(e,t){return t>e}}),define("core/extensions/helpers/ge",[],function(){"use strict";return function(e,t){return e>=t}}),define("core/extensions/helpers/le",[],function(){"use strict";return function(e,t){return t>=e}}),define("core/extensions/helpers/typeof",[],function(){"use strict";return function(e,t){return typeof e===t}}),define("core/extensions/helpers/notNull",[],function(){"use strict";return function(e){return null!==e}}),define("core/extensions/helpers/any",[],function(){"use strict";return function(){for(var e=arguments.length,t=0;e-1>t;t++)if(arguments[t])return arguments[t]}}),define("core/extensions/helpers/if_any",[],function(){"use strict";return function(){for(var e=arguments.length,t=arguments[e-1],n=0;e-1>n;n++)if(arguments[n])return t.fn(this);return t.inverse(this)}}),define("core/extensions/helpers/if_all",[],function(){"use strict";return function(){for(var e=arguments.length,t=arguments[e-1],n=0;e-1>n;n++)if(!arguments[n])return t.inverse(this);return t.fn(this)}}),define("core/utils/storage",[],function(){"use strict";var e=function(e){var t="_dsqstorage_";try{return e.localStorage.setItem(t,t),e.localStorage.getItem(t),e.localStorage.removeItem(t),!0}catch(n){return!1}}(window),t=function(){var e={};return{getItem:function(t){return e.hasOwnProperty(t)?e[t]:null},setItem:function(t,n){e[t]=String(n)},removeItem:function(t){delete e[t]},clear:function(){e={}}}}();return{get:function(e){var t=null;try{return t=this.backend.getItem(e),JSON.parse(t)}catch(n){return t}},set:function(e,t){try{this.backend.setItem(e,JSON.stringify(t))}catch(n){}},remove:function(e){try{this.backend.removeItem(e)}catch(t){}},clear:function(){try{this.backend.clear()}catch(e){}},backend:e?window.localStorage:t,isPersistent:e}}),define("core/utils/auth",["core/utils/cookies"],function(e){"use strict";var t={},n="disqusauth";return t.getFromCookie=function(){var t=(e.read(n)||"").replace(/"/g,"").split("|");!t||t[1]&&t[6]||(t=[],e.erase(n,{}));var i=parseInt(t[6]||"0",10);return{avatarUrl:t[7]?decodeURIComponent(t[7]):void 0,datetimeFormatting:parseInt(t[4],10)?"absolute":"relative",id:i,isModerator:parseInt(t[8],10)>0,staff:Boolean(parseInt(t[2],10)),tzOffset:t[5],username:t[1],isAuthenticated:Boolean(i&&"0"!==i)}},t}),define("core/switches",["underscore","remote/config","core/analytics/identity","core/utils/storage","core/utils/auth"],function(e,t,n,i,s){"use strict";var a="switch:",r={};return r._getKey=function(e){return a+e},r.disableFeature=function(e){i.set(this._getKey(e),!1)},r.unsetFeature=function(e){i.remove(this._getKey(e),!0)},r.forceFeature=function(e){i.set(this._getKey(e),!0)},r.isFeatureActive=function(a,r){var o=this._getKey(a),l=i.get(o);if(e.isBoolean(l))return l;var c=(t.lounge&&t.lounge.switches||{})[a];if(!c)return!1;var u=s.getFromCookie();return r=e.defaults(r||{},{percent:n.clientPercent(),user_id:u.id,username:u.username,is_staff:u.staff,is_moderator:u.isModerator}),e.any(c,function(t,i){var s=r[i];return/percent$/.test(i)&&e.isNumber(t)?e.isNumber(s)?t>s:t>n.getPercentBucketForString(s):e.isArray(t)?e.contains(t,s):t===s})},r}),define("core/extensions/helpers/switch",["core/switches"],function(e){"use strict";return function(t){return e.isFeatureActive(t)}}),define("core/extensions/helpers/partial",["handlebars"],function(e){"use strict";return function(t,n){e.registerPartial(t,n.fn)}}),define("core/extensions/helpers/getPartial",["handlebars"],function(e){"use strict";return function(t,n,i){return"undefined"==typeof i&&(i=n,n=this,e.Utils.extend(n,i.hash)),new e.SafeString(e.partials[t](n,i))}}),define("core/extensions/helpers/gettext",["handlebars","core/strings"],function(e,t){"use strict";return function(){var n,i,s,a,r=arguments.length,o=arguments[r-1],l=o.hash,c=arguments[0],u=e.partials;c=t.get(c);for(s in l)l.hasOwnProperty(s)&&(i=new RegExp("%\\(("+s+")\\)s","gm"),n=l[s],a=n&&n.executePartial,a&&(n=u[n.partial].call(this,n.context,o)),void 0===n||null===n||"number"==typeof n&&isNaN(n)?n="":a||(n=e.Utils.escapeExpression(n)),c=c.replace(i,n.toString()));return new e.SafeString(c)}}),define("core/extensions/helpers/urlfor",["core/config/urls"],function(e){"use strict";return function(t){for(var n=t.split("."),i=n.length,s=e,a=0;s.hasOwnProperty(n[a])&&i>a;)s=s[n[a]],a+=1;return s}}),define("core/extensions/helpers/html",["handlebars"],function(e){"use strict";return function(t){return new e.SafeString(t||"")}}),define("core/extensions/helpers/with",[],function(){"use strict";return function(){var e=arguments.length,t=arguments[e-1],n=arguments[0];return 3===e?(n={},n[arguments[0]]=arguments[1]):"_window_"===n&&(n=window),t.fn(n)}}),define("core/extensions/helpers/each",["handlebars"],function(e){"use strict";return function(t,n){var i,s,a,r=n.fn,o=n.inverse,l=0,c="";if(n.data&&(i=e.createFrame(n.data)),t&&"object"==typeof t)if("[object Array]"===Object.prototype.toString.call(t))for(a=t.length;a>l;l++)i&&(i.index=l,i.length=t.length),c+=r(t[l],{data:i});else for(s in t)t.hasOwnProperty(s)&&(i&&(i.key=s),c+=r(t[s],{data:i}),l+=1);return 0===l&&(c=o(this)),c}}),define("core/extensions/helpers/log",[],function(){"use strict";return function(e){console.log(e,this)}}),define("core/extensions/helpers/debug",[],function(){"use strict";return function(){}}),define("core/extensions/helpers/geturl",[],function(){"use strict";return window.geturl||function(e){
return e}}),define("core/extensions/helpers/truncate",["handlebars"],function(e){"use strict";return function(t,n){return t.length<=n?t:new e.SafeString(e.Utils.escapeExpression(t.slice(0,n))+"&hellip;")}}),define("core/extensions/helpers/tag",["handlebars"],function(e){"use strict";return function(t,n){var i=["<"+t],s=n.hash.text;delete n.hash.text;for(var a in n.hash)n.hash.hasOwnProperty(a)&&i.push(" "+a+'="'+e.escapeExpression(n.hash[a])+'"');return i.push(">"+e.escapeExpression(s)+"</"+t+">"),new e.SafeString(i.join(""))}}),define("core/extensions/helpers/now",["moment"],function(e){"use strict";return function(t){return e().format(t)}}),define("core/extensions/handlebars.helpers",["require","handlebars","./helpers/eq","./helpers/ne","./helpers/gt","./helpers/lt","./helpers/ge","./helpers/le","./helpers/typeof","./helpers/notNull","./helpers/any","./helpers/if_any","./helpers/if_all","./helpers/switch","./helpers/partial","./helpers/getPartial","./helpers/gettext","./helpers/urlfor","./helpers/html","./helpers/with","./helpers/each","./helpers/log","./helpers/debug","./helpers/geturl","./helpers/truncate","./helpers/tag","./helpers/now"],function(e){"use strict";var t=e("handlebars");return t.registerHelper("eq",e("./helpers/eq")),t.registerHelper("ne",e("./helpers/ne")),t.registerHelper("gt",e("./helpers/gt")),t.registerHelper("lt",e("./helpers/lt")),t.registerHelper("ge",e("./helpers/ge")),t.registerHelper("le",e("./helpers/le")),t.registerHelper("typeof",e("./helpers/typeof")),t.registerHelper("notNull",e("./helpers/notNull")),t.registerHelper("any",e("./helpers/any")),t.registerHelper("if_any",e("./helpers/if_any")),t.registerHelper("if_all",e("./helpers/if_all")),t.registerHelper("switch",e("./helpers/switch")),t.registerHelper("partial",e("./helpers/partial")),t.registerHelper("getPartial",e("./helpers/getPartial")),t.registerHelper("gettext",e("./helpers/gettext")),t.registerHelper("urlfor",e("./helpers/urlfor")),t.registerHelper("html",e("./helpers/html")),t.registerHelper("with",e("./helpers/with")),t.registerHelper("each",e("./helpers/each")),t.registerHelper("log",e("./helpers/log")),t.registerHelper("debug",e("./helpers/debug")),t.registerHelper("geturl",e("./helpers/geturl")),t.registerHelper("truncate",e("./helpers/truncate")),t.registerHelper("tag",e("./helpers/tag")),t.registerHelper("now",e("./helpers/now")),t}),define("core/templates/alert",["handlebars","core/templates/handlebars.partials","core/extensions/handlebars.helpers"],function(e){return e.template({1:function(e,t,n,i,s){return'<span class="icon icon-warning"></span>\n'},3:function(e,t,n,i,s){var a;return(null!=(a=e.lambda(null!=t?t.message:t,t))?a:"")+"\n"},5:function(e,t,n,i,s){return e.escapeExpression(e.lambda(null!=t?t.message:t,t))+"\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a,r=null!=t?t:{};return'<a class="close" data-action="dismiss" title="'+e.escapeExpression(n.gettext.call(r,"Dismiss",{name:"gettext",hash:{},data:s}))+'">×</a>\n<span>\n'+(null!=(a=n["if"].call(r,null!=t?t.icon:t,{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?a:"")+(null!=(a=n["if"].call(r,null!=t?t.safe:t,{name:"if",hash:{},fn:e.program(3,s,0),inverse:e.program(5,s,0),data:s}))?a:"")+"</span>\n"},useData:!0})}),define("core/views/AlertView",["backbone","core/templates/alert"],function(e,t){"use strict";var n=e.View.extend({className:"alert",events:{"click [data-action=dismiss]":"dismiss"},initialize:function(e){this.options=e,this.message=e.message,this.safe=e.safe,this.type=e.type},render:function(){var e=this.$el;return e.html(t({message:this.message,safe:this.safe,icon:"error"===this.type})),e.attr("class",this.className),this.type&&e.addClass(this.type),this},dismiss:function(e){e&&e.preventDefault&&e.preventDefault(),this.remove(),this.trigger("dismiss")}});return n}),define("core/mixins/withAlert",["underscore","core/views/AlertView"],function(e,t){"use strict";var n={alert:function(n,i){e.isObject(i)||(i={});var s=i.target||this._alertSelector;this.dismissAlert();var a=this._alert=new t(e.extend({message:n},i));return a.render(),s?this.$el.find(s).prepend(a.el):this.el.parentNode&&this.el.parentNode.insertBefore(a.el,this.el),a},dismissAlert:function(e){this._alert&&(!e||e(this._alert))&&this._alert.dismiss()},setAlertSelector:function(e){this._alertSelector=e}},i=function(){return e.extend(this,n)};return i}),define("core/models/ThreadVote",["backbone"],function(e){"use strict";var t=e.Model.extend({defaults:{score:0}});return t}),define("core/models/Vote",["backbone"],function(e){"use strict";var t=e.Model.extend({defaults:{score:0}});return t}),define("core/time",[],function(){"use strict";function e(e){return e.indexOf("+")>=0?e:e+"+00:00"}var t="YYYY-MM-DDTHH:mm:ssZ";return{ISO_8601:t,assureTzOffset:e}}),define("core/models/BaseUser",["backbone","core/config"],function(e,t){"use strict";var n=e.Model.extend({defaults:{about:null,avatar:{cache:t.urls.avatar.generic,permalink:t.urls.avatar.generic},connections:{},email:null,isAnonymous:!0,isFollowedBy:null,isFollowing:null,joinedAt:null,name:null,profileUrl:null,url:null,username:null,numPosts:null,numFollowing:null,numForumsFollowing:null,numFollowers:null,numLikesReceived:null,isFlagged:null},hasValidAvatar:function(e){var t=e?e.avatar:this.get("avatar");return t&&t.cache},isAnonymous:function(){return!this.get("id")},isRegistered:function(){return!this.isAnonymous()},validate:function(e){return this.hasValidAvatar(e)?void 0:"None of the avatar related properties can be null, undefined or empty on User models."},toJSON:function(){var t=e.Model.prototype.toJSON.apply(this,arguments);return t.thread={},this.hasValidAvatar()||(t.avatar=this.defaults.avatar),t.isRegistered=this.isRegistered(),t}});return n}),define("core/models/User",["jquery","underscore","moment","core/config","core/time","core/utils","core/strings","core/api","core/models/BaseUser"],function(e,t,n,i,s,a,r,o,l){"use strict";function c(e,t,n){e[t]=e[t]||[],e[t].push(n)}var u=r.get,d=l.extend({url:o.getURL("users/details"),validate:function(n){var i={};return n.display_name&&(n.display_name=e.trim(n.display_name)),n.display_name||c(i,"display_name",u("Please enter your name.")),n.email||c(i,"email",u("Please enter your email address.")),a.validateEmail(n.email)||c(i,"email",u("Invalid email address.")),this.isNew()&&(n.password?n.password.length<d.MIN_PASSWORD_LEN&&c(i,"password",u("Password must have at least 6 characters.")):c(i,"password",u("Please enter a password."))),n.name&&(n.name.length<d.MIN_NAME_LEN&&c(i,"name",r.interpolate(u("Name must have at least %(minLength)s characters."),{minLength:d.MIN_NAME_LEN})),n.name.length>d.MAX_NAME_LEN&&c(i,"name",r.interpolate(u("Name must have less than %(maxLength)s characters."),{maxLength:d.MAX_NAME_LEN}))),n.location&&n.location.length>d.MAX_LOCATION_LEN&&c(i,"location",r.interpolate(u("Location must have less than %(maxLength)s characters."),{maxLength:d.MAX_LOCATION_LEN})),n.url&&(n.url.length>d.MAX_URL_LEN&&c(i,"url",r.interpolate(u("Site must have less than %(maxLength)s characters."),{maxLength:d.MAX_URL_LEN})),a.isUrl(n.url)||c(i,"url",u("Please enter a valid site."))),t.isEmpty(i)?void 0:i},prepareFetchOptions:function(e){e=e?t.clone(e):{};var n={};return this.get("id")?n.user=this.get("id"):this.get("username")&&(n.user="username:"+this.get("username")),t.extend(n,e.data),e.data=n,e},fetch:function(e){return e=this.prepareFetchOptions(e),l.prototype.fetch.call(this,e)},parse:function(e){return e.response||e},register:function(e){var t=this;return e=e||{},o.call("internal/users/register.json",{data:this.toRegisterJSON(),method:"POST",success:function(n){t.set(n.response),e.success&&e.success(n)},error:e.error})},saveAvatar:function(e){var t=new window.FormData;return t.append("avatar_file",e),t.append("api_key",i.keys.api),o.call("internal/users/updateAvatar.json",{method:"post",data:t,cache:!1,contentType:!1,processData:!1})},saveProfile:function(){return o.call("users/updateProfile.json",{method:"POST",data:{name:this.get("name"),about:this.get("about"),location:this.get("location"),url:this.get("url")}})},toRegisterJSON:function(){return t.pick(this.toJSON(),"display_name","email","password")},isSession:function(e){return e.user.id&&e.user.id===this.id},isEditable:function(e){return this.isSession(e)&&!this.get("remote")},toJSON:function(e){e=e||{};var t=l.prototype.toJSON.call(this),n=this.collection&&this.collection.thread;return t.thread.canModerate=Boolean(n&&n.isModerator(this)),e.session&&(t.isSession=this.isSession(e.session),t.isEditable=this.isEditable(e.session)),t},_changeFollowState:function(e){this.set({isFollowing:e,numFollowers:Math.max(0,this.get("numFollowers")+(e?1:-1))});var t="users/"+(e?"follow":"unfollow"),n=this;return o.call(t+".json",{data:{target:this.get("id")},method:"POST",success:function(e){n.trigger("sync",n,e,{})}})},follow:function(){return this._changeFollowState(!0)},unfollow:function(){return this._changeFollowState(!1)},_changeBlockState:function(e){var t="users/block/"+(e?"create":"delete"),n=this;return o.call(t+".json",{data:{user:this.get("id")},method:"POST",success:function(e){n.set(e.response)}})},block:function(){return this._changeBlockState(!0)},unblock:function(){return this._changeBlockState(!1)},report:function(e){var t=this;return o.call("users/report.json",{data:{reason:e,user:this.get("id")},method:"POST",success:function(){t.set("isFlagged",!0)}})},toggleFollowState:function(){return this._changeFollowState(!this.get("isFollowing"))},registeredLessThan:function(e,t){var i=s.assureTzOffset(this.get("joinedAt")),a=n().subtract(e,t);return n(i).isAfter(a)},registeredToday:function(){return this.registeredLessThan(1,"day")},registeredThisWeek:function(){return this.registeredLessThan(1,"week")},shouldHomeOnboard:function(){return!this.get("homeOnboardingComplete")},setHomeOnboardComplete:function(e){this.updateFlags({homeOnboardingComplete:e}),e&&this.listenTo(this,"change:homeOnboardingComplete",t.bind(this.set,this,"homeOnboardingComplete",e,{silent:!0}))},updateFlags:function(e){return this.set(e),o.call("internal/users/updateFlags.json",{data:t.mapObject(e,function(e){return e?1:0}),method:"POST"})}},{MIN_PASSWORD_LEN:6,MIN_NAME_LEN:2,MAX_NAME_LEN:30,MAX_LOCATION_LEN:255,MAX_URL_LEN:200});return d}),define("core/utils/html",[],function(){"use strict";var e="...",t=e.length,n=function(e){var t;try{t=(new window.DOMParser).parseFromString("<!doctype html><meta charset=utf-8><title> </title>","text/html")}catch(n){}return t||(t=window.document.implementation.createHTMLDocument("")),t.body.innerHTML=e,t};return{stripTags:function(e){var t=n(e).body;return(t.textContent||t.innerText).replace(/\r?\n/g," ")},replaceAnchors:function(e,i){var s=n(e);return[].forEach.call(s.querySelectorAll("a"),function(e){var n=e.getAttribute("href")||"",s=e.innerHTML,a=i(e);0===n.indexOf(s.slice(0,-t))?s=a:n.length&&-1!==s.indexOf(n)?s=s.replace(n,a):s+=" "+a,e.insertAdjacentHTML("afterend",s),e.parentNode.removeChild(e)}),s.body.innerHTML.trim()}}}),define("core/advice",["underscore"],function(e){"use strict";function t(){e.each(["before","after","around"],function(e){this[e]=function(t,i){return"function"==typeof this[t]?this[t]=n[e](this[t],i):this[t]=i,this[t]}},this)}var n={around:function(t,n){return function(){var i=e.toArray(arguments);return n.apply(this,[e.bind(t,this)].concat(i))}},before:function(t,i){return n.around(t,function(){var t=e.toArray(arguments),n=t.shift();return i.apply(this,t),n.apply(this,t)})},after:function(t,i){return n.around(t,function(){var t=e.toArray(arguments),n=t.shift(),s=n.apply(this,t);return i.apply(this,t),s})}};return{withAdvice:t}}),define("core/models/mixins",["underscore","moment","core/time"],function(e,t,n){"use strict";function i(){this._getCreatedMoment=e.memoize(function(){var e=this.get("createdAt");if(e)return t(n.assureTzOffset(e),n.ISO_8601)},function(){return this.get("createdAt")}),this.getRelativeCreatedAt=function(){var e=this._getCreatedMoment();return e&&e.from(Number(new Date))},this.getFormattedCreatedAt=e.memoize(function(){var e=this._getCreatedMoment();return e&&e.format("LLLL")},function(){return this.get("createdAt")})}return{withCreatedAt:i}}),define("core/collections/UserCollection",["jquery","backbone","core/models/User"],function(e,t,n){"use strict";var i=t.Collection.extend({model:n,initialize:function(e,n){t.Collection.prototype.initialize.apply(this,arguments),this.thread=n&&n.thread},fetch:function(){return e.when(!0)}});return i}),define("core/collections/UpvotersUserCollection",["underscore","backbone","core/api","core/collections/UserCollection"],function(e,t,n,i){"use strict";var s=i.extend({LIMIT:50,url:function(){return n.getURL("posts/listUsersVotedPost")},initialize:function(e,t){this.postId=t.postId,this.threadId=t.threadId},fetch:function(n){return t.Collection.prototype.fetch.call(this,e.extend({data:{post:this.postId,thread:this.threadId,vote:1,limit:this.LIMIT}},n))}});return s}),define("core/collections/VoteCollection",["backbone","core/models/Vote"],function(e,t){"use strict";var n=e.Collection.extend({model:t});return n}),define("core/models/Post",["jquery","underscore","backbone","moment","core/config/urls","core/api","core/strings","core/time","core/utils","core/utils/html","core/advice","core/models/mixins","core/collections/UpvotersUserCollection","core/collections/VoteCollection"],function(e,t,n,i,s,a,r,o,l,c,u,d,h,p){"use strict";var m=1e3,f=0,g=function(){var t=e.now();return!(m>t-f)&&(f=t,!0)},v=r.get,w=n.Model.extend({upvotersCollectionClass:h,defaults:function(){return{createdAt:i().format(o.ISO_8601),dislikes:0,isApproved:!0,isDeleted:!1,isEdited:!1,isFlagged:!1,isFlaggedByUser:!1,isHighlighted:!1,isRealtime:!1,isImmediateReply:!1,isMinimized:null,hasMedia:!1,message:null,raw_message:null,likes:0,media:[],parent:null,points:0,depth:0,userScore:0}},initialize:function(){this.votes=new p},messageText:function(){var e=this.get("message");return e&&c.stripTags(e)},permalink:function(e,t){var n=this.id;if(!n||!e)return"";var i=t!==!1&&e.currentUrl||e.permalink(),s=window.document.createElement("a");return s.href=i,s.hash="#comment-"+n,s.href},shortLink:function(){return s.shortener+"/p/"+Number(this.id).toString(36)},twitterText:function(e){var t=140,n=this.author.get("name")||this.author.get("username");t-=n.length+3,t-=e.length+1,t-=2;var i=l.niceTruncate(this.messageText(),t);return'"'+i+'" — '+n},toJSON:function(e){var t=n.Model.prototype.toJSON.call(this);if(e){var i=e.session,s=e.thread;t.canBeEdited=this.canBeEdited(i,s),t.canBeRepliedTo=this.canBeRepliedTo(i,s),t.canBeShared=this.canBeShared(),t.permalink=this.permalink(s)}return t.shortLink=this.shortLink(),t.isMinimized=this.isMinimized(),t.plaintext=this.messageText(),t.relativeCreatedAt=this.getRelativeCreatedAt(),t.formattedCreatedAt=this.getFormattedCreatedAt(),t.cid=this.cid,t},isPublic:function(){return!(!this.get("isHighlighted")&&!this.get("isSponsored"))||!this.get("isDeleted")&&this.get("isApproved")},isMinimized:function(){return!this.get("isHighlighted")&&(this.get("isMinimized")!==!1&&!this.get("isApproved"))},isAuthorSessionUser:function(){return!1},canBeEdited:function(){return!1},canBeRepliedTo:function(){return!1},canBeShared:function(){return!1},validateMessage:function(e){if(t.isString(e.raw_message)){if(""===e.raw_message)return v("Comments can't be blank.");if(e.raw_message.length<2)return v("Comments must have at least 2 characters.")}},validate:function(n){if(!this.id&&!n.id){var i=this.validateMessage(n);return i?i:(n.author_email&&(n.author_email=e.trim(n.author_email)),n.author_name&&(n.author_name=e.trim(n.author_name)),""===n.author_email&&""===n.author_name?v("Please sign in or enter a name and email address."):""===n.author_email||""===n.author_name?v("Please enter both a name and email address."):t.isString(n.author_email)&&!this.validateEmail(n.author_email)?v("Invalid email address format."):void 0)}},validateEmail:function(e){return l.validateEmail(e)},report:function(){this.set("isFlagged",!0),a.call("posts/report.json",{data:{post:this.id},method:"POST"})},_highlight:function(e){this.set("isHighlighted",e),a.call("posts/"+(e?"highlight":"unhighlight")+".json",{data:{post:this.id},method:"POST"})},highlight:function(){this._highlight(!0)},unhighlight:function(){this._highlight(!1)},getThreadId:function(){return this.get("thread")},getUpvotersUserCollection:t.memoize(function(){var e=this.upvotersCollectionClass;return new e((void 0),{postId:this.id,threadId:this.getThreadId()})},function(){return this.id}),_vote:function(e,t,n){var i=e-t,s={likes:this.get("likes"),dislikes:this.get("dislikes"),points:this.get("points")};return 0===i?i:(e>0?(s.likes+=e,s.dislikes+=t):0>e?(s.dislikes-=e,s.likes-=t):t>0?s.likes-=t:s.dislikes+=t,s.points+=i,n&&this.getUpvotersUserCollection()[e>0?"add":"remove"](n),this.set(s),i)},vote:function(e){if(!g())return 0;var t=this,n=t._vote(e,t.get("userScore"));0!==n&&(t.set("userScore",e),a.call("posts/vote.json",{data:{post:t.id,vote:e},method:"POST",success:function(n){t.votes.add({id:n.response.id,score:e},{merge:!0})}}))},_delete:function(){return this.set({isApproved:!1,isDeleted:!0}),a.call("posts/remove.json",{data:{post:this.id},method:"POST"})},spam:function(){this.set({isApproved:!1,isDeleted:!0,isSpam:!0}),this.trigger("spam"),a.call("posts/spam.json",{data:{post:this.id},method:"POST"})},_create:function(e,t){var n=this,i=e.attributes,s={thread:i.thread,message:i.raw_message};return i.parent&&(s.parent=i.parent),i.author_name&&(s.author_name=i.author_name,s.author_email=i.author_email),a.call("posts/create.json",{data:s,method:"POST",success:function(e){n.set(e.response),t.success&&t.success()},error:t.error})},_update:function(e,t){var n=this,i=e.attributes,s={post:i.id,message:i.raw_message};return a.call("posts/update.json",{data:s,method:"POST",success:function(e){n.set(e.response),t.success&&t.success()},error:t.error})},_read:function(e,t){var n=this;return t=t||{},a.call("posts/details.json",{data:{post:n.id},method:"GET",success:function(e){n.set(e.response),t.success&&t.success()},error:t.error})},sync:function(e,t,n){n=n||{};var i=n.error;switch(i&&(n.error=function(e){var t={};try{t=JSON.parse(e.responseText)}catch(n){}i(t)}),e){case"create":return this._create(t,n);case"update":return this._update(t,n);case"delete":return this._delete();case"read":return this._read(t,n)}},storageKey:function(){return this.isNew()&&this.getThreadId()?["drafts","thread",this.getThreadId(),"parent",this.get("parent")||0].join(":"):void 0}},{formatMessage:function(){var e=/(?:\r\n|\r|\n){2,}/,n=/\r\n|\r|\n/;return function(i){var s=t.chain(i.split(e)).compact().value(),a=t.map(s,function(e){return t.chain(e.split(n)).compact().map(t.escape).join("<br>").value()}).join("</p><p>");return"<p>"+a+"</p>"}}()});return d.withCreatedAt.call(w.prototype),u.withAdvice.call(w.prototype),w.withAuthor=function(e){this.around("set",function(n,i,s,a){var r;if(null==i)return this;"object"==typeof i?(r=i,a=s):(r={},r[i]=s);var o=r.author;if(o){if(t.isString(o)||t.isNumber(o)){var l=o;o={},o[e.prototype.idAttribute||"id"]=l}this.author=new e(o),this.trigger("changeRelated:author"),delete r.author}return n.call(this,r,a)}),this.around("toJSON",function(e){var n=e.apply(this,t.rest(arguments));return this.author&&(n.author=this.author.toJSON()),n})},w.withMediaCollection=function(e){this.after("set",function(n){n&&"string"!=typeof n&&(t.isUndefined(n.media)||(this.media?this.media.reset(n.media):this.media=new e(n.media),delete n.media))}),this.around("toJSON",function(e){var n=e.apply(this,t.rest(arguments));return this.media&&(n.media=this.media.toJSON()),n})},w}),define("core/models/Thread",["underscore","backbone","loglevel","core/config/urls","core/utils","core/api","core/config","core/advice","core/UniqueModel","core/models/User"],function(e,t,n,i,s,a,r,o,l,c){"use strict";var u=t.Model,d=u.prototype,h=u.extend({defaults:{author:null,category:null,createdAt:null,forum:null,identifiers:[],ipAddress:null,isClosed:!1,isDeleted:!1,hasStreaming:!1,link:null,message:null,slug:null,title:null,userSubscription:!1,posts:0,likes:0,dislikes:0,userScore:0},initialize:function(e,t){t=t||{},this.moderators=t.moderators,this.forum=t.forum,this.on("change:userScore",function(){var e=this.get("userScore");e>0&&0===this.get("likes")&&this.set("likes",e)},this)},_vote:function(e,t){var n=e-t;return 0===n?n:(this.set("likes",this.get("likes")+n),n)},vote:function(e){var t=this,n=t._vote(e,t.get("userScore"));0!==n&&(this.set("userScore",e),a.call("threads/vote.json",{data:{thread:this.id,vote:e},method:"POST",success:function(e){e.response.id&&t.trigger("vote:success",e)}}))},fetch:function(e){var t,i=this,s=i.attributes;e=e||{},t=s.identifier?"ident:"+s.identifier:"link:"+s.url,a.call("threads/details.json",{data:{thread:t,forum:s.forum},success:function(t){i.set(t.response),e.success&&e.success()},error:function(){r.debug?i.save({},{success:e.success}):n.info("Couldn't find thread; not creating in production.")}})},_toggleState:function(e,t){t||(t={});var n=e?"open.json":"close.json";return this.set("isClosed",!e),a.call("threads/"+n,{method:"POST",data:{thread:this.id},success:t.success,error:t.error})},open:function(e){return this._toggleState(!0,e)},close:function(e){return this._toggleState(!1,e)},sync:function(){var e=this,t=e.attributes;a.call("threads/create.json",{data:{title:t.title,forum:t.forum,identifier:t.identifier,url:t.url},method:"POST",success:function(t){e.set(t.response)}})},incrementPostCount:function(e){var t=this.get("posts")+e;this.set("posts",t>0?t:0)},isModerator:function(t){var n;if(this.moderators)return n=t instanceof c||e.isObject(t)?t.id:t,n=parseInt(n,10),e(this.moderators).contains(n)},subscribe:function(e,t){e=e!==!1;var n=this.get("userSubscription");if(n!==e){e?this.set("userSubscription",t||!0):this.set("userSubscription",!1);var i=e?"subscribe.json":"unsubscribe.json",s={thread:this.id};return t?s.email=t:e||"string"!=typeof n||(s.email=n),a.call("threads/"+i,{data:s,method:"POST"})}},twitterText:function(e){var t=140-(e.length+1),n=this.get("clean_title");return n=s.niceTruncate(n,t)},permalink:function(){return this.get("url")||this.get("link")||this.currentUrl},shortLink:function(){return i.shortener+"/t/"+Number(this.id).toString(36)},toJSON:function(){var e=d.toJSON.call(this);return e.permalink=this.permalink(),e.shortLink=this.shortLink(),e},getDiscussionRoute:function(e){var t=["","home","discussion",this.forum.id,this.get("slug"),""];return e=e||this.forum.channel,e&&(e=e.attributes||e,t.splice(2,0,"channel",e.slug)),t.join("/")}});return o.withAdvice.call(h.prototype),h.withThreadVoteCollection=function(e){this.after("initialize",function(){this.votes=new e,this.on("vote:success",function(e){this.votes.get(e.response.id)||this.votes.add({id:e.response.id,score:e.response.vote,currentUser:!0})},this)})},h.withPostCollection=function(t){this.after("initialize",function(n){n=n||{},this.posts=new t(n.posts,{thread:this,cursor:n.postCursor,order:n.order,perPage:this.postsPerPage}),this.listenTo(this.posts,"add reset",function(t){t=t.models?t.models:[t],this.users&&e.each(t,function(e){this.users.get(e.author.id)||this.users.add(e.author)}),this.recalculatePostCount()}),this.listenTo(this.posts,"change:isDeleted change:isFlagged",function(e,t){t&&this.incrementPostCount(-1)})}),this.recalculatePostCount=function(){var e=this.get("posts");e>50||(e=this.posts.reduce(function(e,t){return t.isPublic()?e+1:e},0),this.set("posts",e))}},l.addType("Thread",h),h}),define("core/models/Forum",["backbone","core/UniqueModel","core/api"],function(e,t,n){"use strict";var i=e.Model.extend({defaults:{settings:{},followUrl:"forums/follow",unfollowUrl:"forums/unfollow",isFollowing:!1},initialize:function(e,t){t&&t.channel&&(this.channel=t.channel)},_changeFollowingState:function(e){return n.call(e,{method:"POST",data:{target:this.get("id")}})},follow:function(){return this.set("isFollowing",!0),this._changeFollowingState(this.get("followUrl"))},unfollow:function(){return this.set("isFollowing",!1),this._changeFollowingState(this.get("unfollowUrl"))},toggleFollowed:function(){if(this.channel&&this.channel.get("options").isCurationOnlyChannel)return this.channel.toggleFollowed();var e=this.get("isFollowing")?this.unfollow():this.follow();return this.trigger("toggled:isFollowing"),e}});return t.addType("Forum",i),i}),define("core/models/Media",["underscore","backbone","core/api","core/UniqueModel"],function(e,t,n,i){"use strict";var s=t.Model.extend({idAttribute:"url",defaults:{mediaType:null,html:"",htmlWidth:null,htmlHeight:null,thumbnailUrl:"",thumbnailWidth:null,thumbnailHeight:null,url:"",urlRedirect:"",resolvedUrl:"",resolvedUrlRedirect:"",title:"",description:"",providerName:""},parse:function(e){return e.response},sync:function(t,i,s){if("read"!==t)throw new Error('Media models do not support methods other than "read".');return n.call("media/details.json",e.extend({method:"POST",data:{url:this.get("url")}},s))}},{MEDIA_TYPES:{IMAGE:"1",IMAGE_UPLOAD:"2",YOUTUBE_VIDEO:"3",WEBPAGE:"4",TWITTER_STATUS:"5",FACEBOOK_PAGE:"6",FACEBOOK_POST:"7",FACEBOOK_PHOTO:"8",FACEBOOK_VIDEO:"9",SOUNDCLOUD_SOUND:"10",GOOGLE_MAP:"11",VIMEO_VIDEO:"12",VINE_VIDEO:"14"},WEBPAGE_TYPES:["4","6","7"]});return i.addType("Media",s),s}),define("core/collections/MediaCollection",["backbone","core/models/Media"],function(e,t){"use strict";var n=e.Collection.extend({model:t});return n}),define("common/models",["require","jquery","underscore","backbone","modernizr","core/api","core/UniqueModel","core/models/User","core/models/Post","core/models/Thread","core/models/Forum","core/collections/MediaCollection","core/utils/url/serialize","core/utils/guid","common/utils","core/utils","common/urls","shared/urls","backbone.uniquemodel"],function(e,t,n,i,s,a,r,o,l,c,u,d,h,p,m,f,g,v){"use strict";var w=u.extend({defaults:{settings:{}},toJSON:function(){return n.extend(i.Model.prototype.toJSON.apply(this,arguments),{homeUrl:v.apps.home+"home/forums/"+this.id+"/"})}}),b=c.extend({initialize:function(t,i){c.prototype.initialize.apply(this,arguments),i=i||{};var s=this,a=e("common/collections");s.users=new a.UserCollection(i.users,{thread:s}),s.forum&&(s.moderatorList=new a.ModeratorCollection(null,{forum:s.forum.get("id")})),s.posts=new a.SubpaginatedPostCollection(i.posts,{thread:s,cursor:i.postCursor,order:i.order,perPage:f.isMobileUserAgent()?20:50}),s.votes=new a.ThreadVoteCollection,s.posts.on("add reset",function(e){e=e.models?e.models:[e],n.each(e,function(e){s.users.get(e.author.id)||s.users.add(e.author)}),s.recalculatePostCount()}),s.listenTo(s.posts,"change:isDeleted change:isFlagged",function(e,t){t&&s.incrementPostCount(-1)}),s.queue=new a.QueuedPostCollection(null,{thread:s})},recalculatePostCount:function(){var e=this.get("posts");e>50||(e=this.posts.buffer.reduce(function(e,t){return t.isPublic()?e+1:e},0),this.set("posts",e))},toJSON:function(){var e=this.get("forum"),t=n.isObject(e)?e.id:e;return n.extend(c.prototype.toJSON.apply(this,arguments),{homeUrl:v.apps.home+"home/discussions/"+t+"/"+this.get("slug")+"/"})}});c.withThreadVoteCollection.call(b.prototype,i.Collection);var y=l.extend({initialize:function(){l.prototype.initialize.apply(this,arguments);var t=e("common/collections");this.usersTyping=new t.TypingUserCollection},isAuthorSessionUser:function(e){return!!(e.user.id&&this.author&&this.author.id)&&this.author.id===e.user.id},canBeEdited:function(e,t){return!t.get("isClosed")&&!this.get("isDeleted")&&e.isLoggedIn()&&this.isAuthorSessionUser(e)&&this.get("raw_message")&&!this.get("isHighlighted")&&!this.get("isSponsored")},canBeRepliedTo:function(e,t){return!t.get("isClosed")&&e.get("canReply")&&!this.get("isDeleted")&&(this.get("isApproved")||t.isModerator(e.user))},canBeShared:function(){return!this.get("isDeleted")&&!this.get("isSponsored")},getParent:function(){var e=this.get("parent");if(e)return new r(y,{id:String(e)})}},{fetchContext:function(e,i,s){s=s||{};var o=t.Deferred();return a.call("posts/getContext.json",{method:"GET",data:{post:e},success:function(e){var t=n.filter(e.response,function(e){return e.thread===i.get("id")});return t?(n.each(t,function(e){e=new r(y,e),s.requestedByPermalink&&(e.requestedByPermalink=!0),i.posts.add(e)}),void o.resolve(t)):void o.reject()}}),o.promise()}});l.withAuthor.call(y.prototype,r.wrap(o)),l.withMediaCollection.call(y.prototype,d),r.addType("Post",y);var x=i.Model.extend({defaults:{user:null,message:null,parentId:null,immedReply:!1,createdAt:void 0},getVisibleParent:function(e){for(var t,n=this;n.get("parentId");){if(t=e.posts.get(n.get("parentId")))return t;if(n=e.queue.get(n.get("parentId")),!n)return null}return null},toPost:function(e){var t=this,n=e.posts.get(t.get("parentId")),i=n?n.get("depth")+1:0,s=new r(y,{id:t.id,thread:e.id,message:t.get("message"),parent:t.get("parentId"),depth:i,createdAt:t.get("createdAt"),isRealtime:!0,media:t.get("media"),isImmediateReply:t.get("immedReply")});return s.author=t.get("user"),s}}),_=i.Model.extend({defaults:{user:null,post:null,thread:null,client_context:null,typing:!0},idAttribute:"client_context",set:function(){return this.lastModified=new Date,i.Model.prototype.set.apply(this,arguments)},sync:function(){var e=this.toJSON(),t=h(g.realertime+"/api/typing",e);try{m.CORS.request("GET",t).send()}catch(n){}}},{make:function(e){return e.client_context||(e.client_context=p.generate()),new r(_,e)}});r.addType("TypingUser",_),n.extend(o.prototype,{getFollowing:function(){var t=e("common/collections/profile");return this.following||(this.following=new t.FollowingCollection(null,{user:this}))}}),r.addType("User",o);var C=o.extend({defaults:n.extend({numPosts:0},o.prototype.defaults)}),S=s.sessionstorage?"sessionStorage":null,k=i.UniqueModel(o,"User",S),E=i.UniqueModel(C,"User",S),T=i.Model.extend({});return{Forum:w,Thread:b,Post:y,QueuedPost:x,TypingUser:_,User:o,TopUser:C,Switch:T,SyncedUser:k,SyncedTopUser:E}}),define("core/models/Session",["jquery","underscore","backbone","moment","core/api","core/bus","core/config","core/time","core/utils","core/utils/cookies","core/utils/guid","core/utils/auth","core/models/BaseUser","core/models/User"],function(e,t,n,i,s,a,r,o,l,c,u,d,h,p){"use strict";var m=function(){return d.getFromCookie()},f=n.Model.extend({initialize:function(){this.constructor.fromCookie=t.once(m),this.user=this.getAnonUserInstance()},setUser:function(e){this.user&&this.stopListening(this.user),this.user=e,this.setIfNewUser(),this.listenTo(e,"all",this.trigger),this.trigger("change:id",e)},isLoggedOut:function(){return!this.isLoggedIn()},isLoggedIn:function(){return Boolean(this.user.get("id"))},fetch:function(e){var n=e||{};return s.call("users/details.json",{data:n.data,success:t.bind(function(e){e=e.response,e.id&&this.setUser(this.getUserInstance(e)),n.success&&n.success(e),n.complete&&n.complete(e)},this),error:function(e){n.error&&n.error(e),n.complete&&n.complete(e)}})},getAnonUserInstance:function(e){return new h(e)},getUserInstance:function(e){return new p(e)},getCsrfToken:function(){var e=c.read("csrftoken");return e||(e=u.generate().replace(/\W/g,""),c.create("csrftoken",e,{expiresIn:31536e6})),e},authenticate:function(n){var i=this.authServices[n];if(i){if(t.isFunction(i))return i.call(this);a.trigger("uiAction:openLogin",n);var s=this.getAuthWindowArgs(i),r=i.url;r+=(r.indexOf("?")>-1?"&":"?")+e.param(s),this.openAuthWindow(r,i.width,i.height)}},authServices:{disqus:{url:r.urls.login,width:460,height:355},twitter:{url:r.urls.oauth.twitter,width:650,height:680,csrf:!0},facebook:{url:r.urls.oauth.facebook,width:550,height:300,csrf:!0},google:{url:r.urls.oauth.google,width:445,height:635,csrf:!0}},getAuthWindowArgs:function(e){var n={};return e.csrf&&(n.ctkn=this.getCsrfToken()),t.extend(n,e.params),n},openAuthWindow:function(e,t,n){return l.openWindow(e,"_blank",{width:t,
height:n})},setIfNewUser:function(){var e=this.user.get("joinedAt");if(this.user.get("isAnonymous")||!e)return void this.user.set("joinedRecently",!1);var t=o.assureTzOffset(e);this.user.set("joinedRecently",i().subtract(10,"seconds").isBefore(t))}});return f.fromCookie=m,f.isKnownToBeLoggedOut=function(){return!f.fromCookie().id},f}),define("core/WindowBus",["jquery","underscore","backbone","modernizr"],function(e,t,n,i){"use strict";var s=n.Model.extend({initialize:function(){i.localstorage&&e(window).on("storage",t.bind(this.onStorageEvent,this))},broadcast:function(e,t){if(i.localstorage){var n=JSON.stringify({name:e,data:t,time:(new Date).getTime()});try{window.localStorage.setItem(this.constructor.STORAGE_KEY,n)}catch(s){return}}},onStorageEvent:function(e){var t=e.originalEvent.key,n=e.originalEvent.newValue;if(n&&t===this.constructor.STORAGE_KEY)try{n=JSON.parse(n),this.trigger(n.name,n.data)}catch(i){return}}},{STORAGE_KEY:"disqus.bus"});return s}),define("common/cached-storage",["underscore","core/utils/storage"],function(e,t){"use strict";var n=function(e,t){this.namespace=e,this.ttl=t||300,this.cache=this.getFromStorage()};return e.extend(n.prototype,{getItem:function(e){var t=this.cache[e];if(t){if(!this.isExpired(t))return t.value;delete this.cache[e]}},getCurrentTime:function(){return Math.floor((new Date).getTime()/1e3)},persist:function(){t.set(this.namespace,this.cache)},getFromStorage:function(){var n=t.get(this.namespace);return e.isObject(n)?n:{}},isExpired:function(e){return this.getCurrentTime()>e.expiry},setItem:function(e,t){this.cache[e]={value:t,expiry:this.getCurrentTime()+this.ttl},this.persist()},removeItem:function(e){delete this.cache[e],this.persist()},getAll:function(){var t=e.chain(this.cache).map(function(e,t){return this.getItem(t)},this).compact().value();return this.persist(),t}}),n}),define("common/templates",["handlebars","core/extensions/handlebars.helpers"],function(e){"use strict";function t(t,n){return e.partials[t](n||{})}function n(t){return e.partials[t]}return{render:t,getTemplate:n}}),define("lounge/views/recommend-button",["backbone","core/utils/storage","common/templates"],function(e,t,n){"use strict";var i=e.View.extend({className:"thread-likes",events:{"click [data-action=recommend]":"recommendHandler"},initialize:function(e){this.session=e.session,this.thread=e.thread,this.loggedOutRecommendFlag=this.session.getLoggedOutUserFlags().get(i.ONBOARDING_KEY),this.listenTo(this.thread,"change:userScore",this.render),this.listenTo(this.thread,"change:likes",this.render),this.listenTo(this.session,"change:id",this.startRecommendOnboarding),this.setTooltipEnabled()},setTooltipEnabled:function(){this.tooltipEnabled=this.session.isLoggedIn()?t.get(i.ONBOARDING_KEY):!this.loggedOutRecommendFlag.isRead()},render:function(){return this.$el.html(n.render("threadVotes",{thread:this.thread.toJSON(),user:this.session.toJSON(),loggedIn:this.session.isLoggedIn()})),this},startRecommendOnboarding:function(){this.session.user.get("joinedRecently")&&t.set(i.ONBOARDING_KEY,"true"),this.setTooltipEnabled()},recommendHandler:function(e){e.stopPropagation(),e.preventDefault();var t=0===this.thread.get("userScore");this.trigger(t?"vote:like":"vote:unlike"),this.thread.vote(t?1:0),this.toggleTooltip(t),this.tooltipEnabled&&t&&this.markAsSeen()},markAsSeen:function(){this.session.isLoggedIn()?t.remove(i.ONBOARDING_KEY):this.loggedOutRecommendFlag.markRead()},toggleTooltip:function(e){this.tooltipEnabled&&(e?this.$el.parent().addClass("open"):this.$el.parent().removeClass("open"))}},{ONBOARDING_KEY:"showRecommendOnboarding"});return i}),define("common/collections/LoggedOutCache",["backbone","common/cached-storage","lounge/views/recommend-button"],function(e,t,n){"use strict";var i=[{id:"welcome",title:"",body:""}],s=[{id:n.ONBOARDING_KEY}],a=new t("notes",7776e3),r=e.Model.extend({markRead:function(){a.setItem(this.id,!0)},isRead:function(){return Boolean(a.getItem(this.id))}}),o=e.Collection.extend({initialize:function(e,t){this.session=t.session},model:r,markAllRead:function(){return this.each(function(e){e.markRead()}),this.session.set("notificationCount",0),this},getUnread:function(){return this.filter(function(e){return!e.isRead()})}});return{storage:a,Collection:o,Model:r,LOGGED_OUT_NOTES:i,LOGGED_OUT_FLAGS:s}}),define("common/Session",["jquery","underscore","core/analytics/jester","core/api","core/bus","core/config","core/models/Session","core/UniqueModel","core/utils/cookies","core/utils/url/serialize","core/WindowBus","common/collections/LoggedOutCache","common/keys","common/models","common/urls","common/utils","lounge/tracking"],function(e,t,n,i,s,a,r,o,l,c,u,d,h,p,m,f,g){"use strict";var v,w=3500,b={},y=new u,x=r.extend({_defaults:{canReply:!0,canModerate:!1,audienceSyncVerified:!1,sso:null},socialLoginProviders:{facebook:function(){var t=e.Deferred();return require(["fb"],t.resolve.bind(t),t.reject.bind(t)),t.promise().then(function(t){t.init({appId:h.facebook,xfbml:!1,status:!0,version:"v2.8"});var n=e.Deferred();return t.getLoginStatus(function(e){"connected"===e.status?n.resolve(e):n.reject()}),n.promise()}).then(function(e){n.logStat("lounge.auto_login.fb");var t=e.authResponse;return{grant_type:"urn:disqus:params:oauth:grant-type:facebook-login",client_id:h.embedAPI,expires:t.expiresIn,fb_access_token:t.accessToken}})},google:function(){var t=e.Deferred();return require(["gapi"],function(e){setTimeout(t.reject.bind(t),w),e.load("auth2",t.resolve.bind(t,e))},t.reject.bind(t)),t.promise().then(function(t){var n=t.auth2.init({client_id:h.google,fetch_basic_profile:!1,scope:"profile email"}),i=e.Deferred();return n.then(function(){n.isSignedIn.get()?i.resolve(n.currentUser.get()):i.reject()}),i.promise()}).then(function(e){n.logStat("lounge.auto_login.google");var t=e.getAuthResponse();return{grant_type:"urn:disqus:params:oauth:grant-type:google-login",client_id:h.embedAPI,expires:t.expires_in,google_access_token:JSON.stringify(t)}})}},defaults:function(){var e=new d.Collection(d.LOGGED_OUT_NOTES,{session:this});return t.extend(this._defaults,{notificationCount:e.getUnread().length})},start:function(t){var n=t||{};if(this.set(n),this.listenTo(y,"auth:success",this.fetch),this.listenTo(s.frame,{"!auth:success":function(e){e&&(e.sessionId&&i.headers({"X-Sessionid":e.sessionId}),e.message&&this.trigger("alert",e.message,{type:"info"}),e.logEvent&&s.trigger("uiAction:"+e.logEvent)),y.broadcast("auth:success"),this.fetch()}}),this.bindAudienceSyncHandlers(),this.shouldFetchSession())this.fetch();else if(l.read("no_auto_login")||!g.shouldTrack(n.thread&&n.thread.forum))this.loginAsAnon();else{var a=this.socialLoginProviders,r=!1,o=0,c=e.Deferred(),u=Object.keys(a).map(function(e){return a[e].call(this)},this),d=function(e){r||(r=!0,c.resolve(e))},h=function(e){o+=1,o===u.length&&c.reject(e)};u.forEach(function(e){e.then(d).fail(h)}),c.promise().then(function(t){return e.post("https://disqus.com/api/oauth/2.0/access_token/",t)}).then(function(e){this.fetch({data:{access_token:e.access_token}})}.bind(this)).fail(this.loginAsAnon.bind(this))}},stop:function(){this.stopListening(),this.off()},loginAsAnon:function(){this.setUser(this.getAnonUserInstance())},shouldFetchSession:function(){return Boolean(this.get("remoteAuthS3")||b.fromCookie().id)},getUserInstance:function(e){return new o(p.User,e)},toJSON:function(){var e=this.user.toJSON.apply(this.user,arguments);return e.thread.canReply=this.get("canReply"),e.thread.canModerate||(e.thread.canModerate=this.get("canModerate")),e},fetch:function(e){var t=this,n=e||{};t.has("thread")&&(n.thread=t.get("thread"));var i=n.thread?t.fetchThreadDetails(n):r.prototype.fetch.call(t,n);return i.done(function(){t.set("notificationCount",0)}),i},fetchNotificationCount:function(){var t=this;return t.isLoggedIn()?i.call("timelines/getUnreadCount.json",{data:{type:"notifications",routingVersion:a.feedApiVersion}}).done(function(e){t.set("notificationCount",e.response)}):e.Deferred().resolve()},fetchThreadDetails:function(e){var n=this,s=e.thread;n._request&&(n._request.abort(),n._request=null);var a={thread:s.id,post:s.posts.pluck("id")};return n._request=i.call("embed/threadDetails.json",{data:a,success:function(e){var i=e.response,a={};i.user&&t.extend(a,i.user,{votes:i.votes}),n.set(i.session),a.id?(n.setUser(new o(p.User,a)),s.users.add(n.user),i.thread&&(s.set("userScore",i.thread.userScore),s.set("userSubscription",i.thread.userSubscription))):n.loginAsAnon(),i.blockedUsers&&t.each(i.blockedUsers,function(e){new o(p.User,{id:e}).set({isBlocked:!0})})},complete:function(){n._request=null}}),n._request},logout:function(){var e=this.get("sso");this.isSSO()&&e&&e.logout?s.frame.sendHostMessage("navigate",e.logout):this.locationReplace(c(m.logout,{redirect:window.location.href}))},locationReplace:function(e){window.location.replace(e)},isSSO:function(){return this.user&&"sso"===this.user.get("user_type")},getAuthWindowArgs:function(e){var n=r.prototype.getAuthWindowArgs.call(this,e);return t.defaults({forum:this.get("thread")&&this.get("thread").forum.id},n)},openAuthWindow:function(e,t,n){try{var i=this.get("thread"),s=i&&i.currentUrl;window.sessionStorage&&s&&window.sessionStorage.setItem("discussionUrl",s)}catch(a){}return r.prototype.openAuthWindow.call(this,e,t,n)},authServices:t.defaults({disqusDotcom:{url:m.dotcomLogin,width:478,height:590,params:{next:m.login}},sso:function(){var e=this.get("sso"),n=parseInt(e.width||"800",10),i=parseInt(e.height||"500",10),a=this.openAuthWindow(e.url,n,i);!function r(){f.isWindowClosed(a)?s.frame.sendHostMessage("reload"):t.delay(r,500)}()}},r.prototype.authServices),bindAudienceSyncHandlers:function(){this.listenTo(this,"change:id change:audienceSyncVerified",function(){this.get("audienceSyncVerified")&&s.frame.sendHostMessage("session.identify",this.user.id)}),this.listenTo(s.frame,{"!audiencesync:grant":function(){this.set("audienceSyncVerified",!0)}})},getAudienceSyncUrl:function(){var e={client_id:this.get("apiKey"),response_type:"audiencesync",forum_id:this.get("thread").forum.id};return"https:"===window.location.protocol&&(e.ssl=1),c(m.authorize,e)},audienceSync:function(){this.openAuthWindow(this.getAudienceSyncUrl(),460,355)},needsAudienceSyncAuth:function(e){return e.get("settings").audienceSyncEnabled&&this.isLoggedIn()&&!this.get("audienceSyncVerified")},getLoggedOutUserFlags:function(){return this._loggedOutUserFlags?this._loggedOutUserFlags:(this._loggedOutUserFlags=new d.Collection(d.LOGGED_OUT_FLAGS,{session:this}),this._loggedOutUserFlags)}});return t.extend(b,t.chain(x).keys().map(function(e){return[e,x[e]]}).object().value(),{get:function(){return v=v||new x},setDefaults:function(e){if(v)throw new Error("Session defaults cannot be changed after a session instance is created!");return x._defaults=t.extend(x.prototype._defaults,e),x._defaults},forget:function(){v&&(v.stop(),v=null)}}),b}),define("common/views/mixins",["jquery","underscore","core/bus","common/Session"],function(e,t,n,i){"use strict";function s(){this._getStyleProperty=function(e){var t=this.forum.get("settings");return this.config.forceAutoStyles||"auto"===t[e]?this.config[e]:t[e]},this.getTypeface=function(){return this._getStyleProperty("typeface")},this.getColorScheme=function(){return this._getStyleProperty("colorScheme")},this.applyPublisherClasses=function(){var t=e("body");"serif"===this.getTypeface()&&t.addClass("serif"),"dark"===this.getColorScheme()&&t.addClass("dark")}}var a={proxyViewEvents:function(e){this.listenTo(e,"all",function(e){0===e.indexOf("uiAction:")&&this.trigger.apply(this,arguments)},this)}},r={updateUserAvatarHelper:function(t,n){e("img[data-user="+t+'][data-role="user-avatar"]').attr("src",n)},updateUserNameHelper:function(n,i){var s='[data-username="'+n+'"][data-role=username]';e("a"+s+", span"+s).html(t.escape(i))},bindProfileUIListeners:function(e){this.listenTo(e,{"change:avatar":function(){this.updateUserAvatarHelper(e.user.id,e.user.get("avatar").cache)},"change:name":function(){this.updateUserNameHelper(e.user.get("username"),e.user.get("name"))}})}},o={toggleFollow:function(t){t.preventDefault(),t.stopPropagation();var n=t&&e(t.target).closest("a[data-user]").attr("data-user"),s=this.collection&&n?this.collection.get(n):this.user,a=i.get();return a.isLoggedOut()?(this.trigger("authenticating"),this.listenToOnce(a,"change:id",function(){a.isLoggedIn()&&this.follow(s)}),void a.authenticate("disqusDotcom")):void(s.get("isFollowing")?this.unfollow(s):this.follow(s))},unfollow:function(e){e.unfollow(),n.trigger("uiAction:unfollowUser",e)},follow:function(e){e.follow(),n.trigger("uiAction:followUser",e)}};return{FollowButtonMixin:o,UiActionEventProxy:a,appliesPublisherClasses:s,ProfileHtmlHelpers:r}}),define("core/utils/isIframed",[],function(){"use strict";return function(e){try{return e.self!==e.top}catch(t){return!0}}}),define("common/outboundlinkhandler",["jquery","underscore","core/utils","common/utils"],function(e,t,n,i){"use strict";function s(){this.handlers=[],this.locked={},this.timeout=1e3}return t.extend(s.prototype,{handleClick:function(i){var s=e(i.currentTarget),a=this.getLinkTrackingId(s);if(this.shouldHandleClick(i,s,a)){var r=t.chain(this.handlers).map(function(e){return e[0].call(e[1],i,s)}).compact().value();n.willOpenNewWindow(i,s)||(i.preventDefault(),this.setLatestClick(a),this.delayNavigation(i,s,r))}},delayNavigation:function(n,s,a){this.lockLink(this.getLinkTrackingId(s));var r=t.bind(function(){this.isLatestClick(this.getLinkTrackingId(s))&&i.triggerClick(s,n.originalEvent)},this);t.delay(r,this.timeout),e.when.apply(e,a).always(r)},registerBeforeNavigationHandler:function(e,t){this.handlers.push([e,t])},getLinkTrackingId:function(e){var n=e.attr("data-tid");return n||(n=t.uniqueId(),e.attr("data-tid",n)),n},shouldHandleClick:function(e,t){if(!this.isLinkLocked(this.getLinkTrackingId(t))){if(e.isDefaultPrevented())return!1;if(!t.is("a"))return!1;var n=/#.*/,i=(t.attr("href")||"").replace(n,"");return!!i}},setLatestClick:function(e){this.latestLinkId=e},isLatestClick:function(e){return this.latestLinkId===e},lockLink:function(e){this.locked[e]=!0},isLinkLocked:function(e){return this.locked[e]}}),s}),define("core/mixins/withEmailVerifyLink",["jquery","underscore","core/config","core/utils"],function(e,t,n,i){"use strict";var s=i.preventDefaultHandler,a={events:{"click [data-action=verify-email]":"showVerifyEmailPopup"},showVerifyEmailPopup:s(function(t){var s=e(t.target).attr("data-forum"),a=n.urls.verifyEmail;return s&&(a=a+"?f="+s),i.openWindow(a,"_blank",{width:460,height:355})})};return function(){this.events=t.defaults({},this.events,a.events),t.extend(this,t.pick(a,"showVerifyEmailPopup"))}}),define("lounge/common",[],function(){"use strict";var e,t=function(t){e=t},n=function(){return e};return{setLounge:t,getLounge:n}}),define("lounge/menu-handler",["jquery","core/bus"],function(e,t){"use strict";return{init:function(){function n(){e(".dropdown").removeClass("open")}e("html").on("click",n),e("body").delegate("[data-toggle]","click",function(t){t.stopPropagation(),t.preventDefault();var i=e(t.currentTarget),s=i.closest("."+i.attr("data-toggle")),a="disabled"!==s.attr("data-dropdown")&&!s.hasClass("open");s.attr("data-dropdown","enabled"),n(),a&&s.addClass("open")}),t.frame.on("window.click",n)}}}),define("lounge/mixins",["core/utils/url/serialize"],function(e){"use strict";var t={_sharePopup:function(e,t){return window.open(e,"_blank",t||"width=550,height=520")},share:function(e){this.sharers[e].call(this)},sharers:{twitter:function(){var t="https://twitter.com/intent/tweet",n=this.model.shortLink();this._sharePopup(e(t,{url:n,text:this.model.twitterText(n)}))},facebook:function(){this._sharePopup(e("https://www.facebook.com/sharer.php",{u:this.model.shortLink()}),"width=655,height=352")}}},n=function(){function e(){return this.collapseTarget&&this.collapseTarget.length||(this.collapseTarget=this.collapseTargetSelector?this[this.collapseScope].find(this.collapseTargetSelector):this[this.collapseScope]),this.collapseTarget}function t(){var t=this;if(t.isCollapseAllowed){var n=e.call(t);n&&n.length&&(n.height(t.collapsedHeight),s.call(t))}}function n(e){var t=this;if(t.collapseTarget&&t.collapseTarget.length){var n=t.collapseTarget;n.css("height","auto"),n.css("maxHeight","none"),a.call(t),e||(t.isCollapseAllowed=!1)}}function i(){return this.seeMoreButton&&this.seeMoreButton.length||(this.seeMoreButton=e.call(this).siblings("[data-action=see-more]")),this.seeMoreButton}function s(){var e=this;i.call(this).removeClass("hidden").on("click",function(){e.expand()})}function a(){i.call(this).addClass("hidden").off("click")}return function(e){var i=this;i.isCollapseAllowed=!0,i.collapsedHeight=e.collapsedHeight,i.collapseTargetSelector=e.collapseTargetSelector,i.collapseScope=e.collapseScope||"$el",i.collapse=t,i.expand=n}}();return{ShareMixin:t,asCollapsible:n}}),define("lounge/realtime",["underscore","backbone","loglevel","remote/config","core/utils/url/serialize","common/utils","common/urls"],function(e,t,n,i,s,a,r){"use strict";function o(){w.apply(this,arguments),this.marker=0,this.interval=h,this._boundOnError=e.bind(this.onError,this),this._boundOnLoad=e.bind(this.onLoad,this),this._boundOnProgress=e.bind(this.onProgress,this)}function l(){w.apply(this,arguments),this.handshakeSuccess=null,this.interval=h,this.handshakeFails=0,this._boundOnOpen=e.bind(this.onOpen,this),this._boundError=e.bind(this.onError,this),this._boundClose=e.bind(this.onClose,this),this._boundMessage=e.compose(e.bind(this.onMessage,this),function(e){return JSON.parse(e.data)})}var c=i.lounge.REALTIME||{},u=c.EXP_BASE||2,d=c.BACKOFF_LIMIT||300,h=c.BACKOFF_INTERVAL||1,p=c.MAX_HANDSHAKE_FAILS||1,m=c.WEBSOCKETS_ENABLED!==!1&&window.WebSocket&&2===window.WebSocket.CLOSING,f=c.XHR_ENABLED!==!1,g=function(){},v=function(){throw new Error("Pipe class cannot be used directly.")},w=function(t){this.channel=t,this.connection=null,this.paused=!1,this._msgBuffer=[],this._boundOpen=e.bind(this.open,this)};e.extend(w.prototype,t.Events,{getUrl:function(t){var n={};return e.extend(n,t),s(this.baseUrl+this.channel,n)},onMessage:function(e){var t=e.message_type,i=e.firehose_id;this.lastEventId=i,n.debug("RT: new message:",t,i);var s={type:t,data:e.message_body,lastEventId:i};this.trigger(t,s)},_msgToBuffer:function(){this._msgBuffer.push(e.toArray(arguments))},pause:function(e){this.paused||(this.paused=!0,this._trigger=this.trigger,this.trigger=e===!1?g:this._msgToBuffer,n.debug("RT: paused, buffered: %s",e!==!1))},resume:function(){if(this.paused){this.paused=!1,this.trigger=this._trigger,n.debug("RT: resumed, buffered messages: %s",this._msgBuffer.length);for(var e;e=this._msgBuffer.shift();)this.trigger.apply(this,e)}},open:v,close:function(){var e=this.connection;return!!e&&(this.connection=null,e)}}),e.extend(o.prototype,w.prototype,{baseUrl:r.realertime+"/api/2/",onError:function(){this.connection&&(this.connection=null,this.trigger("error",this),this.interval<=d&&(this.interval*=u),n.info("RT: Connection error, backing off %s secs",this.interval),e.delay(this._boundOpen,1e3*this.interval))},onLoad:function(){this.connection&&(this.connection=null,this.trigger("success",this),e.defer(this._boundOpen))},onProgress:function(){if(this.connection){var e,t,i,s,a=this.connection.responseText,r=0;if(a&&!(this.marker>=a.length)){e=a.slice(this.marker).split("\n");for(var o=e.length,l=0;o>l;l++)if(t=e[l],r+=t.length+1,i=t.replace(/^\s+|\s+$/g,"")){try{s=JSON.parse(i)}catch(c){if(l===o-1){r-=t.length+1;break}n.debug("RT: unable to parse: ",i,t);continue}this.onMessage(s)}else n.debug("RT: ignoring empty row...");r>0&&(this.marker+=r-1)}}},open:function(){this.close();var e=this.connection=a.CORS.request("GET",this.getUrl(),this._boundOnLoad,this._boundOnError);if(!e)return void n.debug("RT: Cannot use any cross-domain request tool with StreamPipe. Bailing out.");e.onprogress=this._boundOnProgress,this.connection=e,this.marker=0;try{e.send()}catch(t){this.connection=null,n.debug("RT: Attempt to send a CORS request failed.")}},close:function(){var e=w.prototype.close.apply(this);return e&&e.abort()}}),e.extend(l.prototype,w.prototype,{baseUrl:"wss:"+r.realertime+"/ws/2/",onOpen:function(){n.debug("RT: [Socket] Connection established."),this.handshakeSuccess=!0},onError:function(){if(!this.handshakeSuccess){if(this.handshakeFails>=p)return n.debug("RT: [Socket] Error before open, bailing out."),void this.trigger("fail");this.handshakeFails+=1}this.connection&&(this.connection=null,this.trigger("error"),this.interval<=d&&(this.interval*=u),n.error("RT: Connection error, backing off %s secs",this.interval),e.delay(this._boundOpen,1e3*this.interval))},onClose:function(e){if(this.connection){if(!e.wasClean)return this.onError();this.connection=null,n.debug("RT: [Socket] Connection closed. Restarting..."),this.trigger("close"),this.open()}},open:function(){this.close();try{this.connection=new window.WebSocket(this.getUrl())}catch(e){return this.onError()}var t=this.connection;t.onopen=this._boundOnOpen,t.onerror=this._boundError,t.onmessage=this._boundMessage,t.onclose=this._boundClose},close:function(){var e=w.prototype.close.apply(this);return e&&e.close()}});var b={_wsSupported:m,initialize:function(t,n,i){this.close(),this._initArgs=[t,n,i];var s=this._wsSupported,a=s&&l||f&&o;if(a){var r=this.pipe=new a(t);e.chain(n).pairs().each(function(e){r.on(e[0],e[1],i)}),s&&r.on("fail",function(){this._wsSupported=!1,r.off(),this.initialize.apply(this,this._initArgs)},this),r.open()}},pause:function(e){this.pipe&&this.pipe.pause(e)},resume:function(){this.pipe&&this.pipe.resume()},close:function(){this.pipe&&(this.pipe.close(),this.pipe=null)}};return window.addEventListener("unload",e.bind(b.close,b)),{Pipe:w,StreamPipe:o,SocketPipe:l,Manager:b,MAX_HANDSHAKE_FAILS:p}}),define("host/common/apps/BaseApp",["require","core/Events","core/utils/object/extend","core/utils/object/has","core/utils/uniqueId"],function(e){"use strict";var t=e("core/Events"),n=e("core/utils/object/extend"),i=e("core/utils/object/has"),s=e("core/utils/uniqueId"),a=function(e){this.uid=s("dsq-app"),this.settings=e||{};var t=[],n=this.constructor.prototype;do t.unshift(n),n=n.constructor.__super__;while(n);for(var a=0,r=t.length;r>a;a++)n=t[a],i(n,"events")&&this.on(n.events,this),i(n,"onceEvents")&&this.once(n.onceEvents,this)};return n(a.prototype,t),a.prototype.destroy=function(){this.off(),this.stopListening()},a.extend=function(e,t){var s,a=this;s=e&&i(e,"constructor")?e.constructor:function(){return a.apply(this,arguments)},n(s,a,t);var r=function(){this.constructor=s};return r.prototype=a.prototype,s.prototype=new r,e&&n(s.prototype,e),s.__super__=a.prototype,s},a}),define("core/utils/lang/isString",[],function(){"use strict";return function(e){return"[object String]"===Object.prototype.toString.call(e)}}),define("core/utils/html/setInlineStyle",["require","core/utils/collection/each","core/utils/lang/isString","core/utils/object/extend"],function(e){"use strict";function t(e){return e.replace(/\s+/g,"").toLowerCase()}var n=e("core/utils/collection/each"),i=e("core/utils/lang/isString"),s=e("core/utils/object/extend");return function(e,a,r){var o={};i(a)?o[a]=r:o=a;var l=s({},o);n(l,function(e,n){var i=t(n);i!==n&&(delete l[n],l[i]=e),null===e&&(l[i]=""),void 0===e&&delete l[i]});var c=e.style;n(l,function(e,t){c.setProperty(t,String(e),"important")})}}),define("common/kernel/utils",["require"],function(e){"use strict";function t(e){return s.getElementById(e)||s.body||s.documentElement}function n(e){return a.href=e,a.hostname}function i(e,t){t=t||s.documentElement;for(var n=e,i=0,a=0;n&&n!==t;)i+=n.offsetLeft,a+=n.offsetTop,n=n.offsetParent;return{top:a,left:i,height:e.offsetHeight,width:e.offsetWidth}}var s=window.document,a=s.createElement("a");return{getContainer:t,getHost:n,getOffset:i}}),define("host/common/globalFromSandbox",["require"],function(e){"use strict";var t=window.document,n=t.createElement("iframe");return n.style.display="none",t.body.appendChild(n),function(e){try{return n.contentWindow[e]||window[e]}catch(t){return window[e]}}}),define("host/common/json",["require","host/common/globalFromSandbox"],function(e){"use strict";var t,n=e("host/common/globalFromSandbox");return t="[object JSON]"===window.Object.prototype.toString.call(window.JSON)?window.JSON:n("JSON"),t?t:{}}),define("common/kernel/WindowBase",["require","core/Events","core/utils/object/extend","core/utils/uniqueId","common/kernel/utils","host/common/json"],function(e){"use strict";var t=e("core/Events"),n=e("core/utils/object/extend"),i=e("core/utils/uniqueId"),s=e("common/kernel/utils"),a=e("host/common/json"),r=function(e){e=e||{},this.state=r.INIT,this.uid=e.uid||i("dsq-frame"),this.origin=e.origin,this.host=s.getHost(this.origin),this.target=e.target,this.sandbox=e.sandbox,this.window=null,r.windows[this.uid]=this,this.on("ready",function(){this.state=r.READY},this),this.on("die",function(){this.state=r.KILLED},this)};return n(r,{INIT:0,READY:1,KILLED:2,windows:{},postMessage:function(e,t,n){return e.postMessage(t,n)}}),n(r.prototype,t),r.prototype.requiresWindow=function(e){var t=this;return function(){var n=Array.prototype.slice.call(arguments),i=function(){var s=t.window;s?e.apply(t,n):setTimeout(i,500)};t.isReady()?i():t.on("ready",i)}},r.prototype.sendMessage=function(e,t){var n=a.stringify({scope:"client",name:e,data:t});this.requiresWindow(function(e){r.postMessage(this.window,e,this.origin)})(n)},r.prototype.hide=function(){},r.prototype.show=function(){},r.prototype.url=function(){return this.target},r.prototype.destroy=function(){this.state=r.KILLED,this.off()},r.prototype.isReady=function(){return this.state===r.READY},r.prototype.isKilled=function(){return this.state===r.KILLED},r}),define("common/kernel/Iframe",["require","core/utils/html/setInlineStyle","core/utils/object/extend","common/kernel/WindowBase","common/kernel/utils"],function(e){"use strict";var t=e("core/utils/html/setInlineStyle"),n=e("core/utils/object/extend"),i=e("common/kernel/WindowBase"),s=e("common/kernel/utils"),a=window.document,r=function(e){i.call(this,e),this.styles=e.styles||{},this.tabIndex=e.tabIndex||0,this.title=e.title||"Disqus",this.sandbox=e.sandbox,this.container=e.container,this.elem=null};return n(r.prototype,i.prototype),r.prototype.load=function(){var e=this.elem=a.createElement("iframe");e.setAttribute("id",this.uid),e.setAttribute("name",this.uid),e.setAttribute("allowTransparency","true"),e.setAttribute("frameBorder","0"),e.setAttribute("scrolling","no"),this.role&&e.setAttribute("role",this.role),e.setAttribute("tabindex",this.tabIndex),e.setAttribute("title",this.title),"string"==typeof this.sandbox&&e.setAttribute("sandbox",this.sandbox),this.setInlineStyle(this.styles)},r.prototype.getOffset=function(e){return s.getOffset(this.elem,e)},r.prototype.setInlineStyle=function(e,n){return t(this.elem,e,n)},r.prototype.removeInlineStyle=function(e){var t=this.elem.style;return"removeProperty"in t?void t.removeProperty(e):void(t[e]="")},r.prototype.hide=function(){this.setInlineStyle("display","none")},r.prototype.show=function(){this.removeInlineStyle("display")},r.prototype.destroy=function(){return this.elem&&this.elem.parentNode&&(this.elem.parentNode.removeChild(this.elem),this.elem=null),i.prototype.destroy.call(this)},r}),define("host/common/kernel",["require","exports","module","core/Events","core/utils/lang/isString","core/utils/object/has","core/utils/object/extend","common/kernel/Iframe","common/kernel/WindowBase","common/kernel/utils","host/common/json","core/utils/function/throttle"],function(e,t){"use strict";var n=e("core/Events"),i=e("core/utils/lang/isString"),s=e("core/utils/object/has"),a=e("core/utils/object/extend"),r=e("common/kernel/Iframe"),o=e("common/kernel/WindowBase"),l=e("common/kernel/utils"),c=e("host/common/json"),u=window.document;t.throttle=e("core/utils/function/throttle"),window.addEventListener("message",function(e){var t;try{t=c.parse(e.data)}catch(n){return}var i=t.sender,a=s(o.windows,i)&&o.windows[i];a&&l.getHost(e.origin)===a.host&&(e.origin!==a.origin&&(a.origin=e.origin),"host"===t.scope&&a.trigger(t.name,t.data))}),window.addEventListener("hashchange",function(){t.trigger("window.hashchange",{hash:window.location.hash})}),window.addEventListener("resize",t.throttle(function(){t.trigger("window.resize")},250,50)),u.addEventListener("mousemove",t.throttle(function(){t.trigger("window.mousemove")},250,50));var d=function(){t.trigger("window.scroll")};window.addEventListener("scroll",t.throttle(d,250,50),!1),u.addEventListener("click",function(){t.trigger("window.click")});var h=t.Popup=function(e){e.uid=e.windowName,o.call(this,e)};a(h.prototype,o.prototype),h.prototype.load=function(){var e=this.window=window.open("",this.uid||"_blank");e.location=this.url()},h.prototype.isKilled=function(){return o.prototype.isKilled()||this.window.closed};var p=t.Channel=function(e){var t=this;t.window=null,r.call(t,e),this.insertBeforeEl=e.insertBeforeEl,this.insertAfterEl=e.insertAfterEl,t.styles=a({width:"1px","min-width":"100%",border:"none",overflow:"hidden",height:"0"},e.styles||{})};a(p.prototype,r.prototype),p.prototype.load=function(e){var t=this;r.prototype.load.call(t);var n=t.elem;n.setAttribute("width","100%"),n.setAttribute("src",this.url()),n.addEventListener("load",function(){t.window=n.contentWindow,e&&e()});var s=i(t.container)?l.getContainer(t.container):t.container,a=(t.insertAfterEl?t.insertAfterEl.nextSibling:t.insertBeforeEl)||null;s.insertBefore(n,a)},p.prototype.destroy=function(){return this.window=null,r.prototype.destroy.call(this)},t.on=n.on,t.off=n.off,t.trigger=n.trigger}),define("host/common/apps/WindowedApp",["require","core/utils/object/extend","shared/urls","host/common/apps/BaseApp","host/common/kernel"],function(e){"use strict";var t=e("core/utils/object/extend"),n=e("shared/urls"),i=e("host/common/apps/BaseApp"),s=e("host/common/kernel"),a=window.document,r=i.extend({name:null,loaderVersion:null,frame:null,origin:n.ensureHTTPSProtocol("https://disqus.com"),state:null,getUrl:function(e,i){return e=this.loaderVersion?t({version:this.loaderVersion},e):t({disqus_version:this.settings.version},e),n.ensureHTTPSProtocol(n.get(this.name,e,i))},getFrameSettings:function(){var e={target:this.getUrl(),origin:this.origin,uid:this.uid,sandbox:this.sandbox},t=this.settings;return t.windowName?e.windowName=t.windowName:e.container=t.container||a.body,e},getFrame:function(){var e=this.getFrameSettings(),t=e.windowName?s.Popup:s.Channel;return new t(e)},setState:function(e){var t=this.constructor;return e in t.states&&(this.state=t.states[e],void this.trigger("state:"+e))},init:function(){var e,t=this;t.frame=e=this.getFrame(),t.listenTo(e,"all",function(n,i){t.trigger("frame:"+n,i,e)}),t.trigger("change:frame",e),t.frame.load(function(){t.setState("LOADED")}),t.setState("INIT")},destroy:function(){var e=this.frame;e&&(this.stopListening(e),e.destroy()),this.setState("KILLED"),this.frame=null,i.prototype.destroy.call(this)},events:{"frame:ready":function(){this.setState("READY")}}},{states:{INIT:0,LOADED:1,READY:2,RUNNING:3,KILLED:4}});return r}),define("core/utils/OnceTimer",["require","exports","module"],function(e,t,n){"use strict";n.exports=function(e,t){var n=null,i=!1;this.start=function(){i||(n=setTimeout(function(){i=!0,e()},t))},this.clear=function(){clearTimeout(n)}}}),define("core/utils/html/toHexColorString",[],function(){"use strict";function e(e){if(e=Number(e),isNaN(e)||e>255)throw new Error("Color components should be numbers less than 256");return e=e.toString(16),1===e.length?"0"+e:String(e)}return function(t){return"#"+e(t.red)+e(t.green)+e(t.blue)}}),define("core/utils/sandbox",[],function(){"use strict";var e=["allow-forms","allow-pointer-lock","allow-popups","allow-same-origin","allow-scripts","allow-top-navigation"],t=function(t){return t?e.reduce(function(e,n){
return t[n]&&(e+=n+" "),e},"").trim():""};return{getAttribute:t}}),define("core/utils/url/parseQueryString",["core/utils/collection/each"],function(e){"use strict";return function(t){"undefined"==typeof t&&(t=window.location.search);var n={};return e(t.substr(1).split("&"),function(e){var t=e.split("=").map(function(e){return decodeURIComponent(e.replace(/\+/g,"%20"))});t[0]&&(n[t[0]]=t[1])}),n}}),define("common/analytics/reporting",["require","core/utils/url/serialize"],function(e){"use strict";function t(e){var t=e.split("."),n=t.length>2?t[t.length-2]:"";return n.match(/^[0-9a-f]{32}$/i)&&n}function n(e){(new window.Image).src=s(a+"/stat.gif",{event:e})}function i(e){(new window.Image).src=s(a+"/event.gif",e)}var s=e("core/utils/url/serialize"),a="https://referrer.disqus.com/juggler";return{getLoaderVersionFromUrl:t,logStat:n,reportJester:i}}),define("lounge/ads/ads",["require","host/common/apps/WindowedApp","host/common/json","stance/main","stance/utils","core/utils/OnceTimer","core/utils/html/toHexColorString","core/utils/object/extend","core/utils/sandbox","core/utils/url/parseQueryString","core/utils/url/serialize","core/utils/urls","core/utils/urls","common/main","common/analytics/reporting","common/kernel/WindowBase"],function(e){"use strict";var t=e("host/common/apps/WindowedApp"),n=e("host/common/json"),i=e("stance/main"),s=e("stance/utils"),a=e("core/utils/OnceTimer"),r=e("core/utils/html/toHexColorString"),o=e("core/utils/object/extend"),l=e("core/utils/sandbox"),c=e("core/utils/url/parseQueryString"),u=e("core/utils/url/serialize"),d=e("core/utils/urls").getOrigin,h=e("core/utils/urls").getQuery,p=e("common/main"),m=e("common/analytics/reporting"),f=e("common/kernel/WindowBase"),g={adsnative:160465,prebid:160465,displayonly:160465,displaywide:160465,displaydoublewide:160465,gravity:184723,taboola:184193,outbrain:185359},v=t.extend({name:"ads",origin:void 0,onceEvents:{"view:enter":function(){this._report({verb:"view",adverb:"0ms-no50perc"})},"view:iab":function(){this._report({verb:"view",adverb:"iab-scroll"})}},events:{"frame:ready":function(e){this.forumId=e.forumId,this._reportOnce({verb:"load",extra_data:e.extraData},"load"),this.bindViewEvents()},"frame:resize":function(e){this.frame.setInlineStyle("height",e.height+"px")},"frame:click":function(){this._reportOnce({verb:"click"},"click")},"frame:error-provider-not-ready":function(){this._report({verb:"fail",object_type:"provider",object_id:this.getProvider(),adverb:"provider_not_ready"})},"frame:error-no-height":function(){this._report({verb:"fail",object_type:"provider",object_id:this.getProvider(),adverb:"no_height"})}},constructor:function(){t.apply(this,arguments),this.origin=d(this.settings.adUrl),this._reportOnceHistory={}},init:function(){if(!this.settings.isHostIframed&&(this.settings.forum=c(h(this.settings.adUrl)).shortname,this.settings.forum)){var e=this.settings.discovery;(this.settings.isInHome||!e||!e.disable_all&&!e.disable_promoted)&&(this._reportOnce({verb:"call",object_type:"provider",object_id:this.getProvider(),adjective:1},"call"),this.settings.sandboxAds&&(this.sandbox=l.getAttribute({"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0,"allow-popups":!0})),t.prototype.init.call(this))}},getProvider:function(){if(this._provider)return this._provider;var e=this.settings.adUrl.match(/provider=(\w+)/);return e&&(this._provider=e[1]),this._provider},getUrl:function(){var e=this.settings;return u(e.adUrl,{anchorColor:r(e.anchorColor),colorScheme:e.colorScheme,sourceUrl:e.referrer,typeface:e.typeface,canonicalUrl:e.canonicalUrl,disqus_version:e.version})},bindViewEvents:function(){if(!this._viewEventsBound){this._viewEventsBound=!0;var e=this,t=function(t,n){e.postMessageDirect({event:t,percentViewable:n})},n=1e3,r=new a(function(){e.trigger("view:iab"),t("view:iab")},n),o=!1;this.listenTo(i({el:this.frame.elem}),{enter:function(){e.trigger("view:enter"),t("view:enter")},exit:function(){t("view:exit"),o&&(o=!1,t("view:50out"),r.clear())},visible:function(e,n){var i=s.visiblePercent(n,e.offset());i>=50&&!o?(o=!0,t("view:50in"),r.start()):50>i&&o&&(o=!1,t("view:50out"),r.clear()),t("view",i)}})}},postMessageDirect:function(e){this.frame.requiresWindow(function(e){var t=n.stringify(o({},e,{space:"disqus"}));f.postMessage(this.window,t,this.origin),f.postMessage(this.window,"disqus."+e.event,this.origin)})(e)},_report:function(e){var t=this.settings,n=this.getProvider(),i=g[n];e.forum_id=t.forumId||this.forumId,m.reportJester(o({imp:t.impressionId,experiment:t.experiment.experiment,variant:t.experiment.variant,service:t.experiment.service,bin:"embed:promoted_discovery:"+t.experiment.service+":"+t.experiment.experiment+":"+t.experiment.variant,area:t.placement,product:"embed",forum:t.forum,zone:"thread",version:p.version,page_url:t.referrer,page_referrer:t.hostReferrer,object_type:"advertisement",object_id:"["+i+"]",provider:n,advertisement_id:i,ad_product_name:"iab_display",ad_product_layout:"iab_display",event:"activity",section:"default"},e))},_reportOnce:function(e,t){this._reportOnceHistory[t]||(this._report(e),this._reportOnceHistory[t]=!0)},getFrameSettings:function(){var e=t.prototype.getFrameSettings.call(this);return e.insertBeforeEl=this.settings.insertBeforeEl,e.insertAfterEl=this.settings.insertAfterEl,e}}),w=function(e){return new v(e)};return{Ads:w}}),define("core/utils/media/upload",["underscore","when","exports","core/api","core/models/Media","core/UniqueModel"],function(e,t,n,i,s,a){"use strict";n.uploadSupported=Boolean(window.FormData),n._extractFirstImageFile=function(t){return e.find(t,function(e){return e.type.match(/^image\//)})},n._uploadViaApi=function(e,n,s){return t(i.call(e,{data:n,contentType:!1,processData:!1,method:"POST",xhr:function(){var e=new window.XMLHttpRequest,t=s&&s.onProgress;return t&&e.upload.addEventListener("progress",function(e){e.total&&t(100*e.loaded/e.total)}),e}}))},n.UPLOAD_URL="https://uploads.services.disqus.com/api/3.0/media/create.json",n.uploadMediaUrl=function(i,r){var o,l=new window.FormData,c=n._extractFirstImageFile(i);return c?(l.append("upload",c),l.append("permanent",1),n._uploadViaApi(n.UPLOAD_URL,l,r).then(function(t){var n=t.response,i=e.first(e.values(n));if(!i||!i.ok)throw o=new Error("Upload failed"),o.code=i&&i["error-code"],o;return new a(s,{mediaType:s.MEDIA_TYPES.IMAGE_UPLOAD,url:i.url,thumbnailUrl:i.url})},function(e){if(e.responseJSON&&4===e.responseJSON.code)throw o=new Error("Upload failed"),o.code="not-authenticated",o;throw e})):(o=new Error("No image file to upload"),o.code="invalid-content-type",t.reject(o))}}),define("core/views/media/DragDropUploadView",["underscore","backbone","core/utils"],function(e,t,n){"use strict";var i=n.stopEventHandler,s=t.View.extend({events:{dragover:"_dragOn",dragenter:"_dragOn",dragleave:"_dragOff",dragexit:"_dragOff",drop:"_drop"},_dragOn:i(function(){this.trigger("uploader:dragEnter"),this._toggleDragPlaceholder(!0)}),_dragOff:i(function(){this._toggleDragPlaceholder(!1)}),_drop:i(function(e){this._toggleDragPlaceholder(!1);var t=e.originalEvent.dataTransfer.files;return t.length?void this.trigger("uploader:attachMedia",t):void this.trigger("uploader:dropError","No files")}),_toggleDragPlaceholder:e.throttle(function(e){e?this.trigger("uploader:showPlaceholder"):this.trigger("uploader:hidePlaceholder")},50)});return s}),define("core/templates/postMediaUploadButton",["handlebars","core/templates/handlebars.partials","core/extensions/handlebars.helpers"],function(e){return e.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return'<a href="#" tabindex="-1" data-action="attach" class="attach" title="'+r(n.gettext.call(a,"Upload Images",{name:"gettext",hash:{},data:s}))+'"><span>'+r(n.gettext.call(a,"Attach",{name:"gettext",hash:{},data:s}))+'</span></a>\n<input type="file" data-role="media-upload" tabindex="-1" accept="image/*">\n'},useData:!0})}),define("core/views/media/UploadButtonView",["jquery","backbone","core/templates/postMediaUploadButton","core/utils"],function(e,t,n,i){"use strict";var s=i.stopEventHandler,a="input[type=file][data-role=media-upload]",r=t.View.extend({events:function(){var e={"click [data-action=attach]":"_attachMedia"};return e["change "+a]="_selectorChange",e}(),initialize:function(e){this.template=e&&e.template||n},render:function(){return this.$el.html(this.template()),this},_attachMedia:s(function(){this.$(a).click()}),_selectorChange:function(t){var n=t.target,i=n.files;i.length&&(this.trigger("uploader:attachMedia",i),e(n).replaceWith(n.cloneNode()))}});return r}),define("core/templates/postMediaUploadProgress",["handlebars","core/templates/handlebars.partials","core/extensions/handlebars.helpers"],function(e){return e.template({1:function(e,t,n,i,s){return'<li>\n<div class="media-progress-box">\n<div class="media-progress">\n<div class="bar" style="right: '+e.escapeExpression(e.lambda(null!=t?t.remainingPerc:t,t))+'%"></div>\n</div>\n</div>\n</li>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a;return null!=(a=n.each.call(null!=t?t:{},null!=t?t.collection:t,{name:"each",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?a:""},useData:!0})}),define("core/views/media/UploadsProgressSubView",["backbone","core/templates/postMediaUploadProgress"],function(e,t){"use strict";var n=e.View.extend({initialize:function(){this.collection=new e.Collection,this.listenTo(this.collection,"add remove change",this.render)},hasVisible:function(){return Boolean(this.collection.length)},render:function(){return this.$el.html(t({collection:this.collection.toJSON()})),this}});return n}),define("core/templates/postMediaUploadRich",["handlebars","core/templates/handlebars.partials","core/extensions/handlebars.helpers"],function(e){return e.template({1:function(e,t,n,i,s){var a;return e.escapeExpression(e.lambda(null!=(a=null!=t?t.media:t)?a.title:a,t))},3:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"Media attachment",{name:"gettext",hash:{},data:s}))},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<li class="publisher-border-color">\n<div class="media-box">\n<div class="media-ct">\n<div class="media-surface">\n<a href="'+o(r(null!=(a=null!=t?t.media:t)?a.url:a,t))+'" target="_blank">\n<img src="'+o(r(null!=(a=null!=t?t.media:t)?a.thumbnailUrl:a,t))+'" alt="'+(null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.media:t)?a.title:a,{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.program(3,s,0),data:s}))?a:"")+'">\n</a>\n</div>\n</div>\n</div>\n</li>\n'},useData:!0})}),define("core/views/media/UploadsRichSubView",["underscore","backbone","core/models/Media","core/UniqueModel","core/utils","core/templates/postMediaUploadRich"],function(e,t,n,i,s,a){"use strict";var r=t.View.extend({initialize:function(){this._hasVisible=!1,this.collection=new t.Collection([],{model:n,comparator:"index"}),this.listenTo(this.collection,"add remove reset sort change:thumbnailUrl change:mediaType change:editsFinished",this.render),this.listenTo(this.collection,"change:index",e.bind(this.collection.sort,this.collection))},render:function(){return this.$el.empty(),this._hasVisible=!1,this.collection.each(function(t){t.get("thumbnailUrl")&&(e.contains(n.WEBPAGE_TYPES,t.get("mediaType"))||t.get("editsFinished")&&(this.$el.append(a({media:t.toJSON()})),this._hasVisible=!0))},this),this},hasVisible:function(){return this._hasVisible},addMedia:function(e){var t=i.get(n,e.url);if(t)t.set(e);else{if(!e.editsFinished)return;t=new i(n,e),t.fetch()}return this.collection.add(t),t},updateFromText:function(t,n,i){if(!t)return void this.collection.reset();var a=s.bleachFindUrls(t);a=e.uniq(a,!1,function(e){return e.url});var r={};e.each(a,function(s){r[s.url]=!0;var a=e.pick(s,"index","url"),o=s.index<n&&n<=s.endIndex||"."===t[s.endIndex];(!o||i.isPasteEvent)&&(a.editsFinished=!0),this.addMedia(a)},this);var o=this.collection.pluck("url");r=e.keys(r);var l=e.difference(o,r);this.collection.remove(this.collection.filter(function(t){return e.contains(l,t.get("url"))}))}});return r}),define("core/templates/postMediaUploads",["handlebars","core/templates/handlebars.partials","core/extensions/handlebars.helpers"],function(e){return e.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){return'<ul data-role="media-progress-list"></ul>\n<ul data-role="media-rich-list"></ul>\n<div class="media-expanded empty" data-role="media-preview-expanded">\n<img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="\ndata-role="media-preview-expanded-image" alt="'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Media preview placeholder",{name:"gettext",hash:{},data:s}))+'">\n</div>\n'},useData:!0})}),define("core/views/media/UploadsView",["backbone","core/views/media/UploadsProgressSubView","core/views/media/UploadsRichSubView","core/templates/postMediaUploads"],function(e,t,n,i){"use strict";var s=e.View.extend({initialize:function(){this.richView=new n,this.rich=this.richView.collection,this.uploadProgressView=new t,this.uploadProgress=this.uploadProgressView.collection,this.listenTo(this.rich,"all",this._updateEmpty),this.listenTo(this.uploadProgress,"all",this._updateEmpty)},render:function(){return this.richView.$el.detach(),this.uploadProgressView.$el.detach(),this.$el.html(i()),this._updateEmpty(),this.richView.setElement(this.$("[data-role=media-rich-list]")[0]),this.uploadProgressView.setElement(this.$("[data-role=media-progress-list]")[0]),this},clear:function(){this.rich.reset(),this.uploadProgress.reset()},_updateEmpty:function(){this.richView.hasVisible()||this.uploadProgressView.hasVisible()?this.$el.removeClass("empty"):this.$el.addClass("empty")}});return s}),define("core/mixins/withUploadForm",["underscore","backbone","core/strings","core/utils","core/utils/media/upload","core/utils/storage","core/views/media/DragDropUploadView","core/views/media/UploadButtonView","core/views/media/UploadsView"],function(e,t,n,i,s,a,r,o,l){"use strict";var c=n.get,u=function(){e.defaults(this,u.bothProto,u.uploadsProto,u.previewsProto)},d={"invalid-image-file":c("Unfortunately your image upload failed. Please verify that the file is valid and in a supported format (JPEG, PNG, or GIF)."),"invalid-content-type":c("Unfortunately your image upload failed. Please verify that the file is in a supported format (JPEG, PNG, or GIF)."),"file-too-large":c("Unfortunately your image upload failed. Please verify that your image is under 5MB."),"not-authenticated":c("You must be logged in to upload an image.")},h=c("Unfortunately your image upload failed. Please verify that your image is in a supported format (JPEG, PNG, or GIF) and under 5MB. If you continue seeing this error, please try again later.");return u.previewsProto={initMediaPreviews:function(t,n){this.mediaUploadsView=new l({el:t[0]}),this.mediaUploadsView.render(),this.updateLiveMediaDebounced=e.partial(e.debounce(this.updateLiveMedia,500),n,!1),this.listenTo(n,{keychange:this.updateLiveMediaDebounced,paste:function(t,i){i&&i.fake||e.defer(e.bind(this.updateLiveMedia,this,n,!0))}}),this.updateLiveMedia(n,!0)},clearMediaPreviews:function(){this.mediaUploadsView&&this.mediaUploadsView.clear()},updateLiveMedia:function(e,t){if(this.mediaUploadsView){var n=e.get(),i=e.offset();this.mediaUploadsView.richView.updateFromText(n,i,{isPasteEvent:t})}}},u.uploadsProto={initMediaUploads:function(e,t,n){this.mediaDragDropView=new r({el:t[0]}),this.listenTo(this.mediaDragDropView,{"uploader:attachMedia":function(){a.set("usedDragDrop",1),this.handleAttachMedia.apply(this,arguments)},"uploader:dragEnter":function(){this.$el.addClass("expanded")},"uploader:showPlaceholder":function(){e.show()},"uploader:hidePlaceholder":function(){e.hide()},"uploader:dropError":function(){var e=c("Sorry we didn't catch that. Try again?");this.alert(e,{type:"error",isUploadError:!0})}}),this.mediaUploadButtonView=new o({el:n[0]}),this.listenTo(this.mediaUploadButtonView,{"uploader:attachMedia":this.handleUploadViaButton}),this.mediaUploadButtonView.render()},handleUploadViaButton:function(e){if(e&&a.isPersistent&&!a.get("usedDragDrop")&&!i.isMobileUserAgent()){var t=this.alert(c("Did you know you can drag and drop images too? Try it now!"));this.listenToOnce(t,"dismiss",function(){a.set("usedDragDrop",1)})}this.handleAttachMedia.apply(this,arguments)},handleAttachMedia:function(n,i){var a=this,r=new t.Model({remainingPerc:100});a.mediaUploadsView.uploadProgress.add(r),i=e.extend(i||{},{onProgress:function(e){r.set("remainingPerc",100-e)}}),s.uploadMediaUrl(n,i).then(function(e){e.fetch(),a.textarea.insertAtCursor(e.get("url")),a.updateLiveMedia(a.textarea,!0),a.dismissUploadError()}).otherwise(function(e){var t;e&&e.code&&(t=d[e.code]),t||(t=h),a.alert(t,{type:"error",isUploadError:!0})}).always(function(){a.mediaUploadsView.uploadProgress.remove(r)})},dismissUploadError:function(){this.dismissAlert(function(e){return e.options&&e.options.isUploadError})},uploadSupported:s.uploadSupported,isUploadInProgress:function(){return this.mediaUploadsView&&this.mediaUploadsView.uploadProgress.length}},u.bothProto={initMediaViews:function(e){e.allowMedia&&this.initMediaPreviews(this.$("[data-role=media-preview]"),e.textarea),e.allowUploads&&this.initMediaUploads(this.$("[data-role=drag-drop-placeholder]"),this.$("[data-role=textarea]"),this.$("[data-role=media-uploader]"))}},u}),define("core/editable",[],function(){"use strict";function e(e){return e.replace(s," ")}function t(n,i,s){var a,o,l,c,u="",d=[];for("string"!=typeof s&&(s="\n\n"),c=0;c<n.length;++c)o=n[c],a=o.nodeName.toLowerCase(),1===o.nodeType?(l=i&&i(o),l?u+=l:r.hasOwnProperty(a)?(u&&d.push(u),u=t(o.childNodes,i,s)):u+="br"===a?"\n":t(o.childNodes,i,s)):3===o.nodeType&&(u+=e(o.nodeValue));return d.push(u),d.join(s)}var n=window.document,i="character",s=new RegExp(String.fromCharCode(160),"gi"),a="h1 h2 h3 h4 h5 h6 p pre blockquote address ul ol dir menu li dl div form".split(" "),r={},o=0;for(o=0;o<a.length;o++)r[a[o]]=!0;var l=function(e,t,n){var i=this;if(!e||!e.contentEditable)throw new Error("First argument must be contentEditable");this.elem=e,this.emulateTextarea=e.getAttribute("plaintext-only")||t,this.emulateTextarea&&(this.pasteHandler=function(){var e=i.plainTextReformat,t=function(){e.timeout=null,e.call(i)};e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(t,0)},e.addEventListener("paste",this.pasteHandler));for(var s in n)n.hasOwnProperty(s)&&(this[s]=n[s])};return l.prototype={insertHTML:function(e){if(n.all){var t=n.selection.createRange();return t.pasteHTML(e),t.collapse(!1),t.select()}return n.execCommand("insertHTML",!1,e)},insertNode:function(e){var t,i,s;window.getSelection?(t=window.getSelection(),t.getRangeAt&&t.rangeCount&&(i=t.getRangeAt(0),i.deleteContents(),i.insertNode(e),i.collapse(!1),t.removeAllRanges(),t.addRange(i))):n.selection&&n.selection.createRange&&(i=n.selection.createRange(),s=3===e.nodeType?e.data:e.outerHTML,i.pasteHTML(s),i.collapse(!1))},getTextNodes:function(e){var t=this.elem;e&&e.nodeType?e=[e]:e||(e=t.childNodes);for(var n,i=[],s=0;s<e.length;++s)if(n=e[s])switch(n.nodeType){case 1:i=i.concat(this.getTextNodes(n.childNodes));break;case 3:/^\n\s+/.test(n.nodeValue)||i.push(n)}return i},text:function(e){var n,i,s,a=this.elem;try{i=Array.prototype.slice.call(a.childNodes)}catch(r){for(i=[],s=0;s<a.childNodes.length;++s)i.push(a.childNodes[s])}return n=t(i,e,this.emulateTextarea&&"\n"),n.replace(/^\s+|\s+$/g,"")},setText:function(e){e=e||"";var t,i,s,a=n.createDocumentFragment(),r=this.emulateTextarea?[e.replace(/(?:\r\n|\r|\n){2,}/g,"\n\n")]:e.split(/(?:\r\n|\r|\n){2,}/),o=r&&r.length;for(t=0;o>t;t++)i=r[t],s=this.createParagraph(i),a.appendChild(s);a.lastChild.appendChild(n.createElement("br")),this.elem.innerHTML="",this.elem.appendChild(a);var l=window.getSelection&&window.getSelection();l&&l.anchorNode===this.elem&&l.modify&&l.modify("move","forward","line")},createParagraph:function(e){var t,i,s,a,r,o,l,c=n.createElement("p");for(s=e.split(/\r\n|\r|\n/),i=0,r=s.length;r>i;i++){for(a=s[i],l=this.getHtmlElements(a),t=0,o=l.length;o>t;t++)c.appendChild(l[t]);c.appendChild(n.createElement("br"))}return c.lastChild&&c.removeChild(c.lastChild),c},getHtmlElements:function(e){return[n.createTextNode(e)]},plainTextReformat:function(){if(!(this.elem.getElementsByTagName("p").length<=1)){this.emulateTextarea=!1;var e=this.text();this.emulateTextarea=!0,this.setText(e)}},removeNode:function(e){var t,i,s;window.getSelection?(t=e.previousSibling,e.parentNode.removeChild(e),i=window.getSelection(),s=n.createRange(),t&&(s.setStart(t,t.length),s.setEnd(t,t.length)),i.addRange(s)):e.parentNode.removeChild(e)},selectedTextNode:function(){var t,s,a,r,o,l,c,u,d,h=this.elem;if(window.getSelection)return t=window.getSelection(),t.anchorNode;if(n.selection.createRange){for(s=n.selection.createRange().duplicate();-1e3===s.moveStart(i,-1e3);)continue;var p=s.text;for(u=0;u<h.childNodes.length;++u)for(a=h.childNodes[u],o=this.getTextNodes(a),d=0;d<o.length;++d)if(r=o[d],c=e(r.nodeValue),p.indexOf(c)>-1)l=r,p=p.replace(c,"");else if(c.indexOf(p)>-1)return r;return l}},selectedTextNodeOffset:function(t){var s,a,r;if(window.getSelection){var o=window.getSelection();o&&o.anchorOffset&&(r=o.anchorOffset)}else if(t&&n.selection.createRange){var l=e(t.nodeValue);s=n.selection.createRange();var c=s.duplicate(),u=c.parentElement();for(a=0;0!==s.moveStart(i,-1)&&0!==l.indexOf(e(s.text))&&u===s.parentElement();a++)c=s.duplicate(),u=c.parentElement();r=a}return isNaN(r)?0:r},offset:function(){function t(i,s){function a(e){l+=e[0];for(var t=1;t<e.length;++t)o.push(l),l=e[t]}"string"!=typeof s&&(s="\n\n");for(var o=[],l="",c=0;c<i.length;++c){var u=i[c],d=u.nodeName.toLowerCase();1===u.nodeType?r.hasOwnProperty(d)?(l&&(l+=s),a(t(u.childNodes,s))):"br"===d?l+="\n":a(t(u.childNodes,s)):3===u.nodeType&&(u===n.anchorNode?(l+=e(u.nodeValue.slice(0,n.anchorOffset)),o.push(l),l=e(u.nodeValue.slice(n.anchorOffset))):l+=e(u.nodeValue))}return o.push(l),o}var n=window.getSelection();if(!n||!n.anchorNode||3!==n.anchorNode.nodeType)return 0;var i,s=this.elem;try{i=Array.prototype.slice.call(s.childNodes)}catch(a){i=[];for(var o=0;o<s.childNodes.length;++o)i.push(s.childNodes[o])}var l=t(i,this.emulateTextarea&&"\n");if(1===l.length)return 0;var c=l[0].length,u=l.join(""),d=u.match(/\s+$/);if(d){var h=d[0].length;c=Math.min(c,u.length-h)}var p=u.match(/^\s+/);if(p){var m=p[0].length;c-=m}return c},selectNodeText:function(t,s,a){var r,o,l=this.elem;if(window.getSelection)return r=window.getSelection(),r.removeAllRanges(),o=n.createRange(),o.setStart(t,s),o.setEnd(t,a),r.addRange(o),r;if(n.selection.createRange){o=n.selection.createRange();var c=e(t.nodeValue);if("body"===o.parentElement().nodeName.toLowerCase()){for(l.focus(),o=n.selection.createRange();-1e3===o.moveStart(i,-1e3);)continue;for(;1e3===o.moveEnd(i,1e3);)continue;var u=e(o.text),d=u.indexOf(c);d>0&&o.moveStart(i,d+2),o.collapse()}for(;-1===o.moveStart(i,-1)&&0!==c.indexOf(e(o.text));)continue;for(;1===o.moveEnd(i,1)&&c!==e(o.text);)continue;return o.moveStart(i,s),o.moveEnd(i,-1*(a-s-o.text.length)),o.select(),o}}},l.normalizeSpace=e,l}),define("core/CappedStorage",["core/utils/storage"],function(e){"use strict";var t=function(e,t){this.max=e||10,this.queueKey=t||"__queue",this.getQueue()||this.setQueue([])};return t.prototype.set=function(t,n){var i=this.getQueue()||this.setQueue([]);i.length===this.max&&e.remove(i.shift()),e.set(t,n),i.push(t),this.setQueue(i)},t.prototype.get=function(t){return e.get(t)},t.prototype.remove=function(t){e.remove(t);for(var n=this.getQueue()||[],i=0;i<n.length;i++)if(n[i]===t){n.splice(i,1);break}this.setQueue(n)},t.prototype.clear=function(){e.clear(),this.setQueue([])},t.prototype.getQueue=function(){return e.get(this.queueKey)},t.prototype.setQueue=function(t){return e.set(this.queueKey,t),t},t}),define("core/extensions/jquery.autoresize",["jquery","underscore"],function(e,t){"use strict";return e.fn.autoresize=function(n){var i=t.extend({extraSpace:0,maxHeight:1e3},n);return this.each(function(){var n=e(this).css({resize:"none",overflow:"hidden"}),s="true"===String(n[0].contentEditable)?"html":"val",a="html"===s?"<br>":"\n",r=n.height(),o=function(){var i={};t.each(i,function(e,t){i[t]=n.css(t)});var s=e(n[0].cloneNode(!0));return s.removeAttr("id").removeAttr("name").css({visibility:"hidden",position:"absolute",top:"-9999px",left:"-9999px",contentEditable:!1}).css(i).attr("tabIndex","-1"),s.insertAfter(n[0]),s}(),l=null,c=function(){o[0].style.height=0,o[s](n[s]()+a),o.scrollTop(o[0].scrollHeight);var e=Math.max(o[0].scrollHeight,r)+parseInt(i.extraSpace,10);i.maxHeight&&(e>=i.maxHeight?(n.css("overflow",""),e=i.maxHeight):n.css("overflow","hidden")),l!==e&&(l=e,n.height(e),n.trigger&&n.trigger("resize"))},u=t.throttle(c,500),d=function(e){13===e.keyCode?c():u()};n.bind("keyup",d).bind("paste",c).css("overflow","hidden"),c()})},e}),define("core/views/TextareaView",["underscore","jquery","backbone","core/utils","core/CappedStorage","core/extensions/jquery.autoresize"],function(e,t,n,i,s){"use strict";var a=n.View.extend({events:{"keydown  [data-role=editable]":"handleKeyDown","keyup    [data-role=editable]":"handleKeyUp","paste    [data-role=editable]":"handlePaste","focusin  [data-role=editable]":"handleFocusIn","blur     [data-role=editable]":"handleBlur"},initialize:function(t){t=t||{},this.storageKey=t.storageKey,this.value=t.value||this.getDraft()[0],this.placeholder=t.placeholder,this.listenTo(this,"keychange",e.debounce(this.saveDraft,this.constructor.SAVE_DRAFT_INTERVAL))},render:function(){return this.$input=this.createInput(),this.set(this.value),this.$el.append(this.$input),this.$input.autoresize({maxHeight:this.constructor.MAX_TEXTAREA_HEIGHT}),this},createInput:function(){return t("<textarea>").attr({"class":"textarea",placeholder:this.placeholder,"data-role":"editable"})},resize:function(){this.$input.trigger("paste",{fake:!0})},get:function(){return this.$input.val()},getSelected:function(){var e=this.$input[0];return"number"==typeof e.selectionStart?this.$input.val().substring(e.selectionStart,e.selectionEnd):""},offset:function(){var e=this.$input[0];return"number"==typeof e.selectionStart?e.selectionStart:0},insertAtCursor:function(e){this.focus();var t=this.get(),n=this.offset(),s=i.insertWithWhitespace(t,n,e),a=this.$input[0];if(this.set(s),a.setSelectionRange){var r=s.indexOf(e,n)+e.length+1;a.setSelectionRange(r,r)}},insertAroundSelection:function(e,t){this.focus();var n,i,s=this.$input[0];"number"==typeof s.selectionStart?(n=s.selectionStart,i=s.selectionEnd):n=i=0;var a=this.get(),r=a.substring(0,n)+e+a.substring(n,i)+t+a.substring(i);this.set(r),s.setSelectionRange&&s.setSelectionRange(n+e.length,i+e.length)},set:function(e){this.$input.val(e)},clear:function(){this.set("")},focus:function(){this.$input.focus()},handleKeyDown:function(e){this.trigger("keydown",e)},handleKeyUp:function(e){this.trigger("keychange",e)},handlePaste:function(e,t){t=t||{},this.trigger(t.fake?"paste":"paste keychange"),this.$input.trigger("resize")},handleFocusIn:function(){this.trigger("focus")},handleBlur:function(){this.trigger("blur")},saveDraft:function(){return this.storageKey?t.trim(this.get())?void this.constructor.storage.set(this.storageKey,this.toJSON()):void this.removeDraft():void 0},toJSON:function(){return[this.get(),t.now()]},getDraft:function(){var e=[""];if(!this.storageKey)return e;var n=this.constructor.storage.get(this.storageKey);if(!n)return e;if(e=n,!e.length)return[""];var i=t.now()-e[1]>=this.constructor.DRAFT_MAX_AGE;return i?(this.removeDraft(),[""]):e},removeDraft:function(){this.storageKey&&this.constructor.storage.remove(this.storageKey)}},{MAX_TEXTAREA_HEIGHT:350,SAVE_DRAFT_INTERVAL:500,DRAFT_MAX_AGE:864e5,storage:new s(5,"drafts.queue")});return a}),define("core/views/ContentEditableView",["jquery","underscore","core/editable","core/views/TextareaView"],function(e,t,n,i){"use strict";var s=window.document,a=i,r=a.prototype,o=a.extend({events:function(){return t.extend({},r.events,{"focusout [data-role=editable]":"handleFocusOut","click .placeholder":"handlePlaceholderClick"})},initialize:function(){r.initialize.apply(this,arguments),this.hasFocus=!1,this._selectionRange=null},saveSelection:function(){var e=window.getSelection();this._selectionRange=e&&e.rangeCount&&e.getRangeAt(0)},restoreSelection:function(){if(this._selectionRange){var e=window.getSelection();e.removeAllRanges(),e.addRange(this._selectionRange),this._selectionRange=null}},render:function(){return this.$input=this.createInput(),this.$el.append(this.$input),this.set(this.value),this.renderPlaceholder(),this},createInput:function(){var t=e("<div>").attr({"class":"textarea",tabIndex:0,role:"textbox","aria-multiline":"true",contenteditable:"PLAINTEXT-ONLY","data-role":"editable"}).css({overflow:"auto","word-wrap":"break-word","max-height":this.constructor.MAX_TEXTAREA_HEIGHT+"px"}),i=t[0];return"plaintext-only"!==i.contentEditable&&(i.contentEditable="true"),this.content=new n(i,(!0)),t},renderPlaceholder:function(){var t=this.placeholder;t&&(this.$input.attr("aria-label",t),this.$placeholder=e('<span class="placeholder">'+t+"</span>"),this.updatePlaceholderDisplay())},updatePlaceholderDisplay:function(){this.$placeholder&&(this.hasFocus||this.content.text()?this.$placeholder.remove():this.$el.prepend(this.$placeholder))},handlePlaceholderClick:function(){this.$input.focus()},handleFocusIn:function(){r.handleFocusIn.call(this),this.restoreSelection(),this.hasFocus=!0,this.updatePlaceholderDisplay()},handleFocusOut:function(){this.saveSelection(),this.hasFocus=!1,this.updatePlaceholderDisplay()},get:function(){return this.content.text()},getSelected:function(){return this.hasFocus&&window.getSelection?window.getSelection().toString():this._selectionRange?this._selectionRange.toString():""},offset:function(){return this.content.offset()},set:function(e){this.content.setText(e),this.resize(),this.updatePlaceholderDisplay()},insertAtCursor:function(e){this.focus();var t=" "+e+" ";s.queryCommandSupported&&s.queryCommandSupported("insertText")&&s.execCommand("insertText",!1,t)||this.content.insertNode(s.createTextNode(t))},clear:function(){r.clear.call(this),t.defer(function(e){e.$input.blur()},this)},insertAroundSelection:function(e,t){this.focus();var n=window.getSelection();if(n.rangeCount){var i=n.getRangeAt(0),a=i.cloneRange();a.collapse(!1);var r=s.createTextNode(t);a.insertNode(r);var o=i.cloneRange();o.collapse(!0);var l=s.createTextNode(e);o.insertNode(l),i.setStart(l,e.length),i.setEnd(r,0),n.removeAllRanges(),n.addRange(i)}}});return o}),define("core/views/PostReplyView",["jquery","underscore","backbone","modernizr","core/UniqueModel","core/mixins/withAlert","core/mixins/withUploadForm","core/models/Post","core/models/User","core/utils","core/views/ContentEditableView","core/views/TextareaView","core/strings"],function(e,t,n,i,s,a,r,o,l,c,u,d,h){"use strict";var p=h.get,m=c.preventDefaultHandler,f=n.View.extend({tagName:"form",className:"reply",events:{submit:"submitForm"},postboxAlertSelector:"[role=postbox-alert]",initialize:function(e){this.session=e.session,this.parent=e.parent,this.thread=e.thread,this.post=this.makePostInstance(),this.setAlertSelector("[role=alert]"),this.shouldShowEmailAlertInForm=e.shouldShowEmailAlertInForm,this.parentView=e.parentView,this._isHidden=!1,this.parent&&(f.open[this.parent.cid]=this),this.allowMedia=this.thread.forum.get("settings").allowMedia,this.allowUploads=this.allowMedia&&this.uploadSupported,this.listenTo(this.session,"change:id",this.redraw)},redraw:function(){var t=this.$el.hasClass("expanded"),n=this.el,i=this.$el.find("textarea").val();this.render(),this.$el.find("textarea").val(i),t&&this.$el.addClass("expanded"),0!==e(n).parent().length&&n.parentNode.replaceChild(this.el,n)},getPlaceholderText:function(){return p(this.thread.get("posts")?"Join the discussion…":"Start the discussion…");
},getTemplateData:function(){return{user:this.session.toJSON(),displayMediaPreviews:this.allowMedia,displayMediaUploadButton:this.allowUploads}},render:function(){return this.$el.html(this.template(this.getTemplateData())),this.parent?this.$el.addClass("expanded"):this.$el.removeClass("expanded"),this.initTextarea(),this.initMediaViews({allowMedia:this.allowMedia,allowUploads:this.allowUploads,textarea:this.textarea}),this.constructor.mustVerifyEmailToPost(this.session.user,this.thread.forum)&&this._alertMustVerify(this.shouldShowEmailAlertInForm),this._isHidden&&this.$el.addClass("hidden"),this},createTextarea:function(){var e={placeholder:this.getPlaceholderText(),storageKey:this.post.storageKey()};return this.constructor.canUseContentEditable?new this.constructor.ContentEditableView(e):new this.constructor.TextareaView(e)},initTextarea:function(){var e=this.textarea=this.createTextarea();this.$("[data-role=textarea]").prepend(e.render().el),this.listenTo(e,{keydown:function(e){!e||!e.ctrlKey&&!e.metaKey||13!==e.keyCode&&10!==e.keyCode||this.submitForm()},focus:function(){this.$el.hasClass("expanded")||this.$el.addClass("expanded")}})},resize:function(){this.textarea.resize()},focus:function(){this.textarea.focus()},clear:function(){var e=this;e.textarea.clear(),e.clearMediaPreviews(),e.$el.removeClass("expanded"),t.delay(function(){e.resize()},200),e.parent&&e.hide()},restore:function(e){var n=this;n.textarea.set(e.get("raw_message")),n.textarea.handleFocusIn(),t.delay(function(){n.resize()},200),n.parent&&n.show()},_alertMustVerify:function(e){var t=this.emailVerifyAlertTemplate({user:this.session.user.toJSON(),forumName:this.thread.forum.get("name"),forumId:this.thread.forum.id});this.alert(t,{safe:!0,type:e?"error":"warn",target:e?this.postboxAlertSelector:null})},submitForm:m(function(){return this.dismissAlert(),this.initiatePost()}),makePostInstance:function(){return new s(this.constructor.Post,{thread:this.thread.id,depth:this.parent?this.parent.get("depth")+1:0,parent:this.parent?this.parent.id:null})},getPostParams:function(){var e={raw_message:this.textarea.get()};t.extend(e,this.getAuthorParams());var n=this.mediaUploadsView;return n&&(e.media=n.rich.invoke("toJSON")),e},getAuthorParams:function(){return{author_id:this.session.user.id}},initiatePost:function(){this.createPost(this.getPostParams())},createPost:function(n){var i=this.post;this.dismissAlert();var s=e.now();if(!this.shouldAbortCreatePost(i,n))return this.listenTo(i,{error:this._onCreateError,sync:t.partial(this._onCreateSync,s)}),i.save(n),this.attachAuthorToPost(i,n),i.created=!0,this.addPostToThread(i),this.clear(),this.trigger("uiAction:createPost",i),i},shouldAbortCreatePost:function(e,t){return this.isUploadInProgress()?(this.alert(p("Please wait until your images finish uploading."),{type:"error",target:this.postboxAlertSelector}),!0):!e.set(t,{validate:!0})&&(this.alert(e.validationError,{type:"error",target:this.postboxAlertSelector}),!0)},_onCreateError:function(e,n){if(12===n.code&&/not have permission to post on this thread/.test(n.response)){var i=this.blacklistErrorMessageTemplate({blocker:this.session.user.get("isOnGlobalBlacklist")?"Disqus":this.thread.forum.get("name")});this.alert(i,{type:"error",target:this.postboxAlertSelector,safe:!0})}else 12===n.code&&/verify/.test(n.response)?this._alertMustVerify(!0):t.isString(n.response)?this.alert(n.response,{type:"error",target:this.postboxAlertSelector}):this.alert(p("Oops! We're having trouble posting your comment. Check your internet connection and try again."),{type:"error",target:this.postboxAlertSelector});this.thread.posts.remove(e),this.restore(e)},_onCreateSync:function(t,n){this.textarea.removeDraft(),this.thread.trigger("create",n),this.trigger("uiCallback:postCreated",n,{duration:e.now()-t}),this.parentView&&this.parentView.toggleReplyLink(!1),this.stopListening(n,"error",this._onCreateError),this.stopListening(n,"sync",this._onCreateSync),this.post=this.makePostInstance(),this.trigger("domReflow")},attachAuthorToPost:function(e,t){this.session.isLoggedIn()?e.author=this.session.user:e.author=new s(this.constructor.User,{name:t.author_name,email:t.author_email})},addPostToThread:function(e){this.thread.posts.add(e)},remove:function(){this.parent&&delete f.open[this.parent.cid],n.View.prototype.remove.call(this)},toggle:function(){this.isOpen()?this.hide():this.show()},show:function(){var e=this;e._isHidden=!1,e.$el.removeClass("hidden"),e.trigger("show")},hide:function(){var e=this;e._isHidden=!0,e.dismissAlert(),e.$el.addClass("hidden"),e.trigger("hide")},isOpen:function(){return!this._isHidden}},{mustVerifyEmailToPost:function(e,t){if(e.isAnonymous())return!1;var n=t.get("settings").mustVerifyEmail,i=e.get("isVerified");return n&&!i},canUseContentEditable:i.contenteditable&&!c.isMobileUserAgent()&&!(window.opera&&window.opera.version),TextareaView:d,ContentEditableView:u,User:l,Post:o,open:{}});return a.call(f.prototype),r.call(f.prototype),f}),define("lounge/mixins/post-reply",["underscore","common/models","lounge/common"],function(e,t,n){"use strict";var i={initialize:function(){this.canBindTypingHandlers()&&this.bindTypingHandlers()},canBindTypingHandlers:function(){return this.parent&&n.getLounge().isRealtimeEnabled()&&this.session&&this.thread&&this.thread.forum},bindTypingHandlers:function(){return e.map([[this,"show",this.typingStart],[this,"hide",this.typingStop]],function(e){return this.listenTo.apply(this,e),e},this)},syncTyping:function(e){this.typingUser&&(void 0!==e&&this.typingUser.set("typing",e),this.typingUser.sync())},typingStart:function(){var e=this.parent;this.typingUser||(this.typingUser=t.TypingUser.make({user:this.session.user.id,post:e.id,thread:this.thread.id,forum:this.thread.forum.id}),e.usersTyping.add(this.typingUser)),this.syncTyping(!0)},typingStop:function(){this.syncTyping(!1)}},s=function(t){var n=t.initialize,s=t.remove;e.extend(t,i),t.initialize=function(){n.apply(this,arguments),i.initialize.call(this)},t.remove=function(){return this.parent&&this.typingStop(),s.call(this)}};return{asRealtimeTyping:s}}),define("core/models/Channel",["underscore","backbone","core/UniqueModel","core/api","core/models/Forum","core/strings"],function(e,t,n,i,s,a){"use strict";var r=a.get,o=t.Model.extend({defaults:{primaryForum:{},slug:null,name:null,options:{},followUrl:"channels/follow",unfollowUrl:"channels/unfollow"},idAttribute:"slug",initialize:function(e,t){this.buildPrimaryForum(t),this.listenTo(this,"change:primaryForum",this.updatePrimaryForum),this.listenTo(this,"change:primaryCategory",this.updatePrimaryCategory)},buildPrimaryForum:function(){if(!this.primaryForum){var e=this.get("primaryForum");e&&(this.primaryForum=new n(s,e,{channel:this}),this.unset("primaryForum"))}},updatePrimaryForum:function(){var e=this.get("primaryForum");e&&(this.primaryForum||this.buildPrimaryForum(),this.primaryForum.set(e),this.unset("primaryForum"))},updatePrimaryCategory:function(){var e=this.get("primaryCategory"),t=this.primaryCategory;null===e?this.primaryCategory=void 0:t?t.set(e):this.primaryCategory=new n(o,e),this.unset("primaryCategory"),this.trigger("changeRelated:primaryCategory")},fetch:function(n){return n=n?e.clone(n):{},n.data=this.buildFetchData(n.data),t.Model.prototype.fetch.call(this,n)},buildFetchData:function(t){var n=t?e.clone(t):{};return this.id&&(n.channel=this.id),n},url:function(e){return i.getURL(this.constructor.URLS[e]||this.constructor.URLS.read)},sync:function(n,i,s){var a=i.attributes;s=e.extend({url:this.url(n),emulateHTTP:!0},s);var r={bannerColor:a.bannerColor,description:a.description,primaryCategory:i.primaryCategory&&i.primaryCategory.get("slug")||""};switch("default"===s.avatarType?r.avatar="":a.avatar&&!e.isString(a.avatar)&&(r.avatar=a.avatar),"file"!==s.bannerType?r.banner="":a.banner&&!e.isString(a.banner)&&(r.banner=a.banner),n){case"create":s.processData=!1,s.contentType=!1,r.name=a.name,s.data=this.toFormData(e.extend({},r,s.data));break;case"update":s.processData=!1,s.contentType=!1,r.channel=a.slug,s.data=this.toFormData(e.extend({},r,s.data))}return t.sync(n,i,s)},toFormData:function(t){return e.reduce(t,function(t,n,i){return t.append(i,e.isString(n)?n.trim():n),t},new window.FormData)},parse:function(e){return e.response||e},shouldFetch:function(){return!this.get("name")||!this.get("dateAdded")},ensureFetched:function(){this.shouldFetch()&&this.fetch()},validate:function(t){var n=[],i=t.name.trim();i.length<this.constructor.MIN_NAME_LENGTH?n.push({attrName:"name",message:a.interpolate(r("Name must have at least %(minLength)s characters."),{minLength:this.constructor.MIN_NAME_LENGTH})}):i.length>this.constructor.MAX_NAME_LENGTH&&n.push({attrName:"name",message:a.interpolate(r("Name must have less than %(maxLength)s characters."),{maxLength:this.constructor.MAX_NAME_LENGTH})});var s=t.description.trim();return s.length<this.constructor.MIN_DESCRIPTION_LENGTH?n.push({attrName:"description",message:a.interpolate(r("Description must have at least %(minLength)s characters."),{minLength:this.constructor.MIN_DESCRIPTION_LENGTH})}):s.length>this.constructor.MAX_DESCRIPTION_LENGTH&&n.push({attrName:"description",message:a.interpolate(r("Description must have less than %(maxLength)s characters."),{maxLength:this.constructor.MAX_DESCRIPTION_LENGTH})}),this.constructor.BANNER_COLORS[t.bannerColor]||n.push({attrName:"bannerColor",message:a.interpolate(r("Banner color must be one of "+e.invoke(e.values(this.constructor.BANNER_COLORS),"toLowerCase").join(", "))+".")}),e.isEmpty(n)?void 0:n},_changeFollowingState:function(t,n){return n=n||{},n.type="POST",n.data=e.extend({target:this.get("slug")},n.data),i.call(t,n)},follow:function(e){return this.primaryForum.set("isFollowing",!0),this._changeFollowingState(this.get("followUrl"),e)},unfollow:function(e){return this.primaryForum.set("isFollowing",!1),this._changeFollowingState(this.get("unfollowUrl"),e)},toggleFollowed:function(){if(this.get("options").isCurationOnlyChannel&&this.primaryForum){var e=this.primaryForum.get("isFollowing")?this.unfollow():this.follow();return this.primaryForum.trigger("toggled:isFollowing"),e}},toJSON:function(){var n=t.Model.prototype.toJSON.call(this);return e.defaults({primaryCategory:this.primaryCategory?this.primaryCategory.toJSON():{}},n)}},{URLS:{read:"channels/details",create:"channels/create",update:"channels/update"},BANNER_COLORS:{gray:r("Gray"),blue:r("Blue"),green:r("Green"),yellow:r("Yellow"),orange:r("Orange"),red:r("Red"),purple:r("Purple")},MIN_NAME_LENGTH:3,MAX_NAME_LENGTH:100,MIN_DESCRIPTION_LENGTH:5,MAX_DESCRIPTION_LENGTH:200});return n.addType("Channel",o),o}),define("core/utils/objectExpander",["underscore","core/UniqueModel","core/models/Channel","core/models/Thread"],function(e,t,n,i){"use strict";return{Channel:n,Thread:i,parseObject:function(t,n){return e.isString(n)?t[n]:n},buildThread:function(n,i){if(i instanceof this.Thread)return i;if(i=this.parseObject(n,i),e.isString(i.author)){var s=i.author.replace("auth.User?id=","");i.author=n["auth.User?id="+s]||s}return new t(this.Thread,i,{forum:this.parseObject(n,i.forum),author:i.author})},buildChannel:function(e,n){return n instanceof this.Channel?n:(n=this.parseObject(e,n),new t(this.Channel,n))}}}),define("core/collections/PaginatedCollection",["underscore","backbone"],function(e,t){"use strict";var n=t.Collection.extend({PER_PAGE:30,initialize:function(t,n){this.cid=e.uniqueId("collection"),n=n||{},this.cursor=n.cursor||{}},ensureFetched:e.memoize(function(){return this.fetch()},function(){return this.cid}),fetch:function(n){return n=n||{},n.data=e.defaults(n.data||{},{cursor:n.cursor||"",limit:n.PER_PAGE||this.PER_PAGE}),t.Collection.prototype.fetch.call(this,n)},hasPrev:function(){return this.cursor.hasPrev},hasNext:function(){return this.cursor.hasNext},next:function(t){return this.cursor.hasNext?this.fetch(e.extend({},t,{add:!0,remove:!0,cursor:this.cursor.next})):void this.trigger("nodata")},prev:function(t){return this.cursor.hasPrev?this.fetch(e.extend({},t,{add:!0,remove:!0,cursor:this.cursor.prev})):void this.trigger("nodata")},more:function(t){function n(e){s.push(e)}var i=this;if(t=t||{},!this.cursor.hasNext)return void i.trigger("nodata");var s=[];return this.on("add",n),this.fetch(e.extend({},t,{add:!0,remove:!1,cursor:this.cursor.next,limit:this.PER_PAGE,success:function(){i.trigger("add:many",s,i,t),i.off("add",n),t.success&&t.success.apply(this,arguments)}}))},parse:function(e){return this.cursor=e.cursor||{hasNext:!1},e.response},getLength:function(){return this.length}});return n}),define("core/collections/ChannelCollection",["underscore","core/collections/PaginatedCollection","core/UniqueModel","core/api","core/models/Channel","core/utils/objectExpander"],function(e,t,n,i,s,a){"use strict";var r=t.extend({url:i.getURL("channels/list"),model:n.boundModel(s),initialize:function(e,n){t.prototype.initialize.call(this,e,n),n=n||{},this.listName=n.listName},fetch:function(n){return n=n||{},this.listName&&(n.data=e.extend({listName:this.listName},n.data)),t.prototype.fetch.call(this,n)},parse:function(n){return n=t.prototype.parse.call(this,n),n.items?e.map(n.items,function(e){return a.buildChannel(n.objects,e.reference)}):n}});return r}),define("common/collections",["underscore","backbone","moment","core/api","core/utils/objectExpander","core/collections/UserCollection","core/collections/PaginatedCollection","core/collections/ChannelCollection","core/models/ThreadVote","core/UniqueModel","common/models","common/cached-storage"],function(e,t,n,i,s,a,r,o,l,c,u,d){"use strict";var h=t.Collection.extend({model:l}),p=r.extend({PER_PAGE:50,model:c.wrap(u.Post),url:i.getURL("threads/listPostsThreaded"),initialize:function(e,t){r.prototype.initialize.apply(this,arguments),t=t||{},this.thread=t.thread,this.setOrder(t.order)},fetch:function(t){return t=t||{},e.extend(t,{data:{limit:this.PER_PAGE,thread:this.thread.id,forum:this.thread.get("forum"),order:this.getOrder()}}),r.prototype.fetch.call(this,t)},getOrder:function(){return this.order},setOrder:function(e){this.order=e}}),m=t.Collection.extend({collection:t.Collection,initialize:function(e,t){this.thread=t.thread,this.perPage=t.perPage||20,this.buffer=new this.collection(e,t),this.resetPage(),this.listenTo(this.buffer,"reset",this.resetPage)},resetPage:function(e,n,i){return n=this.buffer.slice(0,this.perPage),t.Collection.prototype.reset.call(this,n,i)},currentPage:function(){var e=Math.floor(this.length/this.perPage);return this.length%this.perPage&&(e+=1),e},setPageFor:function(e,t){var n=this.buffer.get(e),i=this.perPage;n&&(i=this.perPage*Math.floor(this.buffer.indexOf(n)/this.perPage+1)),this.add(this.buffer.slice(0,i),t)},hasNext:function(){return this.buffer.length>this.length||this.buffer.hasNext()},more:function(e){e=e||{};var t=this,n=t.length+this.perPage,i=e.success;e.success=function(){t.add(t.buffer.slice(0,n)),i&&i()},t.buffer.length<t.length+this.perPage&&t.buffer.hasNext()?(t.add(t.buffer.slice(0,n)),t.buffer.more(e)):e.success()}});e.each(["setOrder","getOrder","fetch","reset"],function(e){m.prototype[e]=function(){return this.buffer[e].apply(this.buffer,arguments)}}),e.each(["add","remove"],function(e){m.prototype[e]=function(){return this.buffer[e].apply(this.buffer,arguments),t.Collection.prototype[e].apply(this,arguments)}});var f=m.extend({model:p.prototype.model,collection:p,initialize:function(){m.prototype.initialize.apply(this,arguments),this.submittedPostsCache=new d("submitted_posts_cache")},restoreFromCache:function(){var t=this.submittedPostsCache.getAll(),n=this;this.add(e.chain(t).reject(function(e){return n.thread.get("id")!==e.thread||e.parent&&!n.get(e.parent)}).map(function(e){return e.isCached=!0,e}).value())},removeFromCache:function(e){this.submittedPostsCache.removeItem(e.id)},saveToCache:function(e){this.submittedPostsCache.setItem(e.id,e.toJSON())}}),g=t.Collection.extend({model:u.QueuedPost,initialize:function(e,t){var n=this;n.thread=t.thread,n.counters={comments:0,replies:{}},n.on("add",function(e){var t=e.getVisibleParent(n.thread),i=n.counters.replies;t?(i[t.id]=(i[t.id]||0)+1,t.id===e.get("parentId")&&e.set("immedReply",!0)):n.counters.comments+=1})},comparator:function(e){return parseInt(e.id,10)},isDescendant:function(t,n){var i=t.get("parentId"),s=i?this.get(i):null,a={};for(e.each(n,function(e){a[e]=!0});s;){if(a[s.get("id")]===!0)return!0;i=s.get("parentId"),s=i?this.get(i):null}return!1},drain:function(t){function n(e){var t=[];s.each(function(e){null===e.get("parentId")&&t.push(e.get("id"))}),s.reset(s.filter(function(n){return null===n.get("parentId")||s.isDescendant(n,t)?void e(n):n})),s.counters.comments=0}function i(n){var i,a=[];i=s.filter(function(e){var n=e.getVisibleParent(s.thread);return n&&n.get("id")===t?void a.push(e):e}),a=e.sortBy(a,function(e){return parseInt(e.get("id"),10)}),e.each(a,function(e){n(e)}),s.reset(i),s.counters.replies[t]=0}var s=this,a=t?i:n;return a(function(e){s.thread.posts.add(e.toPost(s.thread))})}}),v=t.Collection.extend({models:u.TypingUser,initialize:function(){var t=this;t.gc=null,t.on("add remove reset",function(){var n=t.count();return n>0&&null===t.gc?void(t.gc=setInterval(e.bind(t.cleanup,t),6e4)):void(0>=n&&null!==t.gc&&(clearInterval(t.gc),t.gc=null))},t)},count:function(e){var t=this.filter(function(t){return!(e&&t.id===e)&&t.get("typing")});return t.length},cleanup:function(){var e=n();this.reset(this.filter(function(t){return e.diff(t.lastModified,"minutes")<5}))}}),w=r.extend({model:c.wrap(u.Post),url:i.getURL("users/listPostActivity")}),b=r.extend({model:u.Thread,url:i.getURL("timelines/ranked"),initialize:function(e,t){t=t||{},this.type=t.type,this.target=t.target},fetch:function(t){return t=t||{},t.data=e.extend({type:this.type,target:this.target},t.data),r.prototype.fetch.call(this,t)},parse:function(t){return t=r.prototype.parse.call(this,t),e.map(t.activities,function(e){return s.buildThread(t.objects,e.items[0].object)})}}),y=t.Collection.extend({model:u.SyncedTopUser,url:i.getURL("forums/listMostActiveUsers"),initialize:function(e,t){this.forum=t.forum,this.limit=t.limit},fetch:function(n){return t.Collection.prototype.fetch.call(this,e.extend({data:{forum:this.forum,limit:this.limit}},n))},parse:function(t){return e.filter(t.response,function(e){return parseFloat(e.rep)>.7?e:void 0})}});a.prototype.model=c.wrap(u.User);var x=t.Collection.extend({model:u.SyncedUser,url:i.getURL("forums/listModerators"),initialize:function(e,t){this.forum=t.forum},fetch:function(n){return t.Collection.prototype.fetch.call(this,e.extend({data:{forum:this.forum}},n))},parse:function(t){return e.map(t.response,function(e){return e.user})}});return{PaginatedCollection:r,UserCollection:a,ChannelCollection:o,PostCollection:p,SubpaginatedPostCollection:f,TypingUserCollection:v,TopUserCollection:y,RankedThreadCollection:b,ThreadVoteCollection:h,PostActivityCollection:w,QueuedPostCollection:g,ModeratorCollection:x}}),define("lounge/views/posts/SuggestionView",["jquery","underscore","backbone","common/templates"],function(e,t,n,i){"use strict";var s=n.View.extend({events:{"click li":"handleClick"},initialize:function(e){this.active=!1,this.mentionsCache=e.mentions,this.userSuggestions=e.userSuggestions,this.userHtmlCache={}},suggest:function(e){var t=this.userSuggestions.find(e,this.mentionsCache);return t&&t.length?(this.renderUsers(t),this.active=!0,void this.$el.show()):void this.clear()},render:function(){return this.$el.html(i.render("suggestions")),this.active||this.$el.hide(),this},renderUsers:function(n){var i=t.reduce(n,function(t,n){var i=this.userHtmlCache[n.cid];return void 0===i&&(this.userHtmlCache[n.cid]=i=e(this.renderSingleUser(n))),t.appendChild(i[0]),t},window.document.createDocumentFragment(),this);this.$(".header").siblings().remove().end().after(i).siblings().removeClass("active").first().addClass("active")},renderSingleUser:function(e){var t=e.toJSON();return t.cid=e.cid,i.render("suggestedUser",t)},clear:function(){this.active=!1,this.$el.hide()},handleClick:function(t){var n=e(t.currentTarget);this.select(n.attr("data-cid"))},select:function(e){this.active&&(e||(e=this.$el.find(".active").attr("data-cid")),this.trigger("select",e),this.clear())},move:function(e){if(this.active){var t=this.$el.find(".active"),n="up"===e?"prev":"next",i=t[n]();i.length&&i.attr("data-cid")&&(t.removeClass("active"),i.addClass("active"))}}},{MAX_SUGGESTIONS:5});return s}),define("lounge/views/posts/ContentEditableView",["jquery","underscore","core/editable","core/views/ContentEditableView","common/collections","common/Session","lounge/views/posts/SuggestionView"],function(e,t,n,i,s,a,r){"use strict";var o=window.document,l=i,c=l.prototype,u=l.extend({initialize:function(e){c.initialize.call(this,e),e=e||{},this.userSuggestions=e.userSuggestions,this.mentionsCache=new s.UserCollection,this.restoreMentionedUsers(),this.suggestions=new r({userSuggestions:this.userSuggestions,mentions:this.mentionsCache}),this.listenTo(this.suggestions,"select",this.insertMention),this.reset(),this.$input=null},restoreMentionedUsers:function(){var e=this.getDraft()[2];e&&!t.isEmpty(e)&&this.userSuggestions.addRemote(new s.UserCollection(e))},reset:function(){this.anchorNode=null,this.anchorOffset=null,this.anchorLength=0,this.suggestions.clear()},render:function(){return i.prototype.render.call(this),this.$el.append(this.suggestions.render().el),this},createInput:function(){var e=i.prototype.createInput.call(this);return this.content.getHtmlElements=t.bind(this.getHtmlElements,this),e},getHtmlElements:function(e){if(!e)return e;var n=[e],i=this.getMentionNodes(e);return t.each(i,function(e,i){for(var s=0;s<n.length;s++){var a,r=n[s],o=s;if(t.isString(r)){for(;(a=r.indexOf(i))>-1;)a>0&&(n.splice(s,0,r.substring(0,a)),s+=1),n.splice(s,0,e.cloneNode(!0)),s+=1,r=r.substring(a+i.length);r&&r!==n[o]&&(n.splice(s,0,r),s+=1),o!==s&&n.splice(s,1)}}}),n=t.map(n,function(e){return t.isString(e)?o.createTextNode(e):e})},getMentionNodes:function(e){var t=u.MENTIONS_RE_GROUPED,n={};t.lastIndex=0;for(var i=t.exec(e);i;){var s=i[1],a=this.userSuggestions.all().findWhere({username:s});if(a){var r=u.getMentionDom(a),o=i[0];n[o]=r,this.updateCache(a,a.cid)}i=t.exec(e)}return n},handleKeyDown:function(e){switch(i.prototype.handleKeyDown.call(this,e),e.keyCode){case 9:this.suggestions.active&&(this.suggestions.select(),e.preventDefault(),e.stopPropagation());break;case 10:case 13:case 38:case 40:this.suggestions.active&&(e.preventDefault(),e.stopPropagation())}},handleKeyUp:function(e){switch(i.prototype.handleKeyUp.call(this,e),e.preventDefault(),e.stopPropagation(),this.checkExistingMentions(),a.get().isLoggedIn()&&this.userSuggestions.fetch(),e.keyCode){case 10:case 13:this.suggestions.select();break;case 27:this.reset(e);break;case 38:this.suggestions.move("up");break;case 40:this.suggestions.move("down");break;default:this.throttledSuggest(e)}},suggest:function(){var e=this.parseSearchTerms();this.suggestions.suggest(e)},throttledSuggest:t.throttle(function(){this.suggest()},250),insertMention:function(e){var n=this.userSuggestions.get(e);if(n){this.selectSearchString(n),this.updateCache(n,e);var i=u.getMentionDom(n);this.content.insertNode(i);var s=this.$el.find("span[data-cid]");t.each(s,function(e){e.contentEditable!==!1&&(e.contentEditable=!1)})}},updateCache:function(e,t){this.mentionsCache.get(t)||this.mentionsCache.add(e)},selectSearchString:function(){this.content.selectNodeText(this.anchorNode,this.anchorOffset-1,this.anchorOffset+this.anchorLength)},get:function(){function e(e){return n(e,!0)?t.mentionToText(e):null}var t=this,n=u.isMention;return this.content.text(e)},parseSearchTerms:function(){var e=this.content.selectedTextNode(),t=e?e.nodeValue:"",i=n.normalizeSpace;if(t){var s=this.content.selectedTextNodeOffset(e),a=n.normalizeSpace(t.slice(0,s).split("").reverse().join("")),r=a.indexOf("@");if(-1===r)return null;this.anchorNode=e,this.anchorOffset=s-r,this.anchorLength=r;var o=i(t.slice(this.anchorOffset-1,s)).match(u.MENTIONS_RE);return o?o[0].slice(1).split(" "):0===r?[""]:void 0}},checkExistingMentions:function(){var i=n.normalizeSpace,s=this.$el.find("span"),a=t.filter(s,u.isMention),r=this.mentionsCache,o={};t.each(a,function(n){var s=e(n).attr("data-cid"),a=t.reduce(this.content.getTextNodes(n),function(e,t){return e+i(t.nodeValue)},""),l=r.get(s);l&&l.get("name")!==a?(this.mentionsCache.remove(l),this.content.removeNode(n),this.content.insertHTML(" "),this.reset()):o[s]=n},this),r.each(function(e){o[e.cid]||r.remove(e)})},mentionToText:function(t){var n=e(t).attr("data-cid"),i=this.mentionsCache.get(n),s=t.innerText||t.textContent;return i&&i.get("username")&&(s=i.get("username")),["@",s,":","disqus"].join("")},toJSON:function(){var e=i.prototype.toJSON.call(this);return e.push(this.mentionsCache.models),e}},{MENTIONS_RE:new RegExp("@\\w+\\s?(?:\\w+\\s?){0,5}(?:\\w+)?$"),MENTIONS_RE_GROUPED:/@([\d\w]+)\s?(:\s?(\w+))?/gi,isMention:function(t,n){var i;do{if(i=e(t),i.hasClass("mention")&&i.attr("data-cid"))return!0;t=t.parentElement}while(n&&t);return!1},getMentionDom:function(e){var t=o.createDocumentFragment(),n=o.createElement("span"),i=o.createElement("span"),s=o.createTextNode(e.get("name")||e.get("username"));return n.setAttribute("contenteditable",!0),i.setAttribute("contenteditable",!1),i.setAttribute("data-cid",e.cid),i.className="mention",i.appendChild(s),n.appendChild(i),t.appendChild(n),t.appendChild(o.createTextNode(" ")),t}});return u}),define("core/views/common/LoginFormView",["underscore","backbone","core/strings"],function(e,t,n){"use strict";var i=n.get,s=t.View.extend({initialize:function(){this.model=new this.User},parseRegistrationErrorResponse:function(e){if(e.responseJSON){var t=e.responseJSON.response;return/Unable to create user/i.test(t)?{email:[i("That email address is already registered with a Disqus account. Log in or enter another email.")]}:/The e-mail address you specified is already in use./i.test(t)?{email:[i("The e-mail address you specified is already in use.")+'<br><a class="link" href="#" data-action="auth:disqus">'+i("Try logging in.")+"</a>"]}:{all:[t]}}},getPassword:function(){var e=this.$el.find("input[name=password]");return e.length?e.val():null},getDisplayName:function(){return this.$el.find("input[name=display_name]").val()},getEmail:function(){return this.$el.find("input[name=email]").val()},disableForm:function(){this.$("[data-role=submit-btn-container]").addClass("is-submitting")},enableForm:function(){this.$("[data-role=submit-btn-container]").removeClass("is-submitting")},handleRegistrationErrorResponse:function(e){this.handleRegistrationError(this.parseRegistrationErrorResponse(e))},registerUser:function(){return this.model.set({display_name:this.$el.find("input[name=display_name]").val(),email:this.$el.find("input[name=email]").val(),password:this.getPassword()}),this.model.isValid()?(this.disableForm(),void this.model.register({error:e.bind(this.handleRegistrationErrorResponse,this),success:e.bind(this.handleRegistrationSuccess,this)}).always(e.bind(this.enableForm,this))):void this.handleRegistrationError(this.model.validationError)}});return s}),define("lounge/views/posts/LoginFormView",["underscore","core/bus","core/views/common/LoginFormView","common/models","common/templates","lounge/common"],function(e,t,n,i,s,a){"use strict";var r=n.extend({events:{"click input[name=author-guest]":"updateLoginForm","focusin input[name=display_name]":"expandGuestForm"},User:i.User,initialize:function(e){n.prototype.initialize.call(this,e),this.thread=e.thread,this.session=e.session,this.alert=e.alert},expandGuestForm:function(){this.$("[data-role=guest-details]").addClass("expanded")},shouldRegisterUser:function(){return this.session.isLoggedOut()&&!this.$("input[name=author-guest]").is(":checked")},render:function(){var e=a.getLounge();return this.$el.html(s.render("loginForm",{user:this.session.toJSON(),forumName:this.thread.forum.get("name"),audienceSyncRequired:this.session.needsAudienceSyncAuth(this.thread.forum),allowAnonPost:this.thread.forum.get("settings").allowAnonPost,apiKey:e.config&&e.config.apiKey||"",sso:this.session.get("sso"),cid:this.cid})),this},handleRegistrationSuccess:function(){this.session.setUser(this.model),t.frame.trigger("onboardAlert.show"),a.getLounge().trigger("uiAction:finishRegistrationEmbed")},handleRegistrationError:function(t){var n=this;n.clearRegistrationErrors(),e.isString(t)&&(t={all:[t]}),e.has(t,"all")&&(n.alert&&n.alert(t.all[0],{type:"error"}),t=e.omit(t,"all")),e.each(t,function(e,t){var i=n.$("input[name="+t+"]");i.attr("aria-invalid","true").after('<label for="'+i.attr("id")+'" class="input-label">'+e[0]+"</label>").parent(".input-wrapper").addClass("has-error")}),n.$("[aria-invalid]").first().focus()},updateLoginForm:function(){var e=this.$el,t=e.find("input[name=author-guest]").is(":checked"),n=e.find(".guest"),i=e.find("input[name=password]");i.val(""),n.toggleClass("is-guest",t),this.clearRegistrationErrors()},clearRegistrationErrors:function(){this.$(".input-wrapper.has-error").removeClass("has-error").find(".input-label").remove(),this.$("[aria-invalid]").removeAttr("aria-invalid")}});return r}),define("lounge/views/posts/PostReplyView",["jquery","underscore","core/utils","core/bus","core/switches","core/views/PostReplyView","common/models","common/templates","lounge/mixins/post-reply","lounge/common","lounge/views/posts/ContentEditableView","lounge/views/posts/LoginFormView"],function(e,t,n,i,s,a,r,o,l,c,u,d){"use strict";var h=n.preventDefaultHandler,p=a,m=p.prototype,f=p.extend({initialize:function(e){m.initialize.call(this,e),this.listenTo(this.session,"change:audienceSyncVerified",this.redraw),this.userSuggestions=e.userSuggestions,this.loginFormView=new d({thread:this.thread,session:this.session,alert:t.bind(this.alert,this)});var n=c.getLounge();t.each(["uiCallback:postCreated","domReflow","uiAction:createPost"],function(e){this.listenTo(this,e,t.bind(n.trigger,n,e))},this),this.template=o.getTemplate("form"),this.blacklistErrorMessageTemplate=o.getTemplate("blacklistErrorMessage"),this.emailVerifyAlertTemplate=o.getTemplate("emailVerifyAlert")},getTemplateData:function(){var e=m.getTemplateData.call(this);return e.audienceSyncRequired=this.session.needsAudienceSyncAuth(this.thread.forum),e},render:function(){return this.loginFormView.$el.detach(),m.render.call(this),this.loginFormView.render(),this.loginFormView.$el.appendTo(this.$("[data-role=login-form]")),this.session.user.id?this.$el.addClass("authenticated"):this.$el.removeClass("authenticated"),this},createTextarea:function(){var e={placeholder:this.getPlaceholderText(),storageKey:this.post.storageKey()};return this.constructor.canUseContentEditable?(e.userSuggestions=this.userSuggestions,new this.constructor.ContentEditableView(e)):new this.constructor.TextareaView(e)},getPostParams:function(){var t=e.Deferred(),n=m.getPostParams.call(this);return s.isFeatureActive("before_comment_callback",{forum:this.thread.forum.id})?(i.frame.sendHostMessage("posts.beforeCreate",{raw_message:n.raw_message}),this.listenToOnce(i.frame,"posts.beforeCreate.response",function(e){e&&(n.raw_message=e),t.resolve(n)})):t.resolve(n),t.promise()},getAuthorParams:function(){return this.session.isLoggedIn()?{author_id:this.session.user.id}:{author_name:this.loginFormView.getDisplayName(),author_email:this.loginFormView.getEmail()}},initiatePost:function(){var e=t.bind(this.createPost,this);this.getPostParams().done(e)},shouldAbortCreatePost:function(e,n){return this.constructor.mustVerifyEmailToPost(this.session.user,this.thread.forum)?(this.session.fetch().always(t.bind(function(){this.constructor.mustVerifyEmailToPost(this.session.user,this.thread.forum)?this._alertMustVerify(!0):this.createPost(n)},this)),!0):m.shouldAbortCreatePost.call(this,e,n)},_onCreateError:function(e,t){m._onCreateError.call(this,e,t),this.thread.incrementPostCount(-1)},_onCreateSync:function(e,t){
m._onCreateSync.call(this,e,t),this.thread.posts.saveToCache(t)},addPostToThread:function(e){this.thread.incrementPostCount(1),this.thread.posts.add(e)},remove:function(){return this.loginFormView&&(this.loginFormView.remove(),this.loginFormView=null),m.remove.call(this)},submitForm:h(function(){return this.dismissAlert(),this.loginFormView.shouldRegisterUser()?void this.loginFormView.registerUser():this.initiatePost()})},{ContentEditableView:u,User:r.User,Post:r.Post});return l.asRealtimeTyping(f.prototype),f}),define("core/models/RichMediaViewModel",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{deferred:!0,showButtons:!0,activated:!1,kind:"image",deferredHeight:0,providerExpandMessage:"",providerCollapseMessage:"",providerIcon:"icon-proceed",respectSettings:!0}})}),define("core/mediaConfig",["underscore","backbone"],function(e,t){"use strict";function n(){var t=window.document.body.offsetWidth,n=i,s=n.length;return e.find(n,function(e,i){return i+1===s||Math.abs(n[i+1]-t)>Math.abs(n[i]-t)})}var i=[320,480,600,800],s=new t.Model({collapsed:!1,defaultIframeHeight:300,mediaPersistedWidths:i,loadedThumbnailWidth:n()});return s.findClosestThumbnailSize=n,s}),define("core/templates/postMediaInlineLink",["handlebars","core/templates/handlebars.partials","core/extensions/handlebars.helpers"],function(e){return e.template({1:function(e,t,n,i,s){var a;return null!=(a=n["if"].call(null!=t?t:{},null!=t?t.hasUserText:t,{name:"if",hash:{},fn:e.program(2,s,0),inverse:e.noop,data:s}))?a:""},2:function(e,t,n,i,s){var a=e.lambda,r=e.escapeExpression;return'<a href="'+r(a(null!=t?t.href:t,t))+'" rel="nofollow">'+r(a(null!=t?t.text:t,t))+"</a>\n"},4:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression,l=null!=t?t:{};return'<a href="'+o(r(null!=t?t.href:t,t))+'" class="post-media-link" data-action="expand-collapse-media" rel="nofollow">'+(null!=(a=n["if"].call(l,null!=(a=null!=t?t.model:t)?a.providerIcon:a,{name:"if",hash:{},fn:e.program(5,s,0),inverse:e.noop,data:s}))?a:"")+o(r(null!=t?t.mediaLinkText:t,t))+(null!=(a=n["if"].call(l,null!=t?t.domain:t,{name:"if",hash:{},fn:e.program(7,s,0),inverse:e.noop,data:s}))?a:"")+"</a>\n"},5:function(e,t,n,i,s){var a;return'<i class="'+e.escapeExpression(e.lambda(null!=(a=null!=t?t.model:t)?a.providerIcon:a,t))+'"></i>'},7:function(e,t,n,i,s){return'<span class="post-media-link-domain"> &mdash; '+e.escapeExpression(e.lambda(null!=t?t.domain:t,t))+"</span>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a;return null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.model:t)?a.deferred:a,{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.program(4,s,0),data:s}))?a:""},useData:!0})}),define("core/views/RichMediaLinkView",["backbone","core/utils","core/templates/postMediaInlineLink"],function(e,t,n){"use strict";return e.View.extend({tagName:"span",events:{"click [data-action=expand-collapse-media]":"handleToggle"},initialize:function(e){this.media=e.media;var n=e.$link;this.linkText=n.text(),this.linkHref=n.attr("href"),this.linkDomain=t.getDomain(this.linkHref),this.linkHasUserText=this.isUserText(n),this.hasGenericMessage=!1,this.linkHasUserText?this.mediaLinkText=this.linkText:this.media.get("title")?this.mediaLinkText=t.niceTruncate(this.media.get("title"),60):(this.hasGenericMessage=!0,this.mediaLinkText=this.model.get("providerExpandMessage")),this.listenTo(this.model,"change:deferred",this.render),this.listenTo(this.model,"change:activated",this.onChangeActivated)},isUserText:function(e){if("A"!==e[0].nodeName)return!1;var t=(e.text()||"").toLowerCase();if(!t)return!1;if(0===t.indexOf("http")||0===t.indexOf("www"))return!1;t=t.replace(/\.\.\.$/,"");var n=(e.attr("href")||"").toLowerCase();return-1===n.indexOf(t)},render:function(){var e=this.mediaLinkText;return this.hasGenericMessage&&this.model.get("activated")&&(e=this.model.get("providerCollapseMessage")),this.$el.html(n({model:this.model.toJSON(),text:this.linkText,href:this.linkHref,mediaLinkText:e,domain:this.linkDomain,hasUserText:this.linkHasUserText})),this},onChangeActivated:function(){this.hasGenericMessage&&this.render()},handleToggle:function(e){this.model.get("deferred")||(this.model.set("activated",!this.model.get("activated")),e&&e.preventDefault&&e.preventDefault())}})}),define("core/templates/postMedia",["handlebars","core/templates/handlebars.partials","core/extensions/handlebars.helpers"],function(e){return e.template({1:function(e,t,n,i,s){var a;return(null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.media:t)?a.providerName:a,{name:"if",hash:{},fn:e.program(2,s,0),inverse:e.noop,data:s}))?a:"")+e.escapeExpression(e.lambda(null!=(a=null!=t?t.media:t)?a.title:a,t))},2:function(e,t,n,i,s){var a;return e.escapeExpression(e.lambda(null!=(a=null!=t?t.media:t)?a.providerName:a,t))+" &ndash; "},4:function(e,t,n,i,s){var a;return'<i class="'+e.escapeExpression(e.lambda(null!=(a=null!=t?t.model:t)?a.providerIcon:a,t))+' publisher-background-color"></i>'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression,l=null!=t?t:{};return'\n<a class="media-button media-button-expand publisher-color publisher-border-color" href="'+o(r(null!=(a=null!=t?t.media:t)?a.url:a,t))+'" rel="nofollow" target="_blank" data-action="expand"\ntitle="'+(null!=(a=n["if"].call(l,null!=(a=null!=t?t.media:t)?a.title:a,{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?a:"")+'">\n'+(null!=(a=n["if"].call(l,null!=(a=null!=t?t.model:t)?a.providerIcon:a,{name:"if",hash:{},fn:e.program(4,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+o(r(null!=(a=null!=t?t.model:t)?a.providerExpandMessage:a,t))+'\n</a>\n<a class="media-button media-button-contract publisher-color publisher-border-color" href="#" target="_blank" data-action="contract">\n<i class="icon-cancel publisher-background-color"></i> '+o(r(null!=(a=null!=t?t.model:t)?a.providerCollapseMessage:a,t))+'\n</a>\n<div class="media-content-loader" data-role="content-loader"></div>\n<div data-role="content-placeholder" class="media-content-placeholder"></div>\n'},useData:!0})}),define("core/templates/postMediaPlaceholder",["handlebars","core/templates/handlebars.partials","core/extensions/handlebars.helpers"],function(e){return e.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a;return'<a href="#" class="media-force-load" data-action="force-load"><i class="'+e.escapeExpression(e.lambda(null!=(a=null!=t?t.model:t)?a.providerIcon:a,t))+'"></i></a>\n'},useData:!0})}),define("core/views/RichMediaView",["jquery","backbone","core/utils","core/mediaConfig","core/views/RichMediaLinkView","core/templates/postMedia","core/templates/postMediaPlaceholder"],function(e,t,n,i,s,a,r){"use strict";var o=n.preventDefaultHandler,l=function(e,t,n,i){e[t.get(n)?"addClass":"removeClass"](i)};return t.View.extend({className:"media-container",events:{"click [data-action=expand]":"handleExpand","click [data-action=contract]":"handleContract","click [data-action=force-load]":"handleForceLoad"},template:a,initialize:function(e){this.options=e,this.media=e.media,this.template=e.template||this.template,this.$linkEl=null,this.setupMode(),this.listenTo(this.model,"change:activated",this.applyState),this.listenTo(this.model,"change:deferredHeight",this.onChangeDeferredHeight),this.listenTo(this.model,"change:showButtons",this.updateElementClass),this.listenTo(this.model,"change:deferred",this.render),this.listenTo(i,"change:collapsed",this.setupMode)},getMediaDimensions:function(){return{width:null,height:null}},getAvailableWidth:function(){return this.$el.parent().width()||i.get("loadedThumbnailWidth")},updateDeferredHeight:function(){this.model.set("deferredHeight",this.calculateDeferredHeight())},calculateDeferredHeight:function(){var e=this.getMediaDimensions(),t=e.width,n=e.height;if(!t||!n)return n;var i=this.getAvailableWidth(),s=i*n/t;return s},convertToButton:function(e){this.model.set("showButtons",!1),this.linkSubview&&this.linkSubview.remove(),this.linkSubview=new s({model:this.model,media:this.media,$link:e}),e.replaceWith(this.linkSubview.$el),this.linkSubview.render()},applyContentNodeHeight:function(e){this.contentNode.height(e||"auto")},shouldAutoplay:function(){return!this.model.get("deferred")},generateContentHtml:function(){return this.media.get("html")},createContentNode:function(t){return e(t)},insertContentNode:function(e){this.contentNode.html(e)},prepareElementEvents:function(){},displayContent:function(){this.updateDeferredHeight();var e=this.generateContentHtml(),t=this.createContentNode(e);this.prepareElementEvents(t),this.insertContentNode(t),this.applyContentNodeHeight(null)},configureDeferred:function(){this.enterViewport()},configureContentFromActivated:function(){this.model.get("activated")?this.displayContent():this.displayPlaceholder()},displayPlaceholder:function(){this.contentNode.html(r({model:this.model.toJSON()}))},updateElementClass:function(){var e=this.$el,t=this.model;l(e,t,"deferred","media-mode-deferred"),l(e,t,"activated","media-activated"),l(e,t,"showButtons","media-show-buttons")},applyState:function(){this.configureDeferred(),this.configureContentFromActivated(),this.updateElementClass()},render:function(){return this.$el.html(this.template({model:this.model.toJSON(),media:this.media.toJSON()})),this.contentNode=this.$el.find("[data-role=content-placeholder]"),this.applyState(),this},remove:function(){this.linkSubview&&this.linkSubview.remove(),t.View.prototype.remove.apply(this,arguments)},enterViewport:function(){this.model.get("deferred")&&this.activate()},activate:function(){this.model.set("activated",!0)},setupMode:function(){if(this.model.get("respectSettings")){this.model.set("activated",!1);var e=i.get("collapsed");e?this.model.set("deferred",!1):this.model.set("deferred",!0)}},onChangeDeferredHeight:function(){this.model.get("deferred")&&!this.model.get("activated")&&this.applyContentNodeHeight(this.model.get("deferredHeight"))},handleExpand:o(function(){this.model.set("activated",!0)}),handleContract:o(function(){this.model.set("activated",!1)}),handleForceLoad:o(function(){this.model.get("deferred")&&this.model.set("activated",!0)})})}),define("core/templates/postMediaImage",["handlebars","core/templates/handlebars.partials","core/extensions/handlebars.helpers"],function(e){return e.template({1:function(e,t,n,i,s){var a;return' height="'+e.escapeExpression(e.lambda(null!=(a=null!=t?t.model:t)?a.deferredHeight:a,t))+'" '},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression,l=null!=t?t:{};return'<a href="'+o(r(null!=t?t.imageUrl:t,t))+'" target="_blank" rel="nofollow">\n<img src="'+o(r(null!=t?t.thumbnailUrl:t,t))+'" alt="'+o(n.gettext.call(l,"Thumbnail",{name:"gettext",hash:{},data:s}))+'" '+(null!=(a=n["if"].call(l,null!=(a=null!=t?t.model:t)?a.deferredHeight:a,{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?a:"")+">\n</a>\n"},useData:!0})}),define("core/views/ImageRichMediaView",["core/views/RichMediaView","core/utils","core/config","core/mediaConfig","core/templates/postMediaImage"],function(e,t,n,i,s){"use strict";var a=new RegExp("(^|\\.)"+t.getDomain(n.urls.media).split(".").slice(-2).join("\\.")+"$");return e.extend({getMediaDimensions:function(){return{width:this.media.get("thumbnailWidth"),height:this.media.get("thumbnailHeight")}},getImageUrl:function(){return this.media.get("resolvedUrlRedirect")||this.media.get("urlRedirect")||this.media.get("thumbnailUrl")},getImageThumbnailUrl:function(){var e=this.media.get("thumbnailUrl");return this.constructor.isOnDisqusCDN(e)&&(e=t.serialize(e,{w:i.get("loadedThumbnailWidth"),h:this.model.get("deferredHeight")})),e},generateContentHtml:function(){return s({model:this.model.toJSON(),media:this.media.toJSON(),thumbnailUrl:this.getImageThumbnailUrl(),imageUrl:this.getImageUrl()})},prepareElementEvents:function(e){var t=this,n=e.find("img");n.on("load.richMediaView error.richMediaView",function(e){t.trigger(e.type),n.off(".richMediaView")})},calculateDeferredHeight:function(){var t=Math.floor(e.prototype.calculateDeferredHeight.apply(this,arguments)),n=this.getMediaDimensions().height;return Math.min(n,t)||null}},{isOnDisqusCDN:function(e){var n=t.getDomain(e);return a.test(n)}})}),define("core/views/IframeRichMediaView",["underscore","core/mediaConfig","core/views/RichMediaView"],function(e,t,n){"use strict";return n.extend({getMediaDimensions:function(){return{width:this.media.get("htmlWidth"),height:this.media.get("htmlHeight")}},_findIframe:function(e){return e.is("iframe")?e:e.find("iframe")},configureContentFromActivated:function(){n.prototype.configureContentFromActivated.apply(this,arguments),this.model.get("activated")||this.$el.removeClass("media-loading")},createContentNode:function(){var e=n.prototype.createContentNode.apply(this,arguments);return e.attr({width:"100%",height:this.model.get("deferredHeight")}),e},insertContentNode:function(e){this.loaderNode=this.$el.find("[data-role=content-loader]"),this.loaderHeight=this.model.get("deferredHeight")||t.get("defaultIframeHeight"),this.loaderNode.height(this.loaderHeight),this.$el.addClass("media-loading"),n.prototype.insertContentNode.call(this,e)},prepareElementEvents:function(t){var n=this._findIframe(t);n.one("load",e.bind(this.finishLoad,this,n))},finishLoad:function(e){this.$el.removeClass("media-loading"),e.height(this.loaderHeight),this.trigger("load")}})}),define("core/views/FacebookPhotoRichMediaView",["core/views/ImageRichMediaView"],function(e){"use strict";return e.extend({getImageThumbnailUrl:function(){return this.media.get("metadata").imageUrl||e.prototype.getImageThumbnailUrl.call(this)}})}),define("core/views/AutoplayRichMediaView",["underscore","jquery","core/utils","core/views/IframeRichMediaView"],function(e,t,n,i){"use strict";return i.extend({createContentNode:function(){var e=i.prototype.createContentNode.apply(this,arguments),t=e.attr("src");return this.shouldAutoplay()&&t&&!this.model.get("playerjs")&&(t=n.serialize(t,{auto_play:!0,autoplay:1}),e.attr("src",t)),e},insertContentNode:function(n){if(this.model.get("playerjs")){var s=this._findIframe(n),a=s.attr("src");"//"===a.substr(0,2)&&(a=window.location.protocol+a);var r=a.split("/");r=r[0]+"//"+r[2],this.playerjs={ready:!1,queue:[],origin:r,$iframe:s},this.model.get("mute")&&this.send("mute"),this.shouldAutoplay()&&this.send("play");var o=e.once(e.bind(function(){this.playerjs.ready=!0;var t=this.playerjs.queue;this.playerjs.queue=[],e.each(t,this.send,this)},this));t(window).on("message",function(e){if(e=e.originalEvent,e.origin===r){var t;try{t=JSON.parse(e.data)}catch(n){return}"ready"===t.event&&t.value&&t.value.src===a&&o()}})}return i.prototype.insertContentNode.apply(this,arguments)},send:function(e){if(this.playerjs){if(!this.playerjs.ready)return void this.playerjs.queue.push(e);var t={context:"player.js",version:"0.0.10",method:e};this.playerjs.$iframe[0].contentWindow.postMessage(JSON.stringify(t),this.playerjs.origin)}}})}),define("core/views/DynamicHeightRichMediaView",["underscore","core/views/RichMediaView"],function(e,t){"use strict";return t.extend({insertContentNode:function(){t.prototype.insertContentNode.apply(this,arguments),this.finishLoad()},finishLoad:function(){var t=this,n=0,i=150,s=20,a=function(){n+=1,s>n?e.delay(a,i):t.trigger("load")};a()}})}),define("core/templates/postMediaTwitterContent",["handlebars","core/templates/handlebars.partials","core/extensions/handlebars.helpers"],function(e){return e.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a=e.lambda,r=e.escapeExpression;return'<meta name="twitter:widgets:csp" content="on">\n<blockquote class="twitter-tweet" data-theme="'+r(a(null!=t?t.theme:t,t))+'" data-link-color="'+r(a(null!=t?t.linkColor:t,t))+'" lang="'+r(a(null!=t?t.language:t,t))+'">\n<a href="'+r(a(null!=t?t.url:t,t))+'"></a>\n</blockquote>\n<script src="//platform.twitter.com/widgets.js"></script>\n'},useData:!0})}),define("core/views/TwitterRichMediaView",["underscore","core/views/DynamicHeightRichMediaView","core/templates/postMediaTwitterContent"],function(e,t,n){"use strict";var i=t.extend({generateContentHtml:function(){var t=window.document.documentElement.lang;t=t&&t.substring(0,2);var s=this.media.get("url");return-1!==this.media.get("resolvedUrl").indexOf("/status")&&(s=this.media.get("resolvedUrl")),n({url:s,theme:e.result(i,"theme"),linkColor:e.result(i,"linkColor"),language:t})}},{theme:"light",linkColor:"#2e9fff"});return i}),define("core/views/SoundCloudRichMediaView",["core/views/AutoplayRichMediaView"],function(e){"use strict";return e.extend({getMediaDimensions:function(){return{width:null,height:this.media.get("htmlHeight")}}})}),define("core/views/VineRichMediaView",["core/views/AutoplayRichMediaView","core/utils"],function(e,t){"use strict";return e.extend({createContentNode:function(){var n=e.prototype.createContentNode.apply(this,arguments),i=n.attr("src");return this.shouldAutoplay()&&i&&(i=t.serialize(i,{audio:1}),n.attr("src",i)),n}})}),define("core/media",["underscore","core/strings","core/models/Media","core/models/RichMediaViewModel","core/views/ImageRichMediaView","core/views/IframeRichMediaView","core/views/FacebookPhotoRichMediaView","core/views/AutoplayRichMediaView","core/views/TwitterRichMediaView","core/views/SoundCloudRichMediaView","core/views/VineRichMediaView"],function(e,t,n,i,s,a,r,o,l,c,u){"use strict";var d=t.get,h={PLAY_HIDE:{kind:"html",providerExpandMessage:d("Play"),providerCollapseMessage:d("Hide")},VIEW_HIDE:{kind:"html",providerExpandMessage:d("View"),providerCollapseMessage:d("Hide")},VIEW_IMAGE:{kind:"image",providerIcon:"icon-images",providerExpandMessage:d("View"),providerCollapseMessage:d("Hide")}},p=function(t){var d=function(t,n){return e.defaults({providerIcon:n},h[t])},p=null,m=null,f=n.MEDIA_TYPES;switch(t.get("mediaType")){case f.IMAGE:case f.IMAGE_UPLOAD:p=h.VIEW_IMAGE;break;case f.FACEBOOK_PHOTO:m=r,p=h.VIEW_IMAGE;break;case f.VIMEO_VIDEO:case f.YOUTUBE_VIDEO:m=o,p=d("PLAY_HIDE","icon-video");break;case f.TWITTER_STATUS:m=l,p=d("VIEW_HIDE","icon-twitter");break;case f.VINE_VIDEO:m=u,p=d("PLAY_HIDE","icon-video");break;case f.FACEBOOK_VIDEO:p=d("VIEW_HIDE","icon-video");break;case f.SOUNDCLOUD_SOUND:m=c,p=d("PLAY_HIDE","icon-music");break;case f.GOOGLE_MAP:p=d("VIEW_HIDE","icon-map");break;default:return null}if(null===m)switch(p.kind){case"webpage":return null;case"html":m=a;break;case"image":m=s}var g=new i(p);return{Cls:m,mediaViewModel:g}},m=function(e){var t=p(e);return t?new t.Cls({model:t.mediaViewModel,media:e}):null},f=function(e){return new s({model:new i(h.VIEW_IMAGE),media:e})};return{instantiateRichMediaView:m,instantiateRichMediaThumbnail:f,getRichMediaViewConfig:p}}),define("core/mixins/withRichMedia",["underscore","jquery","core/collections/MediaCollection","core/media"],function(e,t,n,i){"use strict";function s(e){var n={};return e.length?(e.find("a").each(function(e,i){var s=i.href;n[s]||(n[s]=t(i))}),n):n}function a(){e.extend(this,r)}var r={renderRichMedia:function(e,a,r){return r=r||{},e=e instanceof n?e:new n(e),e.chain().map(function(e){return i.instantiateRichMediaView(e)}).without(null).map(function(e){var n=e.media.get("urlRedirect");r.normalize&&(n=r.normalize.call(this,n));var i=s(this.$("[data-role=message]")),o=i[n];return r.beforeRender&&r.beforeRender.call(this,e),e.render(),o?r.convertLinkToButton?(o.after(e.$el),e.convertToButton(o)):o.replaceWith(e.$el):(a=a||this.$("[data-role=post-media-list]"),a.append(t("<li>").append(e.$el))),e},this).value()}};return a}),define("core/views/common/HoverCard",["jquery","underscore","backbone","core/bus","core/utils"],function(e,t,n,i,s){"use strict";var a=n.View.extend({events:{mouseenter:"enter",mouseleave:"leave"},initialize:function(){this._id=t.uniqueId(),this._rendered=!1,this._hoverState="out",this._visible=!1,this._enterTimeout=null,this._leaveTimeout=null,a.open={},this.events=this.events||{},this.events["click [data-action=profile]"]="handleShowProfile",this.listenTo(this,"authenticating",this.keepOpen)},render:function(){return this.hide(),e("body").append(this.el),this},target:function(e){e.on("mouseenter",t.bind(this.enter,this,e)),e.on("mouseleave",t.bind(this.leave,this))},enter:function(e){var n=this;e.originalEvent&&(e=null),e&&(n.$target=e),n._leaveTimeout&&clearTimeout(n._leaveTimeout),"in"!==n._hoverState&&(n._hoverState="in",n._enterTimeout=t.delay(function(){"in"===n._hoverState&&n.show(),n._enterTimeout=null},a.DELAY_ENTER),a.open[this.uid]=this)},leave:function(){var e=this;e._enterTimeout&&clearTimeout(e._enterTimeout),"out"!==e._hoverState&&(e._hoverState="out",e._leaveTimeout=t.delay(function(){"out"===e._hoverState&&e.hide(),e._leaveTimeout=null},a.DELAY_LEAVE),a.open[this.uid]&&delete a.open[this.uid])},show:function(){var e=this;e._rendered||(e._rendered=!0,e.render()),e.moveTo(e.$target),e.$el.show(),e._visible=!0,e.trigger("show")},moveTo:function(e){if(e){var t=a.POSITION_OFFSET,n=e.offset(),i=this.$el,s=i.height(),r=this.getContainerPosition();n.top-=t;var o=n.top+s+r.containerOffset.top,l=r.pageOffset+r.containerHeight;l>=o?i.css("top",n.top):i.css("top",n.top-s+2*t),i.css("left",n.left+t)}},getContainerPosition:function(){return{pageOffset:e(window).scrollTop(),containerOffset:{top:0,height:e(window).height()},containerHeight:e(window).height()}},hide:function(){this._keepOpen||(this._enterTimeout&&clearTimeout(this._enterTimeout),this.$el.hide(),this._visible=!1)},keepOpen:function(){this._keepOpen=!0,this.setupKeepOpenCanceler()},setupKeepOpenCanceler:function(){var n=this,s=function(){"out"===n._hoverState&&(n.stopListening(i,"window.click",s),e("body").off("click",s),n._keepOpen=!1,n.hide())};t.delay(function(){n.listenTo(i,"window.click",s),e("body").on("click",s)},100)},isVisible:function(){return this._visible},handleShowProfile:s.preventDefaultHandler(function(){this.hide()})},{open:{},instances:{},DELAY_ENTER:350,DELAY_LEAVE:175,POSITION_OFFSET:20,exitAll:function(){t.invoke(a.open,"leave")},create:function(e,t,n,i){var s=a.instances[n];s||(a.instances[n]=s={});var r=s[e];return r||(r=new i(t),s[e]=r),t.targetElement&&r.target(t.targetElement),r}});return function(){e(window.document).on("mouseout",t.debounce(function(e){var t=e.relatedTarget||e.toElement;t&&"HTML"!==t.nodeName||a.exitAll()},10))}(),a}),define("core/utils/views",["underscore"],function(e){"use strict";var t=function(t,n,i){var s=t.prototype,a=e.extend({},n,i);if(e.defaults(s,a),e.defaults(s.events,a.events),void 0!==s.initialize&&void 0!==a.initialize){var r=s.initialize;s.initialize=function(){var e=r.apply(this,arguments);return a.initialize.apply(this,arguments),e}}};return{mixin:t}}),define("core/views/common/mixins/LocalScroll",[],function(){"use strict";var e={events:{mousewheel:"handleScrollEvent",wheel:"handleScrollEvent"},scrollMeasureSelector:"",getScrollMeasure:function(){return this.scrollMeasure||(this.scrollMeasure=this.$el,this.scrollMeasureSelector&&(this.scrollMeasure=this.$el.find(this.scrollMeasureSelector))),this.scrollMeasure},handleScrollEvent:function(e){var t=e.originalEvent,n=t.wheelDeltaY||-t.deltaY,i=this.$el,s=i.height(),a=this.getScrollMeasure(),r=a.height(),o=a.parent()[0].scrollTop,l=o>=r-s,c=0===o;(l&&0>n||c&&n>0)&&e.preventDefault()}};return e}),define("core/templates/usersCard",["handlebars","core/templates/handlebars.partials","core/extensions/handlebars.helpers"],function(e){return e.template({1:function(e,t,n,i,s){return"guests-only"},3:function(e,t,n,i,s){var a;return null!=(a=n.each.call(null!=t?t:{},null!=t?t.users:t,{name:"each",hash:{},fn:e.program(4,s,0),inverse:e.noop,data:s}))?a:""},4:function(e,t,n,i,s){var a;return null!=(a=e.invokePartial(i.cardUser,t,{name:"cardUser",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:""},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a,r=null!=t?t:{};return'<div class="tooltip upvoters '+(null!=(a=n.unless.call(r,null!=(a=null!=t?t.users:t)?a.length:a,{name:"unless",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?a:"")+'">\n<ul class="scroll-measure" data-role="content">\n'+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.users:t)?a.length:a,{name:"if",hash:{},fn:e.program(3,s,0),inverse:e.noop,data:s}))?a:"")+'</ul>\n</div>\n<div class="tooltip-point hidden"></div>\n'},usePartial:!0,useData:!0})}),define("core/views/UsersCard",["jquery","underscore","handlebars","core/config","core/bus","core/utils/views","core/views/common/HoverCard","core/views/common/mixins/LocalScroll","core/templates/usersCard"],function(e,t,n,i,s,a,r,o,l){"use strict";var c=function(e){return e.get("isAnonymous")||e.get("isBlocked")},u=r.extend({guestTextPartialName:"cardOtherUserText",className:"tooltip-outer upvoters-outer",initialize:function(e){r.prototype.initialize.call(this,e),this.collection=this.collection||e.collection,this.session=e.session,this.numUsers=e.numUsers,this.listenTo(this.collection,"add",this.addUser),this.listenTo(this.collection,"change:isBlocked",this.render),this.listenTo(this.collection,"remove",this.removeUser),this.listenTo(this.collection,"reset",this.render)},addUser:function(e){c(e)?this.updateGuests():this.$listEl&&this.$listEl.length&&(this.$listEl.prepend(n.partials.cardUser(t.extend({highlight:!0},e.toJSON()))),this.stopHighlightUsername())},removeUser:function(e){if(c(e))this.updateGuests();else{var t=this.$el.find("[data-username="+e.get("username")+"]");t.length&&t.remove()}},stopHighlightUsername:t.debounce(function(){var e=this.$el.find(".highlight");e.removeClass("highlight")},1100),getGuestCount:function(){return Math.max(this.numUsers-this.collection.reject(c).length,0)},updateGuests:function(){var e=this.$el.find("[data-role=guest]"),t=this.getGuestCount(),s=n.partials[this.guestTextPartialName]({guestCount:t}),a={guestCount:t,guestAvatarUrl:i.urls.avatar.generic,highlight:e.length,guestText:s},r=n.partials.cardGuestUser(a);e.length?(e.replaceWith(r),this.stopHighlightUsername()):this.$listEl&&this.$listEl.length&&this.$listEl.append(r)},render:function(){delete this.pointEl,this.$el.html(l({users:t.invoke(this.collection.reject(c),"toJSON"),highlight:!1})),r.prototype.render.call(this),this.$listEl=this.$el.find(".upvoters ul"),this.updateGuests()},show:function(){this.numUsers&&!this.isVisible()&&(r.prototype.show.call(this),s.trigger("uiAction:userCardShow"))},showPoint:function(e){var n=["tl","bl"];this.pointEl||(this.pointEl=this.$el.find(".tooltip-point"),this.pointEl.removeClass("hidden")),t.each(n,function(e){this.pointEl.removeClass("point-position-"+e)},this),this.pointEl.addClass("point-position-"+e)},moveTo:function(e,t){if(e){var n=r.POSITION_OFFSET,i=e.offset(),s=this.$el,a=s.height(),o=this.getContainerPosition();t&&(a+=s.find("li.user").height()+10),i.top-a-n>=0&&i.top-a+o.containerOffset.top>=o.pageOffset?(s.css({bottom:o.containerOffset.height-i.top+n,top:"inherit"}),this.showPoint("bl")):(s.css({bottom:"inherit",top:i.top+2*n}),this.showPoint("tl")),s.css("left",i.left-n)}},handleShowProfile:function(t){r.prototype.handleShowProfile.call(this,t);var n=e(t.currentTarget),i=n.attr("data-username");s.trigger("uiCallback:showProfile",i)}},{create:function(e,t){return r.create(e,t,"UsersCard",u)}});return a.mixin(u,o,{scrollMeasureSelector:"[data-role=content]"}),u}),define("core/views/UpvotersCard",["underscore","core/views/common/HoverCard","core/views/UsersCard","core/bus","core/utils"],function(e,t,n,i,s){"use strict";var a=s.preventDefaultHandler,r=n.extend({guestTextPartialName:"cardGuestUpvoterText",initialize:function(t){var i=t.model,s=i.getUpvotersUserCollection();e.extend(t,{collection:s,numUsers:i.get("likes")}),n.prototype.initialize.call(this,t),this.model=i,this.session=t.session,this.likes=i.get("likes"),this.hadLikes=Boolean(this.likes),this._fetched=!1,this._rendered=!1,this.listenTo(this.model,"change:userScore",this.updateUserSet),this.listenTo(this.model,"change:likes",this.updateGuests)},updateGuests:function(){this.numUsers=this.model.get("likes")||0,n.prototype.updateGuests.call(this)},updateUserSet:function(){var e=this.session.user,t=this.likes,n=!1;this.likes=this.model.get("likes"),this.model.get("userScore")>0?(this.session.isLoggedIn()&&this.collection.add(e),this.likes&&!t?(this._rendered=!1,this.show()):n=!!this.session.isLoggedOut()||Boolean(this.likes-1-this.collection.length)):(this.collection.remove(e),this.likes||this.hide()),this.updateGuests(),this.moveTo(this.$target,n)},show:function(){if(this.likes&&!this.isVisible()){if(this.hadLikes||(this._fetched=!0),!this._fetched)return void this.collection.fetch().done(e.bind(function(){this._fetched=!0,this.show()},this));var t=this.session.user;this.model.get("userScore")>0&&this.session.isLoggedIn()&&!this.collection.contains(t)&&this.collection.add(t),n.prototype.show.call(this),i.trigger("uiAction:upvotersCardShow")}},handleShowProfile:a(function(e){n.prototype.handleShowProfile.call(this,e),i.trigger("uiAction:showProfileFromUpvotes")})},{create:function(e){var n=e.model;if(n.has("id"))return t.create(n.get("id"),e,"UpvotersCard",r)}});return r}),define("lounge/views/cards",["jquery","underscore","lounge/common","core/utils","common/models","common/templates","common/views/mixins","core/views/common/HoverCard","core/views/UpvotersCard"],function(e,t,n,i,s,a,r,o,l){"use strict";o.prototype.getContainerPosition=function(){var e=n.getLounge().getPosition();return{pageOffset:e.pageOffset,containerOffset:e.frameOffset,containerHeight:e.height}},function(){e(window.document).on("mouseout",t.debounce(function(e){var t=e.relatedTarget||e.toElement;t&&"HTML"!==t.nodeName||o.exitAll()},10))}();var c=o.extend({className:"tooltip-outer profile-card",events:t.defaults({"click [data-action=toggleFollow]":"toggleFollow"},o.prototype.events),initialize:function(e){var t=this;o.prototype.initialize.call(t,e),t.session=e.session,t.user=e.user,t._fetched=!1,t.listenTo(t.session,"change:id",function(){this._rendered&&this.render()})},onFetch:function(e){this.user=new s.SyncedUser(e.attributes),this.updateCounters(),this.updateActions(),this.listenTo(this.user,{"change:numPosts change:numLikesReceived":t.debounce(function(){this.updateCounters()}),"change:isFollowing":this.updateActions})},serialize:function(){var e=this.user.toJSON({session:this.session});return e.numLikesReceived=e.numLikesReceived||this.user.get("numVotes")||0,{user:e,showFollowButton:this.user.has("isFollowing")||this.session.isLoggedOut()}},render:function(){this.$el.html(a.render("hovercard",this.serialize())),o.prototype.render.call(this)},updateCounters:function(){this.$el.find("[data-role=counters]").html(a.render("hovercardCounters",this.serialize()))},updateActions:function(){this.$el.find("[data-role=actions]").html(a.render("hovercardActions",this.serialize()))},show:function(){this._fetched||(this._fetched=!0,this.user.fetch({success:t.bind(this.onFetch,this)})),o.prototype.show.call(this)}},{create:function(e){var t=e.user;return o.create(t.id,e,"ProfileCard",c)}});t.extend(c.prototype,r.FollowButtonMixin);var u=o.extend({className:"context-card tooltip-outer",initialize:function(e){var t=this;o.prototype.initialize.call(t,e),t.post=e.post},render:function(){var e=this.post,t=e.toJSON();t.excerpt=i.niceTruncate(t.plaintext,40),this.$el.html(a.render("contextCard",{post:t})),o.prototype.render.call(this)}},{create:function(e){var t=e.post;return o.create(t.id,e,"ContextCard",u)}});return{HoverCard:o,ProfileCard:c,ContextCard:u,UpvotersCard:l}}),define("core/views/SourcelessIframeRichMediaView",["jquery","core/mediaConfig","core/views/RichMediaView"],function(e,t,n){"use strict";return n.extend({createContentNode:function(t){return e("<iframe>").attr({frameBorder:0,scrolling:"no",width:"100%",height:this.model.get("deferredHeight"),"data-src":t,src:'javascript:window.frameElement.getAttribute("data-src");'})},insertContentNode:function(e){n.prototype.insertContentNode.apply(this,arguments);var i=this.model.get("deferredHeight")||t.get("defaultIframeHeight");
e.height(i)}})}),define("lounge/views/media",["underscore","stance","core/utils","core/utils/storage","core/utils/html/toHexColorString","core/media","core/mediaConfig","core/models/RichMediaViewModel","core/views/RichMediaLinkView","core/views/RichMediaView","core/views/IframeRichMediaView","core/views/SoundCloudRichMediaView","core/views/AutoplayRichMediaView","core/views/SourcelessIframeRichMediaView","core/views/DynamicHeightRichMediaView","core/views/TwitterRichMediaView","core/views/ImageRichMediaView","core/views/FacebookPhotoRichMediaView","core/views/VineRichMediaView","lounge/common"],function(e,t,n,i,s,a,r,o,l,c,u,d,h,p,m,f,g,v,w,b){"use strict";function y(){var t=i.get("disqus.collapse-media");return e.isBoolean(t)||(t=n.isMobileUserAgent()),t}return e.extend(c.prototype,{topEdgeOffset:function(){return-b.getLounge().getPosition().height},configureDeferred:function(){this.model.get("deferred")&&!this.model.get("activated")&&this.listenToOnce(t(this),"enter",function(){this.relatedPost&&this.listenToOnce(this,"load error",function(){b.getLounge().postsView.onDeferredViewReady(this.relatedPost)}),this.enterViewport()}),this.listenToOnce(b.getLounge().postsView,"render:end",this.updateDeferredHeight)}}),f.theme=function(){return b.getLounge().config.colorScheme},f.linkColor=function(){return s(b.getLounge().config.anchorColor)},r.set({collapsed:y()}),r.on("change:collapsed",function(e,t){i.set("disqus.collapse-media",t)}),{settings:r,getCollapseDefault:y,getDomain:n.getDomain,RichMediaLinkView:l,RichMediaViewModel:o,RichMediaView:c,IframeRichMediaView:u,SoundCloudRichMediaView:d,AutoplayRichMediaView:h,SourcelessIframeRichMediaView:p,DynamicHeightRichMediaView:m,TwitterRichMediaView:f,ImageRichMediaView:g,FacebookPhotoRichMediaView:v,VineRichMediaView:w,instantiateRichMediaView:a.instantiateRichMediaView,getRichMediaViewConfig:a.getRichMediaViewConfig}}),define("lounge/views/posts/BlacklistView",["jquery","underscore","backbone","core/api","core/utils","common/templates"],function(e,t,n,i,s,a){"use strict";var r=s.preventDefaultHandler,o=n.View.extend({tagName:"form",className:"moderate",events:{submit:"submit","click [data-action=cancel]":"cancel"},initialize:function(){this.model.get("ipAddress")&&this.model.author.get("email")?this.loading=(new e.Deferred).resolve().promise():this.loading=this.model.fetch()},render:function(){var e=this.$el;return e.addClass("loading"),this.loading.done(t.bind(function(){e.removeClass("loading"),e.html(a.render("blacklist",{post:this.model.toJSON()}))},this)),this},cancel:r(function(){this.trigger("cancel")}),submit:r(function(){var e={},n=this;n.$el.find("select, input").each(function(){var t=this.value&&this.value.trim();(this.checked||("text"===this.type||"SELECT"===this.tagName)&&t)&&(e[this.name]=t)}),t.isEmpty(t.pick(e,"email","user","ip"))||(e.forum=n.model.get("forum"),i.call("blacklists/add.json",{method:"POST",data:e,success:function(){n.trigger("success")}}))})});return o}),define("lounge/views/posts/PostEditView",["backbone","core/mixins/withAlert","core/views/TextareaView","common/templates"],function(e,t,n,i){"use strict";var s=e.View.extend({tagName:"form",className:"edit",events:{submit:"submitForm","click [data-action=cancel]":"cancel"},initialize:function(e){this.post=e.post,this.session=e.session,this._alertSelector="[role=postbox-alert]"},cancel:function(){this.trigger("cancel")},render:function(){var e=this.post.toJSON();this.$el.html(i.render("edit",{post:e,user:this.session.toJSON()}));var t=this.textarea=new n({value:e.raw_message});return this.$("[data-role=textarea]").prepend(t.render().el),this},resize:function(){this.textarea.resize()},submitForm:function(e){this.dismissAlert(),e&&e.preventDefault()&&e.preventDefault();var t=this,n={raw_message:this.textarea.get()},i=t.post.validateMessage(n);return void 0!==i?this.alert(i,{type:"error"}):(t.trigger("submitted"),void t.post.save(n,{success:function(){}}))},remove:function(){this.$el.remove()}});return t.call(s.prototype),s}),define("lounge/views/posts/TypingUserView",["backbone","core/strings"],function(e,t){"use strict";var n=t.get,i=e.View.extend({initialize:function(e){this.options=e},render:function(){var e,i=this.options.parentView.reply,s=i&&i.typingUser,a=this.model.usersTyping.count(s&&s.id);return 0>=a?void this.$el.hide():(1===a?e=n("One other person is typing…"):(e=n("%(num)s other people are typing…"),e=t.interpolate(e,{num:a})),this.$el.text(e),this.$el.show(),this)}});return i}),define("core/views/Tooltip",["jquery","core/views/common/HoverCard"],function(e,t){"use strict";var n=t.extend({className:"tooltip-outer message-card",initialize:function(e){t.prototype.initialize.call(this,e),this.template=e.template,this.message=e.message},render:function(){if(this.template)this.$el.html(this.template());else{if(!this.message)return;this.$el.html(e("<div>").addClass("tooltip").text(this.message))}t.prototype.render.call(this)},moveTo:function(e){if(e){var t=this.constructor.POSITION_OFFSET,n=e.offset(),i=this.getContainerPosition(),s=this.$el.width();this.$el.css({bottom:i.containerOffset.height-n.top+t,top:"inherit",left:n.left-s/2})}}},{create:function(e){return t.create(e.id,e,"Tooltip",n)},POSITION_OFFSET:10});return n}),define("core/views/ClickTooltip",["underscore","core/views/common/HoverCard","core/views/Tooltip"],function(e,t,n){"use strict";var i=n.extend({target:function(t){t.on("click",e.bind(this.targetClicked,this,t)),t.on("mouseleave",e.bind(this.leave,this))},targetClicked:function(e){e&&(this.$target=e),"in"!==this._hoverState&&(this._hoverState="in",this.show(),n.open[this.uid]=this)}},{create:function(e){return t.create(e.id,e,"ClickTooltip",i)}});return i}),define("lounge/views/post",["jquery","underscore","backbone","stance","core/api","core/strings","core/switches","core/utils","core/mixins/withAlert","core/mixins/withRichMedia","core/WindowBus","common/templates","common/urls","common/utils","lounge/common","lounge/mixins","lounge/views/cards","lounge/views/media","lounge/views/posts/BlacklistView","lounge/views/posts/PostEditView","lounge/views/posts/PostReplyView","lounge/views/posts/TypingUserView","core/views/ClickTooltip","core/views/Tooltip"],function(e,t,n,i,s,a,r,o,l,c,u,d,h,p,m,f,g,v,w,b,y,x,_,C){"use strict";var S=o.preventDefaultHandler,k=a.get,E=new u,T=n.View.extend({tagName:"li",className:"post",events:{"click > [data-role=post-content] [data-action]":function(n){var i=this,s=e(n.currentTarget).attr("data-action"),a=i.actions[s];return a?(t.isFunction(a)?a:i[a]).call(i,n):void 0},"click [data-role=allstar]":function(){E.broadcast("click:allstar")}},actions:{upvote:S(function(e){this.handleVote(e,1)}),downvote:S(function(e){this.handleVote(e,-1)}),reply:"handleReply",flag:"handleFlag","block-user":"handleBlockUser",edit:"handleEdit","delete":"handleDelete",spam:"handleSpam",blacklist:"handleBlacklist",highlight:"handleHighlight",unhighlight:"handleUnhighlight",collapse:"handleCollapse",reveal:"handleReveal","share:twitter":"_onShare","share:facebook":"_onShare","copy-link":"handleCopyLink"},initialize:function(e){this.thread=e.thread,this.session=e.session,this.created=Boolean(e.created),this.options=e,this.userSuggestions=e.userSuggestions,this.setAlertSelector("> [role=alert]"),this.listenTo(this.model,{"change:isDeleted spam":this.removeAsDeleted,"change:message":this.stopLoading,"change:points":this.updateVotePoints,"change:userScore":this.updateActiveUserVote,"change:isFlaggedByUser":this.updateUserFlagged,"change:isHighlighted":function(){this.redraw()},change:function(){var e=this.model.changedAttributes();(e.id||e.message)&&this.redraw()}}),this.model.author&&this.listenTo(this.model.author,"change:isBlocked",this.redraw),this.listenTo(this.model.usersTyping,"add remove reset change",this.updateTypingCount),this.listenTo(this.session,"change:id",function(){this.updateFooter(),this.updateMenu(),this.updateSessionClass()}),this.reply=null,this.edit=null,this.parent=e.parent,this.trackPosition=!1,this.offset={top:-1,height:-1},this.dim={height:-1,width:-1},this.listenTo(m.getLounge(),"domReflow",this.calcRect),this.isCollapseAllowed=!0,this.haveSubscribedToRichMediaEvents=!1},calcRect:function(){if(!this.trackPosition||!this.visible)return this.offset={top:-1,height:-1},void(this.dim={height:-1,width:-1});var e=this.contentNode;this.offset=e.offset(),this.dim={height:e.height(),width:e.width()}},createTypingUserView:function(){var e=this.$el.find("[data-role=realtime-notification\\:"+this.model.id+"] .realtime-replies");this.typingUserView=new x({parentView:this,model:this.model,el:e})},updateTypingCount:function(){this.typingUserView||this.createTypingUserView(),this.typingUserView.render()},stopLoading:function(){this.contentNode.find(".loading").removeClass("loading")},updateRelativeTime:function(){this.contentNode.find("[data-role=relative-time]").text(this.model.getRelativeCreatedAt())},updateSessionClass:function(){var e="authored-by-session-user";this.model.isAuthorSessionUser(this.session)?this.contentNode.addClass(e):this.contentNode.removeClass(e)},updateActiveUserVote:function(){var e=this.model,t=this.contentNode.find("[data-action=upvote]"),n=this.contentNode.find("[data-action=downvote]");n.removeClass("downvoted"),t.removeClass("upvoted"),e.get("userScore")>0?t.addClass("upvoted"):e.get("userScore")<0&&n.addClass("downvoted")},updateVotePoints:function(){var n=this.model,i=this.contentNode.find("[data-role=likes], [data-role=dislikes]"),s=this.contentNode.find("[data-action=upvote], [data-action=downvote]"),a=function(e){t.delay(function(){e.addClass("update"),t.delay(function(){e.removeClass("update")},1e3)},500)};t.each(i,function(t,i){t=e(t);var r=t.html(),o=n.get(t.attr("data-role")),l=e(s[i]);o=Math.max(o,0).toString(),r!==o&&(l.removeClass("count-"+r),l.addClass("count-"+o),t.html(o),a(t))})},updateFooter:function(){var e=this.contentNode.find("footer"),t=d.render("postFooter",{post:this.getPostAttributes(),session:this.session.toJSON()});y.open[this.model.cid]&&this.toggleReplyLink(!0),e.html(t),this.initUpvotersCard()},updateMenu:function(){var e=this.contentNode.find("[data-role=menu]"),t=d.render("postMenu",{session:this.session.toJSON(),post:this.getPostAttributes()});e.replaceWith(t)},updatePostStateClasses:function(){var e=this.model,t=e.get("isHighlighted")||e.get("isSponsored");this.$el.toggleClass("highlighted",Boolean(t)),this.contentNode.toggleClass("disabled",!e.id)},updateUserFlagged:function(){this.model.get("isFlaggedByUser")?this.contentNode.addClass("user-reported"):this.contentNode.removeClass("user-reported")},getMessageContent:function(){return this.messageContent&&this.messageContent.length||(this.messageContent=this.contentNode.find("[data-role=message-content]")),this.messageContent},manageMessageHeight:function(e){var t=this,n=t.getMessageContent(),i=1.5*t.collapsedHeight,s=n&&n.length&&n.height()||0;s+=e||0,s>i&&!t.$el.hasClass("collapsed")?t.collapse():t.expand(!0)},preventCollapsing:function(e){e.get("deferred")||(this.expand(),this.isCollapseAllowed=!1)},markSeen:function(){function e(){n.contentNode.addClass("seen"),t.delay(function(){n.contentNode.removeClass("seen"),n.contentNode.removeClass("new")},1e4),n.trackPosition=!1}var n=this,s=i(n);s.isVisible()?e():this.listenToOnce(s,"enter",e)},renderMedia:function(){var e=this.model.media;if(e&&e.length){var n=this.$el.find("[data-role=post-media-list]");this.richMediaViews=this.renderRichMedia(e,n,{convertLinkToButton:!0,beforeRender:function(e){this.listenTo(e.model,"change:activated",this.preventCollapsing),e.relatedPost=this.model.cid},normalize:function(e){var t=o.bleachFindUrls(e);return t.length&&(e=t[0].url),e}}),!this.haveSubscribedToRichMediaEvents&&this.richMediaViews.length&&(this.listenTo(v.settings,"change:collapsed",function(e,n){if(n)this.manageMessageHeight();else{var i=t.reduce(this.richMediaViews,function(e,t){return e+(t.model.get("deferredHeight")||0)},0);this.manageMessageHeight(i)}}),this.haveSubscribedToRichMediaEvents=!0)}},renderSpoilers:function(){this.$el.find("spoiler").each(function(){e(this).attr("tabindex","0")})},getStateByline:function(){var e,t=this.model;return t.get("isHighlighted")?e={icon:"trophy",text:k("Featured by %(forum)s"),style:"default"}:t.get("isSponsored")?e={icon:"trophy",text:k("Sponsored on Disqus"),style:"sponsored"}:t.isAuthorSessionUser(this.session)&&(t.get("isApproved")||(e={icon:"clock",text:k("Hold on, this is waiting to be approved by %(forum)s."),style:"default"})),e&&(e.text=a.interpolate(e.text,{forum:this.thread.forum.get("name")})),e},getTemplate:function(e){return e.isDeleted?"postDeleted":this.model.author&&this.model.author.get("isBlocked")?"postBlocked":this.model.isAuthorSessionUser(this.session)&&!e.isApproved?"post":e.isMinimized?"postMinimized":"post"},getPostAttributes:function(){var e=this.model.toJSON({session:this.session,thread:this.thread}),t=this.model.getParent();return t&&t.get("isSponsored")&&(e.canBeRepliedTo=!1,e.hideViewAllComments=t.get("hideViewAllComments")),e},render:function(){var e=this.$el,t=this.getPostAttributes(),n=m.getLounge(),i=this.thread.forum.get("avatar"),s=this.model.getParent(),a=this.getTemplate(t);return!t.message&&t.raw_message&&p.isPlainText(t.raw_message)&&(t.message=this.model.constructor.formatMessage(t.raw_message)),e.html(d.render(a,{post:t,forumName:this.thread.forum.get("name"),session:this.session.toJSON(),thread:this.thread.toJSON(),created:this.created,parentPost:s&&s.toJSON({session:this.session,thread:this.thread}),defaultAvatarUrl:i?i.large.cache:h.avatar.generic,stateByline:this.getStateByline(),isInHome:m.getLounge().isInHome()})),"postMinimized"===a||"postDeleted"===a||"postBlocked"===a?e.addClass("minimized"):e.removeClass("minimized"),!this.options.excludeAnchor&&this.model.id&&e.attr("id","post-"+this.model.id),this.contentNode=e.find("[data-role=post-content]"),this.childrenNode=e.find("[data-role=children]"),this.messageNode=this.contentNode.find("[data-role=message]"),this.highlightSyntax(),this.processMentions(),this.initCards(),this.updatePostStateClasses(),this.renderMedia(),this.renderSpoilers(),this.model.get("isRealtime")&&(this.trackPosition=!0,this.listenToOnce(n.postsView,"render:end",this.markSeen)),this.listenToOnce(n.postsView,"render:end",function(){this.markSeen(),this.manageMessageHeight()}),this},highlightSyntax:function(){var e=this.contentNode.find("pre code");e.length&&e.each(function(){p.syntaxHighlighter.highlight(this)})},redraw:function(){var e=window.document.createDocumentFragment();this.childrenNode.children().appendTo(e),this.render(),this.childrenNode.append(e),m.getLounge().postsView.trigger("render:end"),m.getLounge().trigger("domReflow")},processMentions:function(){this.contentNode.find("[data-dsq-mention]").each(function(){var t=e(this),n=t.attr("data-dsq-mention").split(":")[0];t.attr("data-action","profile"),t.attr("data-username",n),t.addClass("mention")})},attachChild:function(e){var t=e.model;t.created||!t.id||t.get("isImmediateReply")?this.childrenNode.prepend(e.el):this.childrenNode.append(e.el)},toggleReply:function(){this.reply&&this.reply.isOpen()?this.hideReply():this.showReply()},toggleReplyLink:function(e){this.contentNode.find("[data-role=reply-link]").toggleClass("active",e)},showReply:function(){this.reply?(this.$el.find("[data-role=reply-form]").first().prepend(this.reply.$el),this.reply.show(),this.reply.focus()):this.getReplyView(),this.toggleReplyLink(!0)},hideReply:function(){this.reply&&(this.reply.hide(),this.toggleReplyLink(!1))},toggleEdit:function(){return this.contentNode.find("[data-role=edit-link]").toggleClass("active"),this.edit?(this.edit.remove(),this.edit=null,void this.messageNode.show()):void this.showEdit()},showEdit:function(){if(this.session.isLoggedOut())return void this.listenToOnce(this.session,"change:id",this.toggleEdit);if(this.model.canBeEdited(this.session,this.thread)&&!this.edit){this.edit=new b({post:this.model,session:this.session}),this.edit.render(),this.listenTo(this.edit,"submitted cancel",this.toggleEdit),this.expand(!0);var e=this.messageNode;e.parent().prepend(this.edit.$el),e.hide(),this.edit.resize();var t=m.getLounge();t&&t.scrollToPost(this.model.id)}},removeAsDeleted:function(){this.redraw()},initCards:function(){var e=this;e.initProfileCard(),e.initContextCard(),e.initUpvotersCard(),e.initAnonVoteCards(),e.initTooltips()},initProfileCard:function(){if(!o.isMobileUserAgent()){var e=this.$el.find(".hovercard");e.length&&(this.profileCard=g.ProfileCard.create({session:this.session,user:this.model.author,targetElement:e}))}},initContextCard:function(){if(!o.isMobileUserAgent()){var e=this.parent&&this.parent.model;e&&!e.get("isDeleted")&&(this.contextCard=g.ContextCard.create({post:e,targetElement:this.$el.find("[data-role=parent-link]")}))}},initUpvotersCard:function(){if(!o.isMobileUserAgent()){var e=this.$el.find("[data-action=upvote]");e.length&&(this.upvotersCard=g.UpvotersCard.create({session:this.session,model:this.model,targetElement:e}))}},initAnonVoteCards:function(){this.session.isLoggedOut()&&!this.thread.forum.get("settings").allowAnonVotes&&(this.anonVoteCards=this.anonVoteCards||{},t.each({upvote:"anonUpvoteCard",downvote:"anonDownvoteCard"},function(e,t){this.anonVoteCards[t]&&(this.anonVoteCards[t].remove(),this.anonVoteCards[t]=null);var n=this.$("[data-action="+t+"]");n.length&&(this.anonVoteCards[t]=_.create({targetElement:n,template:d.getTemplate(e),id:"anon"+t+this.model.id}))},this),this.anonVoteCards.upvote&&this.listenTo(this.anonVoteCards.upvote,"show",this.closeUpvotersCard))},initTooltips:function(){if(!o.isMobileUserAgent()){var t=this.$el.find("[data-toggle=tooltip]");t.length&&t.each(function(t,n){var i=e(n),s=i.attr("title");i.attr("data-original-title",s).attr("title",""),C.create({targetElement:i,message:s,id:s})})}},closeUpvotersCard:function(){this.upvotersCard&&this.upvotersCard.hide()},_onShare:S(function(e){var t=p.extractService(e.target,"share");t&&(m.getLounge().trigger("uiAction:postShare",this.model,t),this.share(t))}),handleBlacklist:S(function(){if(!this.blacklist){var e=this.blacklist=new w({model:this.model});e.render(),this.listenTo(e,"success cancel",function(){this.blacklist.remove(),this.blacklist=null}),this.contentNode.find("[data-role=blacklist-form]").first().append(e.el)}}),toggleCollapse:function(e){this.$el.toggleClass("collapsed",e)},handleCollapse:S(function(){this.toggleCollapse()}),handleHighlight:S(function(){this.model.highlight(),this.alert(d.render("highlightedSuccessMessage"),{safe:!0,type:"success"}),this.thread.set("highlightedPost",this.model);var e=m.getLounge();e&&e.scrollToPost(this.model.id)}),handleUnhighlight:S(function(){this.model.unhighlight(),this.dismissAlert(),this.thread.unset("highlightedPost")}),handleVote:function(e,t){if(!this.thread.forum.get("settings").allowAnonVotes&&this.session.isLoggedOut())return void this.queueAuthAction(function(){this.handleVote(e,t)},this);var n=m.getLounge(),i=this.model.get("userScore")===t;i?n.trigger("uiAction:postUnvote",this.model,e):1===t?n.trigger("uiAction:postUpvote",this.model,e):-1===t&&n.trigger("uiAction:postDownvote",this.model,e),this.model.vote(i?0:t)},queueAuthAction:function(e,t){this.listenToOnce(this.session,"change:id",function(){this.session.isLoggedIn()&&e.call(t)}),this.session.authenticate("disqusDotcom")},getReplyView:function(){return this.reply?this.reply:(this.reply=new y({parentView:this,parent:this.model,thread:this.thread,session:this.options.session,userSuggestions:this.userSuggestions,shouldShowEmailAlertInForm:!0}),this.reply.render(),this.showReply(),this.reply)},handleReply:S(function(){this.toggleReply()}),handleFlag:S(function(){if(!this.model.get("isFlaggedByUser")){if(r.isFeatureActive("login_prompt_flag")&&this.session.isLoggedOut()){var e=this;return e._pendingFlagComplete=!1,void e.queueAuthAction(function(){e._pendingFlagComplete||(e._pendingFlagComplete=!0,setTimeout(function(){e.handleFlag()},400))})}var t=k("Are you sure you want to flag this comment?");window.confirm(t)&&(this.model.report(),this.model.set("isFlaggedByUser",!0))}}),handleBlockUser:S(function(){var e=k("Are you sure you want to block this user?");if(window.confirm(e)){this.dismissAlert(function(e){return e.options&&e.options.isBlockError});var t=this;this.model.author.block().fail(function(e){var n=k("Something went wrong while trying to block this user. Please try again later."),i=e&&e.responseJSON&&e.responseJSON.code;i===s.ERROR_CODES.MAX_ITEMS_REACHED&&(n=k("Unfortunately this user could not be blocked; you have reached the limit for number of users blocked.")),t.alert(n,{type:"error",isBlockError:!0})})}}),handleEdit:S(function(){this.toggleEdit()}),handleDelete:S(function(){var e=k("Are you sure you want to delete this comment? You cannot undo this action.");(this.session.user.id!==this.model.author.id||window.confirm(e))&&(this.model.get("isHighlighted")&&(this.model.set("isHighlighted",!1),this.thread.unset("highlightedPost")),this.model._delete())}),handleSpam:S(function(){this.model.spam()}),handleReveal:S(function(){this.model.set("isMinimized",!1),this.redraw()}),handleExpandMessage:S(function(){return this.expand()}),handleCopyLink:function(e){e.target.select(),window.document.execCommand("copy")}});return t.extend(T.prototype,f.ShareMixin),l.call(T.prototype),f.asCollapsible.call(T.prototype,{collapsedHeight:374,collapseTargetSelector:"[data-role=message-container]",collapseScope:"contentNode"}),c.call(T.prototype),T}),define("lounge/views/posts/collection",["jquery","underscore","backbone","moment","core/bus","core/strings","core/switches","common/models","common/utils","lounge/views/posts/PostReplyView","lounge/views/post"],function(e,t,n,i,s,a,r,o,l,c,u){"use strict";var d=a.get,h=n.View.extend({STREAMING_MAX_VISIBLE:250,events:{"click [data-action=more-posts]":"handleLoadMore"},initialize:function(e){this.lounge=e.lounge,this.thread=e.thread,this.userSuggestions=e.userSuggestions,this.posts=e.posts,this.postsToAppend=[],this.postsToPrepend=[],this.session=e.session,this.subViews={},this.state={nextPassTimeoutId:null,renderedPosts:[],clearDomAfterRender:!1,totalPostsProcessed:0,totalElapsedTime:0},this.addPostsIncremental=t.bind(this.addPostsIncremental,this),this.listenTo(this.posts,{reset:this.redrawPosts,add:this.addPosts,remove:this.removePost}),this.listenTo(this.thread,"change:highlightedPost",this.handleHasHighlightedState),this.listenTo(this.thread,"change:isClosed",this.toggleNoPosts),this.listenTo(this.session,"change:id",this.toggleNoPosts),this.listenTo(this.posts,"reset add",this.toggleNoPosts),this.listenTo(this.posts,"reset add",this.enableTimestampUpdates),this.listenTo(this,"render:end",this.toggleLoadMorePosts),this.listenTo(this,"render:end",this.handleHasHighlightedState)},handleHasHighlightedState:function(){this.$el.toggleClass("has-highlighted-post",this.thread.has("highlightedPost"))},getPostView:function(e){return this.subViews[e]},bootstrap:function(e,n){this.permalinkOptions=n,this.listenTo(this.posts,"reset",t.bind(this.posts.restoreFromCache,this.posts)),this.listenTo(this.posts,"change:isDeleted",t.bind(this.posts.removeFromCache,this.posts)),this.posts.reset(e.posts),t.invoke(this.subViews,"manageMessageHeight")},bindUIUpdateHandlers:function(){var n=this,i=e(window),s=e(window.document.body),a=s.width(),r=t.debounce(function(){var e=s.width();a!==e&&n.subViews&&(a=e,t.each(n.subViews,function(e){e.manageMessageHeight()}))},50);i.on("resize",r)},updateTimestamps:function(){return!(!this.subViews||t.size(this.subViews)<1)&&(t.invoke(this.subViews,"updateRelativeTime"),!0)},enableTimestampUpdates:function(){var e=this,n=6e4;if(!e.timestampUpdateTimer){var i=function(){return e.updateTimestamps()?void(e.timestampUpdateTimer=t.delay(i,n)):void(e.timestampUpdateTimer=null)};e.timestampUpdateTimer=t.delay(i,n)}},openReply:function(e){var t=this.posts.get(e);if(t){var n=this.subViews[t.cid];n.showReply()}},openEdit:function(e){var t=this.posts.get(e);if(t){var n=this.subViews[t.cid];n.showEdit()}},toggleLoadMorePosts:function(){var e=this.$el.find("#posts [data-role=more]"),t=this.posts.hasNext();t?e.show():e.hide()},handleLoadMore:function(t){if(t.preventDefault(),r.isFeatureActive("login_prompt_more_posts")&&this.session.isLoggedOut())return this._pendingLoadMoreComplete=!1,this.listenToOnce(this.session,"change:id",function(){this.session.isLoggedIn()&&!this._pendingLoadMoreComplete&&(this._pendingLoadMoreComplete=!0,this.handleLoadMore(t))}),void this.session.authenticate("disqusDotcom");var n=this,i=e(t.currentTarget),a=n.posts.currentPage();i.addClass("busy"),n.posts.more({success:function(){n.posts.restoreFromCache(),n.once("render:end",function(){i.removeClass("busy")})},error:function(){i.removeClass("busy")}}),n.lounge.trigger("uiAction:seeMore",a+1),s.frame.sendHostMessage("posts.paginate")},renderLayout:e.noop,toggleNoPosts:function(){var t,n=e("#no-posts");this.posts.models.length?n.hide():(t=d(this.thread.get("isClosed")?"This discussion has been closed.":this.session.get("canReply")?"Be the first to comment.":"Nothing in this discussion yet."),n.text(t),n.show())},handleSort:function(){e("#posts [data-role=more]").hide(),e("#no-posts").hide(),e("#post-list").addClass("loading").empty()},redrawPosts:function(){var e=this;e.subViews={},e.once("render:end",function(){t.each(c.open,function(t,n){var i=e.subViews[n];if(i){var s=i.getReplyView();s.textarea.set(t.textarea.get()),t.isOpen()?s.show():s.hide()}})}),e.posts.setPageFor&&e.permalinkOptions&&e.permalinkOptions.postId&&e.posts.setPageFor(e.permalinkOptions.postId,{silent:!0}),e.addPosts(e.posts,{clearDom:!0})},postsShouldBePrepended:function(e){var t=e.length&&e[0];return Boolean(t&&(t.created||!t.id||t.get("isRealtime")||t.get("isCached")||t.requestedByPermalink))},hasQueuedPosts:function(){return this.postsToAppend.length||this.postsToPrepend.length},addPosts:l.decorate(n.collectionAddNormalizer(n.Collection,o.Post),function(e,n,i){var s=this;if(i.clearDom&&(s.postsToAppend=[],s.postsToPrepend=[],s.postsShouldClearDom=!0),s.postsShouldBePrepended(e)){var a=[];t.each(e,function(e){var t=e.get("parent");t&&s.posts.get(t)?s.postsToPrepend.push(e):a.push(e)}),s.postsToPrepend=a.concat(s.postsToPrepend)}else s.postsToAppend=s.postsToAppend.concat(e);s.state.nextPassTimeoutId||(s.state.nextPassTimeoutId=t.defer(function(){s.trigger("render:start"),s.addPostsIncremental(!0)}))}),onDeferredViewReady:function(e){var t=this.subViews;t.hasOwnProperty(e)&&t[e].manageMessageHeight()},removePost:function(e){if(this.hasQueuedPosts())return void this.once("render:end",t.bind(this.removePost,this,e));var n=this.subViews[e.cid];n&&(n.remove(),delete this.subViews[e.cid])},addPostsIncremental:function(e){this.state.nextPassTimeoutId=null,this.discardRenderProgressIfClearDomRequested();var t=this.getPostModelsForThePass();t.length&&this.renderPass(t,e?h.FIRST_ATTEMPT_TIME_SCALE:void 0),this.finishPass(t),this.scheduleNextPass()},discardRenderProgressIfClearDomRequested:function(){this.postsShouldClearDom&&(this.state.clearDomAfterRender=!0,this.postsShouldClearDom=!1,this.state.renderedPosts=[])},getPostModelsForThePass:function(){return this.postsToAppend.length?this.postsToAppend:this.postsToPrepend},renderPass:function(e,t){var n=h.TARGET_PROCESS_TIME;t&&(n*=t);for(var i=this.calculatePostsForNextRun(n)||h.MINIMUM_POSTS_PER_RUN;i>0;){var s=e.splice(0,i),a=this.timedRenderPosts(s);if(null===a)break;n-=a,i=this.calculatePostsForNextRun(n)}},timedRenderPosts:function(e){if(!e.length)return null;var n=Number(new Date);this.state.renderedPosts=this.state.renderedPosts.concat(t.map(e,this.createPostView,this));var i=Number(new Date)-n;return 0>i&&(i=0),this.state.totalElapsedTime+=i,this.state.totalPostsProcessed+=e.length,i||null},createPostView:function(e){var t,n=e.get("parent");n&&(n=this.posts.get(n),t=n&&this.getPostView(n.cid));var i=new u({parent:t,model:e,thread:this.thread,session:this.session,created:e.created,userSuggestions:this.userSuggestions});return this.subViews[e.cid]=i,i.render(),i},calculatePostsForNextRun:function(e){return 0>=e?0:this.state.totalElapsedTime<=0?this.state.totalPostsProcessed:Math.floor(e*this.state.totalPostsProcessed/this.state.totalElapsedTime)},finishPass:function(t){if(!t.length){if(this.$postList=e("#post-list"),this.state.clearDomAfterRender&&(this.$postList.empty(),this.state.clearDomAfterRender=!1),this.state.renderedPosts.length){this.removeOldPostsIfRealtime(),this.enablePostTracking(this.state.renderedPosts);var n=t===this.postsToAppend;this.insertPostElements(this.state.renderedPosts,n),this.state.renderedPosts=[]}this.$postList.removeClass("loading"),this.postsToPrepend.length||this.postsToAppend.length||this.trigger("render:end")}},removeOldPostsIfRealtime:function(){var e=t.any(this.state.renderedPosts,function(e){return e.model.get("isRealtime")});e&&this.removeOldPosts()},removeOldPosts:function(){var e=t.size(this.subViews)-this.STREAMING_MAX_VISIBLE;if(!(0>=e))for(var n,s=this.posts.sortBy(function(e){return i(e.get("createdAt")).valueOf()}),a=0,r=0;a<s.length&&e>=r;a++)n=this.getPostView(s[a].cid),n&&0===n.childrenNode.children().length&&(this.posts.remove(s[a]),r+=1)},enablePostTracking:function(e){t.each(e,function(e){e.visible=!0})},insertPostElements:function(e,n){var i=t.groupBy(e,function(e){return Boolean(e.parent)});t.each(i["true"],function(e){e.parent.attachChild(e)});var s=t.pluck(i["false"],"$el");n?this.$postList.append(s):this.$postList.prepend(s)},scheduleNextPass:function(){(this.postsToPrepend.length||this.postsToAppend.length)&&(this.state.nextPassTimeoutId=t.defer(this.addPostsIncremental))}});return h.TARGET_PROCESS_TIME=30,h.FIRST_ATTEMPT_TIME_SCALE=.8,h.MINIMUM_POSTS_PER_RUN=2,{PostCollectionView:h}}),define("lounge/views/onboard-alert",["backbone","common/utils","common/templates"],function(e,t,n){"use strict";var i=e.View.extend({events:{"click [data-action=close]":"handleClose","click [data-action=show-home]":"handleShowHome"},initialize:function(e){this.session=e.session,this.forum=e.forum},render:function(){return this.session.isLoggedIn()&&this.shouldShow()&&(this.$el.html(n.render("onboard",{forum:this.forum.toJSON()})),this.trigger("uiAction:onboardAlertShow")),this},shouldShow:function(){var e=this.getCookie();return!!e&&(this.session.user.shouldHomeOnboard()&&(e===i.COOKIE_NEW_USER||e===i.COOKIE_POPUP))},getCookie:function(){return t.cookies.read(i.COOKIE_NAME)},setInitialCookie:function(){this.session.user.get("joinedRecently")&&this.createCookie(i.COOKIE_NEW_USER)},createCookie:function(e){t.cookies.create(i.COOKIE_NAME,e,{expiresIn:2592e6})},eraseCookie:function(){t.cookies.erase(i.COOKIE_NAME)},handleShowHome:function(){this.remove()},handleClose:function(e){e.preventDefault(),this.remove(),this.trigger("uiAction:onboardAlertDismiss")},remove:function(){this.eraseCookie(),this.session=null,e.View.prototype.remove.call(this)}},{COOKIE_NAME:"disqus.onboarding",COOKIE_NEW_USER:"newUser"});return{OnboardAlert:i}}),define("lounge/views/notification-menu",["jquery","underscore","backbone","stance","core/bus","core/utils","common/templates"],function(e,t,n,i,s,a,r){"use strict";var o=n.View.extend({events:{"click [data-action=home]":"handleShowHome"},initialize:function(n){var s=e.Deferred();this.listenToOnce(i(this),"enter",function(){s.resolveWith(this)});var a=this.session=n.session;this.forum=n.forum,this.language=window.document.documentElement.lang,this.listenTo(a,"change:id",this.render),this.listenTo(a,"change:notificationCount",this.updateCount),this.listenTo(a,"change:id",function(){s.done(t.bind(a.fetchNotificationCount,a)),s.done(this.preloadSidebar)}),this.listenTo(this,{"sidebar:open:start":this.startLoadingAnimation,"sidebar:open:done":this.stopLoadingAnimation})},startLoadingAnimation:function(){this.$el.addClass("notification-loading")},stopLoadingAnimation:function(){this.$el.removeClass("notification-loading");
},preloadSidebar:function(){s.trigger("sidebar:preload")},render:function(){return this.forum.get("settings").ssoRequired&&this.session.isLoggedOut()?void this.$el.hide():(this.$el.html(r.render("notificationMenu",{})),this.updateCount(),this.$el.show(),this)},handleShowHome:function(t){if(this.session.set("notificationCount",0),!a.willOpenNewWindow(t)){t.preventDefault();var n=e(t.currentTarget).attr("data-home-path");s.trigger("sidebar:open",n,this)}},updateCount:function(){var e=this.session.get("notificationCount")||0;e>0?(this.$("[data-role=notification-count]").html(e>9?'9<i class="icon icon-plus"></i>':e),this.$el.addClass("unread")):(this.$("[data-role=notification-count]").html(""),this.$el.removeClass("unread"))}});return{NotificationMenuView:o}}),define("lounge/views/highlighted-post",["backbone","underscore","jquery","core/UniqueModel","common/models","common/templates","lounge/views/post"],function(e,t,n,i,s,a,r){"use strict";var o=e.View.extend({template:"highlightedPost",itemViewContainer:".post-list",initialize:function(e){t.extend(this,t.pick(e,["thread","session","userSuggestions"])),this.listenTo(this.thread,"change:highlightedPost",this.reset)},getPost:function(){return this.post?n.Deferred().resolve(this.post):this.getHighlightedPost()},_getHighlightedPost:function(){var e=this.thread.get("highlightedPost");return e?(e instanceof s.Post||(e=new i(s.Post,e)),e.get("isDeleted")?null:e.get("isHighlighted")?e:null):null},getHighlightedPost:function(){var e,i=this.post=this._getHighlightedPost(),a=n.Deferred();return i?(e=i.getParent())&&!e.author?s.Post.fetchContext(e.id,this.thread).always(t.bind(a.resolve,a)):a.resolve():a.reject(),a.promise()},reset:function(){delete this.post,this.getPost().always(t.bind(this.render,this))},createPostView:function(){return this.post?new l({model:this.post,thread:this.thread,session:this.session,userSuggestions:this.userSuggestions,excludeAnchor:!0}).stopListening(this.post.usersTyping):null},render:function(){var e=this.createPostView();return e?(e.render(),this.$el.html(a.render(this.template)),this.$(this.itemViewContainer).append(e.el),this.$el.show(),this):(this.$el.hide(),this)}}),l=r.extend({getPostAttributes:function(){var e=r.prototype.getPostAttributes.apply(this,arguments);return e.canBeRepliedTo=!1,e},getStateByline:function(){return!1}});return{HighlightedPostView:o,FeaturedPostView:l}}),define("lounge/views/realtime",["underscore","backbone","core/utils","common/templates","lounge/common"],function(e,t,n,i,s){"use strict";var a=n.preventDefaultHandler,r=t.View.extend({events:{click:"handleDrain"},initialize:function(e){this.options=e},getDirection:function(e){if(this.offset&&this.dim){var t=e.pageOffset,n=t+e.height,i=this.offset.top+e.frameOffset.top,s=i+this.dim.height;return t>s?1:i>n?-1:0}},setCount:function(e){this.options.count=e},render:function(){return 0===this.options.count?void this.$el.hide():(this.$el.html(i.render("realtimeCommentNotification",{comments:this.options.count})),this.listenTo(s.getLounge(),"domReflow",e.throttle(function(){0!==this.options.count&&(this.offset=this.$el.offset(),this.dim={height:this.$el.height(),width:this.$el.width()})},400)),this.$el.show(),this)},handleDrain:a(function(){this.model.queue.drain(),this.setCount(this.model.queue.counters.comments),this.render()})}),o=r.extend({events:{click:"handleDrain"},getDirection:function(e){if(this.options.postView.visible){this.offset=this.options.postView.offset,this.dim=this.options.postView.dim;var t=r.prototype.getDirection.call(this,e);return delete this.offset,delete this.dim,t}},render:function(){var t=this,n=t.options.postView;return 0===t.options.count?(t.$el.hide(),void(n.trackPosition=!1)):(n.trackPosition=!0,n.calcRect(),t.$el.html(i.render("realtimeReplyNotification",{replies:t.options.count})),t.$el.show(),void e.delay(function(){t.$el.addClass("reveal")},13))},handleDrain:a(function(){var e=this.model.id,t=this.options.postView,n=this.options.thread.queue;n.drain(e),this.setCount(n.counters.replies[e]),t.trackPosition=!1,this.render()})});return{QueuedPostView:r,QueuedReplyView:o}}),define("lounge/views/posts/UserSuggestionsManager",["underscore","jquery","common/collections"],function(e,t,n){"use strict";function i(){this.remotes=[]}return e.extend(i.prototype,{fetch:function(){return this._fetchPromise||(this._fetchPromise=t.when.apply(t,e.chain(this.remotes).filter(function(e){return!e.length}).map(function(e){return e.fetch()}).value())),this._fetchPromise},addRemote:function(e){this.remotes.push(e)},all:function(){var t=new n.UserCollection;return t.add(e.chain(this.remotes).pluck("models").flatten().value()),t},find:function(e,t){if(e&&e.length){var n,i=new RegExp(e.join(" ").replace(/[^\w\s]/,""),"i"),s=5,a=this.all(),r=[],o=0,l=1===e.length&&""===e[0]?function(){return!0}:function(e){return i.test(e.get("name"))||i.test(e.get("username"))};for(o=0;o<a.models.length&&r.length<s;o++)n=a.models[o],n.get("isAnonymous")||t.get(n.cid)||l(n)&&r.push(n);return r}},get:function(e){return this.all().get(e)}}),i}),define("lounge/views/sidebar",["underscore","backbone","modernizr","core/bus","core/utils/url/serialize","shared/urls","core/utils"],function(e,t,n,i,s,a,r){"use strict";var o=t.View.extend({initialize:function(e){this.forum=e.forum,this.session=e.session,this.language=window.document.documentElement.lang,"en"===this.language&&(this.language=void 0),this.listenTo(this.session,"change:id",this.destroyHome),this.listenTo(i,{"sidebar:open":this.open,"sidebar:preload":this.preload}),this.iframeAlive=!0,this.listenToOnce(i.frame,"home.timeout",this.handleTimeout)},isIE9:function(){return 9===window.document.documentMode},shouldUseIframe:function(){if(this.isIE9()&&!this.session.isSSO())return!1;if(!this.iframeAlive)return!1;var e=r.isMobileUserAgent();return!e||this.session.isSSO()},handleTimeout:function(){this.iframeAlive=!1},open:function(t,n){if(this.shouldUseIframe()){if(this.storeHomeSession(),i.frame.sendHostMessage("home.show",{path:t,language:this.language,forum:this.forum&&this.forum.id}),n){n.trigger("sidebar:open:start");var o=e.bind(n.trigger,n,"sidebar:open:done");this.listenToOnce(i.frame,{"home.opened":o,"home.timeout":o})}}else r.openWindow(s(a.apps.home+t,{l:this.language}),"disqushome");i.trigger("uiAction:openHome")},destroyHome:function(){i.frame.sendHostMessage("home.destroy")},preload:function(){this.session.isLoggedOut()||this.shouldUseIframe()&&(this.storeHomeSession(),i.frame.sendHostMessage("home.preload",{language:this.language}))},storeHomeSession:function(){n.sessionstorage&&window.sessionStorage.setItem("home.session",JSON.stringify(this.session.user.toJSON()))}});return o}),define("templates/lounge",["handlebars"],function(e){return e.template({1:function(e,t,n,i,s){var a;return'<div class="follow-btn-wrap">\n'+(null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.user:t)?a.isSession:a,{name:"if",hash:{},fn:e.program(2,s,0),inverse:e.program(5,s,0),data:s}))?a:"")+"</div>\n"},2:function(e,t,n,i,s){var a;return(null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.user:t)?a.isEditable:a,{name:"if",hash:{},fn:e.program(3,s,0),inverse:e.noop,data:s}))?a:"")+"\n"},3:function(e,t,n,i,s){var a,r=e.escapeExpression;return'<a href="'+r(e.lambda(null!=(a=null!=t?t.user:t)?a.profileUrl:a,t))+'" data-action="edit-profile" target="_blank" class="btn follow-btn edit-profile">'+r(n.gettext.call(null!=t?t:{},"Edit profile",{name:"gettext",hash:{},data:s}))+"</a>\n"},5:function(e,t,n,i,s){var a;return null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.user:t)?a.isPrivate:a,{name:"if",hash:{},fn:e.program(6,s,0),inverse:e.program(8,s,0),data:s}))?a:""},6:function(e,t,n,i,s){return'<span class="btn follow-btn private">\n<i aria-hidden="true" class="icon-lock"></i>\n<span class="btn-text">'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Private",{name:"gettext",hash:{},data:s}))+"</span>\n</span>\n"},8:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression,l=null!=t?t:{};return'<a href="'+o(r(null!=(a=null!=t?t.user:t)?a.profileUrl:a,t))+'" class="btn follow-btn '+(null!=(a=n["if"].call(l,null!=(a=null!=t?t.user:t)?a.isFollowing:a,{name:"if",hash:{},fn:e.program(9,s,0),inverse:e.noop,data:s}))?a:"")+'" data-action="follow-user" data-user="'+o(r(null!=(a=null!=t?t.user:t)?a.id:a,t))+'">\n<span class="btn-text following-text">'+o(n.gettext.call(l,"Following",{name:"gettext",hash:{},data:s}))+'</span>\n<span class="btn-text follow-text">'+o(n.gettext.call(l,"Follow",{name:"gettext",hash:{},data:s}))+'</span>\n<i aria-hidden="true" class="icon-plus"></i> \n<i aria-hidden="true" class="icon-checkmark"></i>\n</a>\n'},9:function(e,t,n,i,s){return"following"},11:function(e,t,n,i,s){return'<div class="vote-action tooltip">\n'+e.escapeExpression(n.gettext.call(null!=t?t:{},"You must sign in to down-vote this post.",{name:"gettext",hash:{},data:s}))+"\n</div>\n"},13:function(e,t,n,i,s){return'<div class="vote-action tooltip">\n'+e.escapeExpression(n.gettext.call(null!=t?t:{},"You must sign in to up-vote this post.",{name:"gettext",hash:{},data:s}))+"\n</div>\n"},15:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression;return"<h5>"+o(n.gettext.call(r,"Ban User",{name:"gettext",hash:{},data:s}))+"</h5>\n\n"+(null!=(a=n["if"].call(r,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.isRegistered:a,{name:"if",hash:{},fn:e.program(16,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.email:a,{name:"if",hash:{},fn:e.program(18,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.post:t)?a.ipAddress:a,{name:"if",hash:{},fn:e.program(20,s,0),inverse:e.noop,data:s}))?a:"")+"\n<label>"+o(n.gettext.call(r,"Last 30 days of comments:",{name:"gettext",hash:{},data:s}))+'\n<select name="retroactiveAction">\n<option value selected>'+o(n.gettext.call(r,"Do nothing",{name:"gettext",hash:{},data:s}))+"</option>\n<option value=1>"+o(n.gettext.call(r,"Delete",{name:"gettext",hash:{},data:s}))+"</option>\n<option value=2>"+o(n.gettext.call(r,"Mark as spam",{name:"gettext",hash:{},data:s}))+"</option>\n</select>\n</label>\n\n<label>"+o(n.gettext.call(r,"Note",{name:"gettext",hash:{},data:s}))+' <input type="text" class="form-control input-sm" name="notes" maxlength="50" /></label>\n\n<div class="actions">\n<button class="btn btn-small" type="submit">'+o(n.gettext.call(r,"Save",{name:"gettext",hash:{},data:s}))+'</button>\n<button class="btn btn-small" data-action="cancel">'+o(n.gettext.call(r,"Cancel",{name:"gettext",hash:{},data:s}))+"</button>\n</div>\n"},16:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<label><input type="checkbox" name="user" value="'+o(r(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.id:a,t))+'" checked="checked"/> '+o(n.gettext.call(null!=t?t:{},"User",{name:"gettext",hash:{},data:s}))+": "+o(r(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.username:a,t))+"</label>\n"},18:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<label><input type="checkbox" name="email" value="'+o(r(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.email:a,t))+'"> '+o(n.gettext.call(null!=t?t:{},"Email",{name:"gettext",hash:{},data:s}))+": "+o(r(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.email:a,t))+"</label>\n"},20:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<label><input type="checkbox" name="ip" value="'+o(r(null!=(a=null!=t?t.post:t)?a.ipAddress:a,t))+'"> '+o(n.gettext.call(null!=t?t:{},"IP Address",{name:"gettext",hash:{},data:s}))+": "+o(r(null!=(a=null!=t?t.post:t)?a.ipAddress:a,t))+"</label>\n"},22:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return r(n.gettext.call(a,"We are unable to post your comment because you have been banned by %(blocker)s.",{name:"gettext",hash:{blocker:null!=t?t.blocker:t},data:s}))+'\n<a target="_blank" href="https://help.disqus.com/customer/portal/articles/466223-who-deleted-or-removed-my-comment-">'+r(n.gettext.call(a,"Find out more.",{name:"gettext",hash:{},data:s}))+"</a>\n"},24:function(e,t,n,i,s){return"<strong>"+e.escapeExpression(e.lambda(null!=t?t.name:t,t))+"</strong>\n"},26:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.lambda,l=e.escapeExpression;return'<div class="tooltip">\n<div class="notch"></div>\n\n'+(null!=(a=n["if"].call(r,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.isAnonymous:a,{name:"if",hash:{},fn:e.program(27,s,0),inverse:e.program(29,s,0),data:s}))?a:"")+'\n<img src="'+l(o(null!=(a=null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.avatar:a)?a.cache:a,t))+'" class="user" alt="'+l(n.gettext.call(r,"Avatar",{name:"gettext",hash:{},data:s}))+'" />\n\n'+(null!=(a=n["if"].call(r,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.isAnonymous:a,{name:"if",hash:{},fn:e.program(31,s,0),inverse:e.program(33,s,0),data:s}))?a:"")+'\n<div class="tooltip__content">\n<h3>\n'+(null!=(a=n.unless.call(r,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.isAnonymous:a,{name:"unless",hash:{},fn:e.program(35,s,0),inverse:e.noop,data:s}))?a:"")+"\n<h3>"+l(o(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.name:a,t))+"</h3>\n\n"+(null!=(a=n.unless.call(r,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.isAnonymous:a,{name:"unless",hash:{},fn:e.program(33,s,0),inverse:e.noop,data:s}))?a:"")+"</h3>\n\n<p>"+l(o(null!=(a=null!=t?t.post:t)?a.excerpt:a,t))+"</p>\n</div>\n</div>\n"},27:function(e,t,n,i,s){return'<div class="avatar">\n'},29:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<a href="'+o(r(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.profileUrl:a,t))+'" class="avatar" data-action="profile" data-username="'+o(r(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.username:a,t))+'">\n'},31:function(e,t,n,i,s){return"</div>\n"},33:function(e,t,n,i,s){return"</a>\n"},35:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<a href="'+o(r(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.profileUrl:a,t))+'" data-action="profile" data-username="'+o(r(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.username:a,t))+'">\n'},37:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return'<div class="textarea-wrapper" data-role="textarea">\n<div class="edit-alert" role="postbox-alert"></div>\n<div class="post-actions">\n<div class="logged-in">\n<section>\n<div class="temp-post">\n<button class="btn post-action__button" type="submit">'+r(n.gettext.call(a,"Save Edit",{name:"gettext",hash:{},data:s}))+'</button>\n<a class="cancel post-action__cancel" href="#" data-action="edit">\n'+r(n.gettext.call(a,"Cancel",{name:"gettext",hash:{},data:s}))+"\n</a>\n</div>\n</section>\n</div>\n</div>\n</div>\n"},39:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression;return o(n.gettext.call(r,"%(forumName)s requires you to verify your email address before posting.",{name:"gettext",hash:{forumName:null!=t?t.forumName:t},data:s}))+'\n<a data-action="verify-email" data-forum="'+o(e.lambda(null!=t?t.forumId:t,t))+'" title="'+o(n.gettext.call(r,"Verify Email",{name:"gettext",hash:{},data:s}))+'" href="/verify">\n'+o(n.gettext.call(r,"Send verification email to %(email)s",{name:"gettext",hash:{email:null!=(a=null!=t?t.user:t)?a.email:a},data:s}))+"\n</a>\n"},41:function(e,t,n,i,s){var a;return null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.user:t)?a.isSession:a,{name:"if",hash:{},fn:e.program(42,s,0),inverse:e.program(48,s,0),data:s}))?a:""},42:function(e,t,n,i,s){var a;return null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.user:t)?a.isEditable:a,{name:"if",hash:{},fn:e.program(43,s,0),inverse:e.noop,data:s}))?a:""},43:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression;return'<a href="'+o(n.urlfor.call(r,"editProfile",{name:"urlfor",hash:{},data:s}))+'"\ntarget="_blank"\nclass="\n'+(null!=(a=n["if"].call(r,null!=t?t.buttonAsLink:t,{name:"if",hash:{},fn:e.program(44,s,0),inverse:e.program(46,s,0),data:s}))?a:"")+'">\n'+o(n.gettext.call(r,"Edit profile",{name:"gettext",hash:{},data:s}))+"\n</a>\n"},44:function(e,t,n,i,s){return"publisher-anchor-color follow-link\n"},46:function(e,t,n,i,s){return"btn btn-small\n"},48:function(e,t,n,i,s){var a;return null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.user:t)?a.isPrivate:a,{name:"if",hash:{},fn:e.program(49,s,0),inverse:e.program(51,s,0),data:s}))?a:""},49:function(e,t,n,i,s){return'<span\nclass="btn btn-small follow-btn private">\n<i aria-hidden="true" class="icon-lock"></i>\n<span class="btn-text">\n'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Private",{name:"gettext",hash:{},data:s}))+"\n</span>\n</span>\n"},51:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression,l=null!=t?t:{};return'<a href="'+o(r(null!=(a=null!=t?t.user:t)?a.profileUrl:a,t))+'" class="\n'+(null!=(a=n["if"].call(l,null!=t?t.buttonAsLink:t,{name:"if",hash:{},fn:e.program(44,s,0),inverse:e.program(52,s,0),data:s}))?a:"")+(null!=(a=n["if"].call(l,null!=(a=null!=t?t.user:t)?a.isFollowing:a,{name:"if",hash:{},fn:e.program(9,s,0),inverse:e.noop,data:s}))?a:"")+'"\ndata-action="toggleFollow"\ndata-user="'+o(r(null!=(a=null!=t?t.user:t)?a.id:a,t))+'">\n<span class="btn-text following-text">'+o(n.gettext.call(l,"Following",{name:"gettext",hash:{},data:s}))+'</span>\n<span class="btn-text follow-text">'+o(n.gettext.call(l,"Follow",{name:"gettext",hash:{},data:s}))+'</span>\n<i aria-hidden="true" class="icon-checkmark"></i>\n</a>\n'},52:function(e,t,n,i,s){return"btn btn-small follow-btn\n"},54:function(e,t,n,i,s){var a=e.lambda,r=e.escapeExpression;return'<span data-username="'+r(a(null!=t?t.username:t,t))+'" data-role="username">'+r(a(null!=t?t.name:t,t))+"</span>\n"},56:function(e,t,n,i,s){var a,r=null!=t?t:{};return'\n<div class="postbox">\n<div role="alert"></div>\n<div class="avatar">\n'+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.user:t)?a.isRegistered:a,{name:"if",hash:{},fn:e.program(57,s,0),inverse:e.program(59,s,0),data:s}))?a:"")+'</div>\n\n<div class="textarea-wrapper" data-role="textarea" dir="auto">\n<div data-role="drag-drop-placeholder" class="media-drag-hover" style="display: none">\n<div class="drag-text">\n&#11015; '+e.escapeExpression(n.gettext.call(r,"Drag and drop your images here to upload them.",{name:"gettext",hash:{},data:s}))+"\n</div>\n</div>\n"+(null!=(a=n["if"].call(r,null!=t?t.displayMediaPreviews:t,{name:"if",hash:{},fn:e.program(61,s,0),inverse:e.noop,data:s}))?a:"")+'<div class="edit-alert" role="postbox-alert"></div>\n<div class="post-actions">\n<ul class="wysiwyg">\n'+(null!=(a=n["if"].call(r,null!=t?t.displayMediaUploadButton:t,{name:"if",hash:{},fn:e.program(63,s,0),inverse:e.noop,data:s}))?a:"")+"</ul>\n"+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.user:t)?a.isRegistered:a,{name:"if",hash:{},fn:e.program(65,s,0),inverse:e.noop,data:s}))?a:"")+'</div>\n</div>\n\n<div data-role="login-form"></div>\n</div>\n'},57:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<a href="'+o(r(null!=(a=null!=t?t.user:t)?a.profileUrl:a,t))+'" class="user" data-action="profile" data-username="'+o(r(null!=(a=null!=t?t.user:t)?a.username:a,t))+'">\n<img data-role="user-avatar" data-user="'+o(r(null!=(a=null!=t?t.user:t)?a.id:a,t))+'" src="'+o(r(null!=(a=null!=(a=null!=t?t.user:t)?a.avatar:a)?a.cache:a,t))+'" alt="'+o(n.gettext.call(null!=t?t:{},"Avatar",{name:"gettext",hash:{},data:s}))+'">\n</a>\n'},59:function(e,t,n,i,s){var a,r=e.escapeExpression;return'<span class="user">\n<img data-role="user-avatar" src="'+r(e.lambda(null!=(a=null!=(a=null!=t?t.user:t)?a.avatar:a)?a.cache:a,t))+'" alt="'+r(n.gettext.call(null!=t?t:{},"Avatar",{name:"gettext",hash:{},data:s}))+'">\n</span>\n'},61:function(e,t,n,i,s){return'<div class="media-preview empty" data-role="media-preview"></div>\n'},63:function(e,t,n,i,s){return'<li  class="wysiwyg__item" data-role="media-uploader"></li>\n'},65:function(e,t,n,i,s){var a;return null!=(a=n.unless.call(null!=t?t:{},null!=t?t.audienceSyncRequired:t,{name:"unless",hash:{},fn:e.program(66,s,0),inverse:e.noop,data:s}))?a:""},66:function(e,t,n,i,s){var a=null!=t?t:{};return'<div class="logged-in">\n<section>\n<div class="temp-post" style="text-align: right">\n<button class="btn post-action__button">\n'+e.escapeExpression(n.gettext.call(a,"Post as %(name)s",{name:"gettext",hash:{name:n.getPartial.call(a,"formUser",null!=t?t.user:t,{name:"getPartial",hash:{},data:s})},data:s}))+"\n</button>\n</div>\n</section>\n</div>\n"},68:function(e,t,n,i,s){var a,r=null!=t?t:{};return(null!=(a=n["if"].call(r,null!=(a=null!=t?t.user:t)?a.isAnonymous:a,{name:"if",hash:{},fn:e.program(69,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,null!=t?t.audienceSyncRequired:t,{name:"if",hash:{},fn:e.program(71,s,0),inverse:e.noop,data:s}))?a:"")},69:function(e,t,n,i,s){var a;return'<section class="auth-section logged-out">\n<div class="connect">\n<h6>'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Log in with",{name:"gettext",hash:{},data:s}))+"</h6>\n"+(null!=(a=e.invokePartial(i.loginButtons,t,{name:"loginButtons",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+"</div>\n"+(null!=(a=e.invokePartial(i.guestForm,t,{name:"guestForm",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+"</section>\n"},71:function(e,t,n,i,s){var a;return'<section class="auth-section">\n'+(null!=(a=e.invokePartial(i.audienceSync,t,{name:"audienceSync",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+"</section>\n"},73:function(e,t,n,i,s){var a;return'<ul data-role="login-menu" class="services login-buttons">\n'+(null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.sso:t)?a.url:a,{name:"if",hash:{},fn:e.program(74,s,0),inverse:e.noop,data:s}))?a:"")+'\n<li class="auth-disqus">\n<button type="button" data-action="auth:disqus" title="Disqus" class="connect__button"><i class="icon-disqus"></i></button>\n</li>\n<li class="auth-facebook">\n<button type="button" data-action="auth:facebook" title="Facebook" class="connect__button"><i class="icon-facebook-circle"></i></button>\n</li>\n<li class="auth-twitter">\n<button type="button" data-action="auth:twitter" title="Twitter" class="connect__button"><i class="icon-twitter-circle"></i></button>\n</li>\n<li class="auth-google">\n<button type="button" data-action="auth:google" title="Google" class="connect__button"><i class="icon-google-plus-circle"></i></button>\n</li>\n</ul>\n'},74:function(e,t,n,i,s){var a,r=null!=t?t:{};return'\n<li class="sso">\n<button type="button" data-action="auth:sso"\ntitle="'+e.escapeExpression(e.lambda(null!=(a=null!=t?t.sso:t)?a.name:a,t))+'"\nclass="sso__button '+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.sso:t)?a.button:a,{name:"if",hash:{},fn:e.program(75,s,0),inverse:e.program(77,s,0),data:s}))?a:"")+'">\n'+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.sso:t)?a.button:a,{name:"if",hash:{},fn:e.program(79,s,0),inverse:e.program(81,s,0),data:s}))?a:"")+"</button>\n</li>\n"},75:function(e,t,n,i,s){return"image"},77:function(e,t,n,i,s){return"no-image"},79:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<img alt="'+o(r(null!=(a=null!=t?t.sso:t)?a.name:a,t))+'" src="'+o(r(null!=(a=null!=t?t.sso:t)?a.button:a,t))+'"/>\n'},81:function(e,t,n,i,s){var a;return e.escapeExpression(e.lambda(null!=(a=null!=t?t.sso:t)?a.name:a,t))+"\n"},83:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression,l=e.lambda;return'<div class="guest">\n<h6 class="guest-form-title">\n<span class="register-text"> '+o(n.gettext.call(r,"or sign up with Disqus",{name:"gettext",hash:{},data:s}))+' </span>\n<span class="guest-text"> '+o(n.gettext.call(r,"or pick a name",{name:"gettext",hash:{},data:s}))+' </span>\n</h6>\n\n<div class="help-tooltip__wrapper help-icon">\n<div id="rules" class="tooltip show help-tooltip">\n<h3 class="help-tooltip__heading">'+o(n.gettext.call(r,"Disqus is a discussion network",{name:"gettext",hash:{},data:s}))+'</h3>\n<ul class="help-tooltip__list">\n<li><span>'+o(n.gettext.call(r,"Disqus never moderates or censors. The rules on this community are its own.",{name:"gettext",hash:{},data:s}))+"</span></li>\n<li><span>"+o(n.gettext.call(r,"Your email is safe with us. It's only used for moderation and optional notifications.",{name:"gettext",hash:{},data:s}))+"</span></li>\n<li><span>"+o(n.gettext.call(r,"Don't be a jerk or do anything illegal. Everything is easier that way.",{name:"gettext",hash:{},data:s}))+'</span></li>\n</ul>\n<p class="clearfix"><a href="https://docs.disqus.com/kb/terms-and-policies/" class="btn btn-small help-tooltip__button" target="_blank">'+o(n.gettext.call(r,"Read full terms and conditions",{name:"gettext",hash:{},data:s}))+'</a></p>\n</div>\n</div>\n\n<p class="input-wrapper">\n<input dir="auto" type="text" placeholder="'+o(n.gettext.call(r,"Name",{name:"gettext",hash:{},data:s}))+'" name="display_name" id="'+o(l(null!=t?t.cid:t,t))+'_display_name" maxlength="30" class="input--text">\n</p>\n\n<div class="guest-details '+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.sso:t)?a.url:a,{name:"if",hash:{},fn:e.program(84,s,0),inverse:e.noop,data:s}))?a:"")+'" data-role="guest-details">\n<p class="input-wrapper">\n<input dir="auto" type="email" placeholder="'+o(n.gettext.call(r,"Email",{name:"gettext",hash:{},data:s}))+'" name="email" id="'+o(l(null!=t?t.cid:t,t))+'_email" class="input--text">\n</p>\n\n<p class="input-wrapper">\n<input dir="auto" type="password" class="register-text input--text" placeholder="'+o(n.gettext.call(r,"Password",{name:"gettext",hash:{},data:s}))+'" name="password" id="'+o(l(null!=t?t.cid:t,t))+'_password">\n</p>\n\n<div class="acceptance-wrapper register-text">\n'+o(n.gettext.call(r,"By signing up, you agree to the %(Disqus)s %(basicRules)s, %(serviceTerms)s, and %(privacyPolicy)s.",{name:"gettext",hash:{privacyPolicy:n.tag.call(r,"a",{name:"tag",hash:{text:n.gettext.call(r,"Privacy Policy",{name:"gettext",hash:{},data:s}),target:"_blank",href:"https://help.disqus.com/customer/portal/articles/466259-privacy-policy"},data:s}),serviceTerms:n.tag.call(r,"a",{name:"tag",hash:{text:n.gettext.call(r,"Terms of Service",{name:"gettext",hash:{},data:s}),target:"_blank",href:"https://help.disqus.com/customer/portal/articles/466260-terms-of-service"},data:s}),basicRules:n.tag.call(r,"a",{name:"tag",hash:{text:n.gettext.call(r,"Basic Rules",{name:"gettext",hash:{},data:s}),target:"_blank",href:"https://help.disqus.com/customer/portal/articles/1753105-basic-rules-for-disqus-powered-profiles-and-discussions"},data:s}),Disqus:"Disqus"},data:s}))+'\n</div>\n<div class="acceptance-wrapper guest-text">\n'+o(n.gettext.call(r,"By posting, you agree to the %(Disqus)s %(basicRules)s, %(serviceTerms)s, and %(privacyPolicy)s.",{name:"gettext",hash:{privacyPolicy:n.tag.call(r,"a",{name:"tag",hash:{text:n.gettext.call(r,"Privacy Policy",{name:"gettext",hash:{},data:s}),target:"_blank",href:"https://help.disqus.com/customer/portal/articles/466259-privacy-policy"},data:s}),serviceTerms:n.tag.call(r,"a",{name:"tag",hash:{text:n.gettext.call(r,"Terms of Service",{name:"gettext",hash:{},data:s}),target:"_blank",href:"https://help.disqus.com/customer/portal/articles/466260-terms-of-service"},data:s}),basicRules:n.tag.call(r,"a",{name:"tag",hash:{text:n.gettext.call(r,"Basic Rules",{name:"gettext",hash:{},data:s}),target:"_blank",href:"https://help.disqus.com/customer/portal/articles/1753105-basic-rules-for-disqus-powered-profiles-and-discussions"},data:s}),Disqus:"Disqus"},data:s}))+"\n</div>\n\n"+(null!=(a=n["if"].call(r,null!=t?t.allowAnonPost:t,{name:"if",hash:{},fn:e.program(86,s,0),inverse:e.program(88,s,0),data:s}))?a:"")+'\n<div class="proceed" data-role="submit-btn-container">\n'+(null!=(a=n["if"].call(r,null!=t?t.allowAnonPost:t,{name:"if",hash:{},fn:e.program(90,s,0),inverse:e.program(92,s,0),data:s}))?a:"")+"</div>\n</div>\n</div>\n"},84:function(e,t,n,i,s){return"expanded"},86:function(e,t,n,i,s){return'<div class="guest-checkbox">\n<label>\n<input type="checkbox" name="author-guest"/>\n'+e.escapeExpression(n.gettext.call(null!=t?t:{},"I'd rather post as a guest",{name:"gettext",hash:{},data:s}))+"\n</label>\n</div>\n"},88:function(e,t,n,i,s){return'<input type="checkbox" name="author-guest" style="display:none"/>\n'},90:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return'<button type="submit" class="proceed__button btn submit" aria-label="'+r(n.gettext.call(a,"Post",{name:"gettext",hash:{},data:s}))+'"><span class="icon-proceed"></span><div class="spinner"></div></button>\n<button type="submit" class="proceed__button btn next" aria-label="'+r(n.gettext.call(a,"Next",{name:"gettext",hash:{},data:s}))+'"><span class="icon-proceed"></span><div class="spinner"></div></button>\n'},92:function(e,t,n,i,s){return'<button type="submit" class="proceed__button btn submit" aria-label="'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Next",{name:"gettext",hash:{},data:s}))+'"><span class="icon-proceed"></span><div class="spinner"></div></button>\n'},94:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression,o=e.lambda;return'<div class="audiencesync">\n<h6>'+r(n.gettext.call(a,"Connect with %(forumName)s",{name:"gettext",hash:{forumName:null!=t?t.forumName:t},data:s}))+'</h6>\n<div class="services">\n<div class="audiencesync__icons">\n<img class="icon" alt="Disqus"\nsrc="'+r("https://a.disquscdn.com/next/embed/assets/img/audiencesync/sync-icon.6569cc4fd4bb29f2cd6568f663ed1009.png")+'">\n<i class="icon icon-proceed"></i>\n<img class="icon" alt="'+r(o(null!=t?t.forumName:t,t))+'"\nsrc="'+r(n.urlfor.call(a,"root",{name:"urlfor",hash:{},data:s}))+"/api/applications/icons/"+r(o(null!=t?t.apiKey:t,t))+'.png">\n</div>\n<p>\n'+r(n.gettext.call(a,"%(forumName)s needs permission to access your account.",{name:"gettext",hash:{forumName:null!=t?t.forumName:t},data:s}))+'\n</p>\n</div>\n<button type="button" data-action="audiencesync"\nclass="proceed btn submit">'+r(n.gettext.call(a,"Next",{name:"gettext",hash:{},data:s}))+"</button>\n</div>\n"},96:function(e,t,n,i,s){return'<h2 class="highlighted-comment-header">'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Featured Comment",{name:"gettext",hash:{},data:s}))+'</h2>\n<ul class="post-list"></ul>\n'},98:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression,l=null!=t?t:{};return'<div class="tooltip">\n<div class="notch"></div>\n<a href="'+o(r(null!=(a=null!=t?t.user:t)?a.profileUrl:a,t))+'" class="avatar" data-action="profile" data-username="'+o(r(null!=(a=null!=t?t.user:t)?a.username:a,t))+'">\n<img data-user="'+o(r(null!=(a=null!=t?t.user:t)?a.id:a,t))+'" data-role="user-avatar" src="'+o(r(null!=(a=null!=(a=null!=t?t.user:t)?a.avatar:a)?a.cache:a,t))+'" class="user" alt="'+o(n.gettext.call(l,"Avatar",{name:"gettext",hash:{},data:s}))+'" />\n</a>\n<div class="tooltip__content">\n<h3>\n<a href="'+o(r(null!=(a=null!=t?t.user:t)?a.profileUrl:a,t))+'" data-action="profile" data-role="username" data-username="'+o(r(null!=(a=null!=t?t.user:t)?a.username:a,t))+'">'+o(r(null!=(a=null!=t?t.user:t)?a.name:a,t))+"</a>\n"+(null!=(a=n["if"].call(l,null!=(a=null!=(a=null!=t?t.user:t)?a.thread:a)?a.canModerate:a,{name:"if",hash:{},fn:e.program(99,s,0),inverse:e.noop,data:s}))?a:"")+"\n</h3>\n\n"+(null!=(a=n["if"].call(l,null!=(a=null!=t?t.user:t)?a.about:a,{name:"if",hash:{},fn:e.program(101,s,0),inverse:e.noop,data:s}))?a:"")+'\n\n<p class="stats" data-role="counters">\n'+(null!=(a=n.if_all.call(l,n.notNull.call(l,null!=(a=null!=t?t.user:t)?a.numPosts:a,{name:"notNull",hash:{},data:s}),n.notNull.call(l,null!=(a=null!=t?t.user:t)?a.numLikesReceived:a,{name:"notNull",hash:{},data:s}),{name:"if_all",hash:{},fn:e.program(103,s,0),inverse:e.noop,data:s}))?a:"")+'</p>\n</div>\n<footer class="tooltip__footer" data-role="actions">\n'+(null!=(a=e.invokePartial(i.hovercardActions,t,{name:"hovercardActions",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+"</footer>\n</div>\n"},99:function(e,t,n,i,s){return'<span class="badge moderator">'+e.escapeExpression(n.gettext.call(null!=t?t:{},"MOD",{name:"gettext",hash:{},data:s}))+"</span>"},101:function(e,t,n,i,s){
var a;return'<p class="bio">'+e.escapeExpression(n.truncate.call(null!=t?t:{},null!=(a=null!=t?t.user:t)?a.about:a,80,{name:"truncate",hash:{},data:s}))+"</p>\n"},103:function(e,t,n,i,s){var a;return null!=(a=e.invokePartial(i.hovercardCounters,t,{name:"hovercardCounters",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:""},105:function(e,t,n,i,s){var a,r=null!=t?t:{};return(null!=(a=n["if"].call(r,n.eq.call(r,null!=(a=null!=t?t.user:t)?a.numPosts:a,1,{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(106,s,0),inverse:e.program(108,s,0),data:s}))?a:"")+'<span class="bullet">•</span>\n'+(null!=(a=n["if"].call(r,n.eq.call(r,null!=(a=null!=t?t.user:t)?a.numLikesReceived:a,1,{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(110,s,0),inverse:e.program(112,s,0),data:s}))?a:"")},106:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"1 comment",{name:"gettext",hash:{},data:s}))+"\n"},108:function(e,t,n,i,s){var a;return e.escapeExpression(n.gettext.call(null!=t?t:{},"%(numPosts)s comments",{name:"gettext",hash:{numPosts:null!=(a=null!=t?t.user:t)?a.numPosts:a},data:s}))+"\n"},110:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"1 vote",{name:"gettext",hash:{},data:s}))+"\n"},112:function(e,t,n,i,s){var a;return e.escapeExpression(n.gettext.call(null!=t?t:{},"%(numLikesReceived)s votes",{name:"gettext",hash:{numLikesReceived:null!=(a=null!=t?t.user:t)?a.numLikesReceived:a},data:s}))+"\n"},114:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression,l=null!=t?t:{};return'<a href="'+o(r(null!=(a=null!=t?t.user:t)?a.profileUrl:a,t))+'" class="full-profile" data-action="profile" data-username="'+o(r(null!=(a=null!=t?t.user:t)?a.username:a,t))+'">'+o(n.gettext.call(l,"Full profile",{name:"gettext",hash:{},data:s}))+"</a>\n\n"+(null!=(a=n["if"].call(l,null!=t?t.showFollowButton:t,{name:"if",hash:{},fn:e.program(115,s,0),inverse:e.noop,data:s}))?a:"")+"\n&nbsp;\n"},115:function(e,t,n,i,s){var a;return null!=(a=e.invokePartial(i.followButtonSmall,t,{name:"followButtonSmall",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:""},117:function(e,t,n,i,s){return'<li class="post advertisement">\n<div class="post-content" data-role="post-content">\n<div class="advertisement-comment">\n'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Comments continue after advertisement",{name:"gettext",hash:{},data:s}))+"\n</div>\n</div>\n</li>\n"},119:function(e,t,n,i,s){var a,r=null!=t?t:{};return'<div id="layout" data-tracking-area="layout">\n\n<div id="onboard" data-tracking-area="onboard"></div>\n\n<div id="highlighted-post" data-tracking-area="highlighted" class="highlighted-post"></div>\n\n<div id="global-alert"></div>\n\n'+(null!=(a=n.unless.call(r,null!=t?t.inHome:t,{name:"unless",hash:{},fn:e.program(120,s,0),inverse:e.noop,data:s}))?a:"")+'\n<section id="conversation" data-role="main" data-tracking-area="main">\n'+(null!=(a=e.invokePartial(i.secondaryNavigation,t,{name:"secondaryNavigation",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+'\n<div id="posts">\n<div id="form" class="textarea-wrapper--top-level"></div>\n\n<button class="alert alert--realtime" style="display: none" data-role="realtime-notification">\n</button>\n\n<div id="no-posts" style="display:none"></div>\n\n<ul id="post-list" class="post-list loading">\n</ul>\n\n<div class="load-more" data-role="more" style="display:none">\n<a href="#" data-action="more-posts" class="btn load-more__button">'+e.escapeExpression(n.gettext.call(r,"Load more comments",{name:"gettext",hash:{},data:s}))+'</a>\n</div>\n</div>\n\n</section>\n\n<div id="placement-bottom" data-tracking-area="discovery-south"></div>\n\n'+(null!=(a=n.unless.call(r,null!=t?t.hideFooter:t,{name:"unless",hash:{},fn:e.program(122,s,0),inverse:e.noop,data:s}))?a:"")+"</div>\n"},120:function(e,t,n,i,s){var a;return'<header id="main-nav" data-tracking-area="main-nav">\n'+(null!=(a=e.invokePartial(i.topNavigation,t,{name:"topNavigation",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+"</header>\n"},122:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression;return'<div id="footer" data-tracking-area="footer" class="disqus-footer__wrapper">\n<ul class="disqus-footer">\n<li class="disqus-footer__logo"><a href="https://disqus.com" rel="nofollow" title="'+o(n.gettext.call(r,"Powered by Disqus",{name:"gettext",hash:{},data:s}))+'" class="disqus-footer__link">'+o(n.gettext.call(r,"Powered by Disqus",{name:"gettext",hash:{},data:s}))+'</a></li>\n<li id="thread-subscribe-button" class="email disqus-footer__item"> \n<div class="default">\n<a href="#" rel="nofollow" data-action="subscribe" title="'+o(n.gettext.call(r,"Subscribe and get email updates from this discussion",{name:"gettext",hash:{},data:s}))+'" class="disqus-footer__link"><i aria-hidden="true" class="icon icon-mail"></i><span class="clip">'+o(n.gettext.call(r,"Subscribe",{name:"gettext",hash:{},data:s}))+'</span> <i aria-hidden="true" class="icon icon-checkmark"></i></a>\n</div>\n<div class="form">\n<div class="input-wrapper"><input id="thread-subscribe-email" type="email" placeholder="'+o(n.gettext.call(r,"yourname@email.com",{name:"gettext",hash:{},data:s}))+'" class="disqus-footer__input input--text"/></div>\n</div>\n</li>\n<li class="install disqus-footer__item">\n<a href="https://publishers.disqus.com/engage?utm_source='+o(e.lambda(null!=(a=null!=t?t.forum:t)?a.id:a,t))+'&utm_medium=Disqus-Footer" rel="nofollow" target="_blank" class="disqus-footer__link">\n<i aria-hidden="true" class="icon icon-disqus"></i>\n<span class="clip hidden-sm">'+o(n.gettext.call(r,"Add Disqus to your site",{name:"gettext",hash:{},data:s}))+'</span>\n<span class="clip visible-sm hidden-xs">'+o(n.gettext.call(r,"Add Disqus",{name:"gettext",hash:{},data:s}))+'</span>\n<span class="clip visible-xs">'+o(n.gettext.call(r,"Add",{name:"gettext",hash:{},data:s}))+'</span>\n</a>\n</li>\n<li class="privacy disqus-footer__item">\n<a href="https://help.disqus.com/customer/portal/articles/1657951?utm_source=disqus&utm_medium=embed-footer&utm_content=privacy-btn" rel="nofollow" target="_blank" class="disqus-footer__link">\n<i aria-hidden="true" class="icon icon-lock"></i>\n<span class="clip">'+o(n.gettext.call(r,"Privacy",{name:"gettext",hash:{},data:s}))+"</span>\n</a>\n</li>\n</ul>\n</div>\n"},124:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression;return'<li data-role="post-sort" class="nav-tab nav-tab--secondary dropdown sorting pull-right">\n<a href="#" class="dropdown-toggle" data-toggle="dropdown">\n'+(null!=(a=n["if"].call(r,n.eq.call(r,null!=t?t.order:t,"popular",{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(125,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,n.eq.call(r,null!=t?t.order:t,"desc",{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(127,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,n.eq.call(r,null!=t?t.order:t,"asc",{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(129,s,0),inverse:e.noop,data:s}))?a:"")+'\n<span class="caret"></span>\n</a>\n<ul class="dropdown-menu pull-right">\n<li '+(null!=(a=n["if"].call(r,n.eq.call(r,null!=t?t.order:t,"popular",{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(131,s,0),inverse:e.noop,data:s}))?a:"")+'>\n<a href="#" data-action="sort" data-sort="popular">'+o(n.gettext.call(r,"Best",{name:"gettext",hash:{},data:s}))+'<i aria-hidden="true" class="icon-checkmark"></i></a>\n</li>\n\n<li '+(null!=(a=n["if"].call(r,n.eq.call(r,null!=t?t.order:t,"desc",{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(131,s,0),inverse:e.noop,data:s}))?a:"")+'>\n<a href="#" data-action="sort" data-sort="desc">'+o(n.gettext.call(r,"Newest",{name:"gettext",hash:{},data:s}))+'<i aria-hidden="true" class="icon-checkmark"></i></a>\n</li>\n\n<li '+(null!=(a=n["if"].call(r,n.eq.call(r,null!=t?t.order:t,"asc",{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(131,s,0),inverse:e.noop,data:s}))?a:"")+'>\n<a href="#" data-action="sort" data-sort="asc">'+o(n.gettext.call(r,"Oldest",{name:"gettext",hash:{},data:s}))+'<i aria-hidden="true" class="icon-checkmark"></i></a>\n</li>\n</ul>\n</li>\n'},125:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"Sort by Best",{name:"gettext",hash:{},data:s}))},127:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"Sort by Newest",{name:"gettext",hash:{},data:s}))},129:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"Sort by Oldest",{name:"gettext",hash:{},data:s}))},131:function(e,t,n,i,s){return'class="selected"'},133:function(e,t,n,i,s){var a,r=null!=t?t:{};return'<a class="publisher-nav-color">\n<span class="comment-count">\n'+(null!=(a=n["if"].call(r,n.eq.call(r,null!=t?t.count:t,1,{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(106,s,0),inverse:e.program(134,s,0),data:s}))?a:"")+'</span>\n\n<span class="comment-count-placeholder">\n'+e.escapeExpression(n.gettext.call(r,"Comments",{name:"gettext",hash:{},data:s}))+"\n</span>\n</a>\n"},134:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"%(numPosts)s comments",{name:"gettext",hash:{numPosts:null!=t?t.count:t},data:s}))+"\n"},136:function(e,t,n,i,s){var a,r=null!=t?t:{};return'<nav class="nav nav-primary">\n<ul>\n<li class="nav-tab nav-tab--primary tab-conversation active" data-role="post-count">\n'+(null!=(a=n.unless.call(r,null!=t?t.inHome:t,{name:"unless",hash:{},fn:e.program(137,s,0),inverse:e.noop,data:s}))?a:"")+"</li>\n"+(null!=(a=n.unless.call(r,null!=t?t.inHome:t,{name:"unless",hash:{},fn:e.program(140,s,0),inverse:e.noop,data:s}))?a:"")+'<li class="nav-tab nav-tab--primary dropdown user-menu" data-role="logout">\n<!-- rendered dynamically -->\n</li>\n<li class="nav-tab nav-tab--primary notification-menu" data-role="notification-menu">\n<!-- rendered dynamically -->\n</li>\n</ul>\n</nav>\n'},137:function(e,t,n,i,s){var a;return null!=(a=n["with"].call(null!=t?t:{},"count",null!=(a=null!=t?t.thread:t)?a.posts:a,{name:"with",hash:{},fn:e.program(138,s,0),inverse:e.noop,data:s}))?a:""},138:function(e,t,n,i,s){var a;return null!=(a=e.invokePartial(i.postCount,t,{name:"postCount",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:""},140:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression,l=null!=t?t:{};return'<li class="nav-tab nav-tab--primary tab-community">\n<a href="'+o(r(null!=(a=null!=t?t.forum:t)?a.homeUrl:a,t))+'"\nclass="publisher-nav-color"\ndata-action="community-sidebar" data-forum="'+o(r(null!=(a=null!=t?t.forum:t)?a.id:a,t))+'"\nid="community-tab"\n>\n<span class="community-name">\n'+(null!=(a=n["with"].call(l,null!=t?t.forum:t,{name:"with",hash:{},fn:e.program(141,s,0),inverse:e.noop,data:s}))?a:"")+'\n</span>\n\n<strong class="community-name-placeholder">'+o(n.gettext.call(l,"Community",{name:"gettext",hash:{},data:s}))+"</strong>\n</a>\n</li>\n"},141:function(e,t,n,i,s){var a;return null!=(a=e.invokePartial(i.communityForum,t,{name:"communityForum",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:""},143:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression;return'<a href="#" data-action="recommend" title="'+o(n.gettext.call(r,"Recommend this discussion",{name:"gettext",hash:{},data:s}))+'" class="dropdown-toggle '+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.thread:t)?a.userScore:a,{name:"if",hash:{},fn:e.program(144,s,0),inverse:e.noop,data:s}))?a:"")+'">\n<span class="label label-default"><span class="recommend-icon icon-heart-empty"></span> '+o(n.gettext.call(r,"Recommend",{name:"gettext",hash:{},data:s}))+'</span>\n<span class="label label-recommended"><span class="recommend-icon icon-heart"></span> '+o(n.gettext.call(r,"Recommended",{name:"gettext",hash:{},data:s}))+"</span>\n"+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.thread:t)?a.likes:a,{name:"if",hash:{},fn:e.program(146,s,0),inverse:e.noop,data:s}))?a:"")+'</a>\n<ul class="dropdown-menu dropdown-menu--coachmark">\n<li>\n'+(null!=(a=n["if"].call(r,null!=t?t.loggedIn:t,{name:"if",hash:{},fn:e.program(148,s,0),inverse:e.program(150,s,0),data:s}))?a:"")+'<a href="'+o(n.urlfor.call(r,"root",{name:"urlfor",hash:{},data:s}))+'/home/?utm_source=disqus_embed&utm_content=recommend_btn" class="btn btn-primary coachmark__button" target="_blank">\n'+(null!=(a=n["if"].call(r,null!=t?t.loggedIn:t,{name:"if",hash:{},fn:e.program(152,s,0),inverse:e.program(154,s,0),data:s}))?a:"")+"\n</a>\n</li>\n</ul>\n"},144:function(e,t,n,i,s){return"upvoted"},146:function(e,t,n,i,s){var a;return'<span class="label label-count">'+e.escapeExpression(e.lambda(null!=(a=null!=t?t.thread:t)?a.likes:a,t))+"</span>\n"},148:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return'<h2 class="coachmark__heading">'+r(n.gettext.call(a,"Your 1st recommended discussion!",{name:"gettext",hash:{},data:s}))+'</h2>\n<p class="coachmark__description">'+r(n.gettext.call(a,"Recommending means this is a discussion worth sharing. It gets shared to your followers' %(Disqus)s feeds if you log in, and gives the creator kudos!",{name:"gettext",hash:{Disqus:"Disqus"},data:s}))+"</p>\n"},150:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return'<h2 class="coachmark__heading">'+r(n.gettext.call(a,"Discussion Recommended!",{name:"gettext",hash:{},data:s}))+'</h2>\n<p class="coachmark__description">'+r(n.gettext.call(a,"Recommending means this is a discussion worth sharing. It gets shared to your followers' %(Disqus)s feeds, and gives the creator kudos!",{name:"gettext",hash:{Disqus:"Disqus"},data:s}))+"</p>\n"},152:function(e,t,n,i,s){return" "+e.escapeExpression(n.gettext.call(null!=t?t:{},"See Your Feed",{name:"gettext",hash:{},data:s}))+" "},154:function(e,t,n,i,s){return" "+e.escapeExpression(n.gettext.call(null!=t?t:{},"Find More Discussions",{name:"gettext",hash:{},data:s}))+" "},156:function(e,t,n,i,s){var a;return'<div class="nav nav-secondary" data-tracking-area="secondary-nav">\n<ul>\n<li id="recommend-button" class="nav-tab nav-tab--secondary recommend dropdown">\n</li>\n<li id="thread-share-menu" class="nav-tab nav-tab--secondary dropdown share-menu hidden-sm">\n</li>\n'+(null!=(a=n.unless.call(null!=t?t:{},null!=t?t.inHome:t,{name:"unless",hash:{},fn:e.program(157,s,0),inverse:e.noop,data:s}))?a:"")+"</ul>\n</div>\n"},157:function(e,t,n,i,s){var a;return null!=(a=e.invokePartial(i.postSort,t,{name:"postSort",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:""},159:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return'<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="'+r(n.gettext.call(a,"Share",{name:"gettext",hash:{},data:s}))+'">\n<span class="icon-export"></span>\n<span class="label">'+r(n.gettext.call(a,"Share",{name:"gettext",hash:{},data:s}))+'</span>\n</a>\n<ul class="share-menu dropdown-menu">\n<li>\n<div class="share-menu__label">'+r(n.gettext.call(a,"Share this discussion on",{name:"gettext",hash:{},data:s}))+'</div>\n<ul>\n<li class="twitter">\n<a data-action="share:twitter"\nhref="#">Twitter</a>\n</li>\n<li class="facebook">\n<a data-action="share:facebook" href="#">Facebook</a>\n</li>\n</ul>\n</li>\n</ul>\n'},161:function(e,t,n,i,s){return'<a href="'+e.escapeExpression(n.urlfor.call(null!=t?t:{},"homeInbox",{name:"urlfor",hash:{},data:s}))+'" class="notification-container"\ndata-action="home" data-home-path="home/inbox/">\n<span class="notification-icon icon-comment" aria-hidden></span>\n<span class="notification-count" data-role="notification-count"></span>\n</a>\n'},163:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression,l=e.lambda;return'<div class="notice '+(null!=(a=n["if"].call(r,null!=t?t.showHome:t,{name:"if",hash:{},fn:e.program(164,s,0),inverse:e.noop,data:s}))?a:"")+'">\n<div class="notice-wrapper">\n<span class="notice__icon icon icon-disqus"></span>\n<a data-action="show-home"\nhref="'+o(n.urlfor.call(r,"home",{name:"urlfor",hash:{},data:s}))+"explore/?utm_source=embed&utm_medium=onboard_message&utm_content=see_home_msg&forum_id="+o(l(null!=(a=null!=t?t.forum:t)?a.id:a,t))+'"\ntarget="_blank"\nclass="notice__message">\n\n'+o(n.gettext.call(r,"Welcome to %(Disqus)s! Discover more great discussions just like this one. We're a lot more than comments.",{name:"gettext",hash:{Disqus:"Disqus"},data:s}))+'\n</a>\n<a data-action="show-home"\nhref="'+o(n.urlfor.call(r,"home",{name:"urlfor",hash:{},data:s}))+"explore/?utm_source=embed&utm_medium=onboard_message&utm_content=see_home_btn&forum_id="+o(l(null!=(a=null!=t?t.forum:t)?a.id:a,t))+'"\ntarget="_blank"\nclass="btn btn-primary notice__button">\n\n'+o(n.gettext.call(r,"Get Started",{name:"gettext",hash:{},data:s}))+'\n</a>\n</div>\n</div>\n<a class="dismiss" data-action="close" href="#" title=\''+o(n.gettext.call(r,"Dismiss",{name:"gettext",hash:{},data:s}))+'\'>Dismiss <span aria-label="Dismiss" class="cross">×</span></a>\n'},164:function(e,t,n,i,s){return"notice--brand"},166:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression;return'<div role="alert"></div>\n'+(null!=(a=e.invokePartial(i.postWrapperTop,t,{name:"postWrapperTop",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+"\n"+(null!=(a=e.invokePartial(i.postUserAvatar,t,{name:"postUserAvatar",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+'<div class="post-body">\n<header class="comment__header">\n<span class="post-byline">\n'+(null!=(a=n["if"].call(r,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.isRegistered:a,{name:"if",hash:{},fn:e.program(167,s,0),inverse:e.program(175,s,0),data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,null!=t?t.parentPost:t,{name:"if",hash:{},fn:e.program(177,s,0),inverse:e.noop,data:s}))?a:"")+'</span>\n\n<span class="post-meta">\n<span class="bullet time-ago-bullet" aria-hidden="true">•</span>\n\n'+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.post:t)?a.id:a,{name:"if",hash:{},fn:e.program(179,s,0),inverse:e.program(181,s,0),data:s}))?a:"")+"</span>\n\n"+(null!=(a=n["if"].call(r,null!=t?t.stateByline:t,{name:"if",hash:{},fn:e.program(183,s,0),inverse:e.noop,data:s}))?a:"")+'</header>\n\n<div class="post-body-inner">\n<div class="post-message-container" data-role="message-container">\n<div class="publisher-anchor-color" data-role="message-content">\n<div class="post-message '+(null!=(a=n.unless.call(r,null!=(a=null!=t?t.post:t)?a.message:a,{name:"unless",hash:{},fn:e.program(185,s,0),inverse:e.noop,data:s}))?a:"")+'"\ndata-role="message" dir="auto">\n'+(null!=(a=n["if"].call(r,n.eq.call(r,null!=(a=null!=t?t.post:t)?a.message:a,"",{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(187,s,0),inverse:e.program(189,s,0),data:s}))?a:"")+'</div>\n\n<span class="post-media"><ul data-role="post-media-list"></ul></span>\n</div>\n</div>\n<a class="see-more hidden" title="'+o(n.gettext.call(r,"see more",{name:"gettext",hash:{},data:s}))+'" data-action="see-more">'+o(n.gettext.call(r,"see more",{name:"gettext",hash:{},data:s}))+'</a>\n</div>\n\n<footer class="comment__footer">\n'+(null!=(a=e.invokePartial(i.postFooter,t,{name:"postFooter",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+"</footer>\n</div>\n\n"+(null!=(a=e.invokePartial(i.postWrapperBottom,t,{name:"postWrapperBottom",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+"\n"},167:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.lambda,l=e.escapeExpression;return(null!=(a=n.if_all.call(r,null!=t?t.isInHome:t,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.isPowerContributor:a,{name:"if_all",hash:{},fn:e.program(168,s,0),inverse:e.noop,data:s}))?a:"")+'<span class="author publisher-anchor-color"><a href="'+l(o(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.profileUrl:a,t))+'" data-action="profile" data-username="'+l(o(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.username:a,t))+'" data-role="username">'+l(o(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.name:a,t))+"</a></span>\n"+(null!=(a=n["if"].call(r,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.badge:a,{name:"if",hash:{},fn:e.program(170,s,0),inverse:e.program(172,s,0),data:s}))?a:"")},168:function(e,t,n,i,s){return'<a href="#" class="icon__position -inline -allstar" data-toggle="tooltip" data-role="allstar" title="'+e.escapeExpression(n.gettext.call(null!=t?t:{},"All-Star",{name:"gettext",hash:{},data:s}))+'"><span class="icon-allstar allstar__icon"></span></a>'},170:function(e,t,n,i,s){var a;return'<span class="badge" data-type="tracked-badge">'+e.escapeExpression(e.lambda(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.badge:a,t))+"</span>\n"},172:function(e,t,n,i,s){var a;return null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.thread:a)?a.canModerate:a,{name:"if",hash:{},fn:e.program(173,s,0),inverse:e.noop,data:s}))?a:""},173:function(e,t,n,i,s){return'<span class="badge moderator">'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Mod",{name:"gettext",hash:{},data:s}))+"</span>\n"},175:function(e,t,n,i,s){var a;return'<span class="author">'+e.escapeExpression(e.lambda(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.name:a,t))+"</span>\n"},177:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<span><a href="'+o(r(null!=(a=null!=t?t.parentPost:t)?a.permalink:a,t))+'" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> '+o(r(null!=(a=null!=(a=null!=t?t.parentPost:t)?a.author:a)?a.name:a,t))+"</a></span>\n"},179:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<a href="'+o(r(null!=(a=null!=t?t.post:t)?a.permalink:a,t))+'" data-role="relative-time" class="time-ago" title="'+o(r(null!=(a=null!=t?t.post:t)?a.formattedCreatedAt:a,t))+'">\n'+o(r(null!=(a=null!=t?t.post:t)?a.relativeCreatedAt:a,t))+"\n</a>\n"},181:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<span class="time-ago" data-role="relative-time" title="'+o(r(null!=(a=null!=t?t.post:t)?a.formattedCreatedAt:a,t))+'">\n'+o(r(null!=(a=null!=t?t.post:t)?a.relativeCreatedAt:a,t))+"\n</span>\n"},183:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<span class="state-byline state-byline-'+o(r(null!=(a=null!=t?t.stateByline:t)?a.style:a,t))+'">\n<span class="icon-mobile icon-'+o(r(null!=(a=null!=t?t.stateByline:t)?a.icon:a,t))+'" aria-hidden="true"></span>\n<span class="text">\n'+o(r(null!=(a=null!=t?t.stateByline:t)?a.text:a,t))+"\n</span>\n</span>\n"},185:function(e,t,n,i,s){return"loading"},187:function(e,t,n,i,s){return"<p><i>"+e.escapeExpression(n.gettext.call(null!=t?t:{},"This comment has no content.",{name:"gettext",hash:{},data:s}))+"</i></p>\n"},189:function(e,t,n,i,s){var a;return e.escapeExpression(n.html.call(null!=t?t:{},null!=(a=null!=t?t.post:t)?a.message:a,{name:"html",hash:{},data:s}))+"\n"},191:function(e,t,n,i,s){var a,r=null!=t?t:{};return'<div data-role="post-content" class="post-content\n'+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.post:t)?a.isRealtime:a,{name:"if",hash:{},fn:e.program(192,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.if_all.call(r,null!=(a=null!=t?t.session:t)?a.isRegistered:a,n.eq.call(r,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.id:a,null!=(a=null!=t?t.session:t)?a.id:a,{name:"eq",hash:{},data:s}),{name:"if_all",hash:{},fn:e.program(194,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.post:t)?a.isFlaggedByUser:a,{name:"if",hash:{},fn:e.program(196,s,0),inverse:e.noop,data:s}))?a:"")+'\n">\n'+(null!=(a=e.invokePartial(i.postMenu,t,{name:"postMenu",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+'<div class="indicator"></div>\n'},192:function(e,t,n,i,s){return"new"},194:function(e,t,n,i,s){return"authored-by-session-user"},196:function(e,t,n,i,s){return"user-reported"},198:function(e,t,n,i,s){return'<div data-role="blacklist-form"></div>\n<div class="reply-form-container" data-role="reply-form"></div>\n</div>\n\n<ul data-role="children" class="children"/>\n'},200:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.lambda,l=e.escapeExpression;return'<a href="#"\nclass="vote-up '+(null!=(a=n["if"].call(r,n.gt.call(r,null!=(a=null!=t?t.post:t)?a.userScore:a,0,{name:"gt",hash:{},data:s}),{name:"if",hash:{},fn:e.program(144,s,0),inverse:e.noop,data:s}))?a:"")+" count-"+l(o(null!=(a=null!=t?t.post:t)?a.likes:a,t))+'"\ndata-action="upvote"\ntitle="'+(null!=(a=n.unless.call(r,null!=(a=null!=t?t.post:t)?a.likes:a,{name:"unless",hash:{},fn:e.program(201,s,0),inverse:e.noop,data:s}))?a:"")+'">\n\n<span class="updatable count" data-role="likes">'+l(o(null!=(a=null!=t?t.post:t)?a.likes:a,t))+'</span>\n<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>\n</a>\n<span role="button"\nclass="vote-down '+(null!=(a=n["if"].call(r,n.lt.call(r,null!=(a=null!=t?t.post:t)?a.userScore:a,0,{name:"lt",hash:{},data:s}),{name:"if",hash:{},fn:e.program(203,s,0),inverse:e.noop,data:s}))?a:"")+" count-"+l(o(null!=(a=null!=t?t.post:t)?a.dislikes:a,t))+'"\ndata-action="downvote"\ntitle="'+l(n.gettext.call(r,"Vote down",{name:"gettext",hash:{},data:s}))+'">\n\n<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>\n</span>\n'},201:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"Vote up",{name:"gettext",hash:{},data:s}))},203:function(e,t,n,i,s){return"downvoted"},205:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression;return'<ul class="post-menu dropdown" data-role="menu">\n<li class="collapse">\n<a href="#" data-action="collapse" title="'+o(n.gettext.call(r,"Collapse",{name:"gettext",hash:{},data:s}))+'"><span>−</span></a>\n</li>\n<li class="expand">\n<a href="#" data-action="collapse" title="'+o(n.gettext.call(r,"Expand",{name:"gettext",hash:{},data:s}))+'"><span>+</span></a>\n</li>\n\n'+(null!=(a=n.if_all.call(r,null!=(a=null!=t?t.post:t)?a.id:a,n.ne.call(r,null!=(a=null!=t?t.post:t)?a.isMinimized:a,!0,{name:"ne",hash:{},data:s}),n.ne.call(r,null!=(a=null!=t?t.post:t)?a.isDeleted:a,!0,{name:"ne",hash:{},data:s}),n.ne.call(r,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.isBlocked:a,!0,{name:"ne",hash:{},data:s}),{name:"if_all",hash:{},fn:e.program(206,s,0),inverse:e.noop,data:s}))?a:"")+"</ul>\n"},206:function(e,t,n,i,s){var a,r=null!=t?t:{};return'<li class="'+(null!=(a=n["if"].call(r,null!=(a=null!=(a=null!=t?t.session:t)?a.thread:a)?a.canModerate:a,{name:"if",hash:{},fn:e.program(207,s,0),inverse:e.noop,data:s}))?a:"")+'"\nrole="menu">\n'+(null!=(a=n["if"].call(r,null!=(a=null!=(a=null!=t?t.session:t)?a.thread:a)?a.canModerate:a,{name:"if",hash:{},fn:e.program(209,s,0),inverse:e.program(220,s,0),data:s}))?a:"")+"</li>\n"},207:function(e,t,n,i,s){return"moderator-menu-options"},209:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression;return'<a class="dropdown-toggle" data-toggle="dropdown" href="#"><b\nclass="caret moderator-menu-options"></b></a>\n<ul class="dropdown-menu">\n'+(null!=(a=n["if"].call(r,n.ne.call(r,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.id:a,null!=(a=null!=t?t.session:t)?a.id:a,{name:"ne",hash:{},data:s}),{name:"if",hash:{},fn:e.program(210,s,0),inverse:e.noop,data:s}))?a:"")+'<li><a href="#" data-action="spam">'+o(n.gettext.call(r,"Mark as Spam",{name:"gettext",hash:{},data:s}))+'</a></li>\n<li><a href="#" data-action="delete">'+o(n.gettext.call(r,"Delete",{name:"gettext",hash:{},data:s}))+'</a> </li>\n<li><a href="#" data-action="blacklist">'+o(n.gettext.call(r,"Ban User",{name:"gettext",hash:{},data:s}))+'</a> </li>\n<li>\n<a href="'+o(n.urlfor.call(r,"moderate",{name:"urlfor",hash:{},data:s}))+"#/approved/search/id:"+o(e.lambda(null!=(a=null!=t?t.post:t)?a.id:a,t))+'"\ntarget="_blank">'+o(n.gettext.call(r,"Moderate",{name:"gettext",hash:{},data:s}))+'</a>\n</li>\n\n<li class="highlight-toggle">\n<a href="#"\ndata-action="'+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.post:t)?a.isHighlighted:a,{name:"if",hash:{},fn:e.program(212,s,0),inverse:e.program(214,s,0),data:s}))?a:"")+'">\n'+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.post:t)?a.isHighlighted:a,{name:"if",hash:{},fn:e.program(216,s,0),inverse:e.program(218,s,0),data:s}))?a:"")+"</a>\n</li>\n</ul>\n"},210:function(e,t,n,i,s){return'<li><a href="#" data-action="block-user">'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Block User",{name:"gettext",hash:{},data:s}))+"</a></li>\n"},212:function(e,t,n,i,s){return"unhighlight"},214:function(e,t,n,i,s){return"highlight"},216:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"Stop featuring",{name:"gettext",hash:{},data:s}))+"\n"},218:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"Feature this comment",{name:"gettext",hash:{},data:s}))+"\n"},220:function(e,t,n,i,s){var a,r=null!=t?t:{};return null!=(a=n.if_all.call(r,null!=(a=null!=t?t.session:t)?a.isRegistered:a,null!=(a=null!=t?t.post:t)?a.author:a,n.eq.call(r,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.id:a,null!=(a=null!=t?t.session:t)?a.id:a,{name:"eq",hash:{},data:s}),{name:"if_all",hash:{},fn:e.program(221,s,0),inverse:e.program(223,s,0),data:s}))?a:""},221:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return'<a class="dropdown-toggle" data-toggle="dropdown"\nhref="#"><b class="caret"></b></a>\n<ul class="dropdown-menu">\n<li><a href="#" data-action="delete">'+r(n.gettext.call(a,"Delete",{name:"gettext",hash:{},data:s}))+'</a></li>\n<li><a href="#" data-action="flag">'+r(n.gettext.call(a,"Flag as inappropriate",{name:"gettext",hash:{},data:s}))+"</a></li>\n</ul>\n"},223:function(e,t,n,i,s){var a;return null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.session:t)?a.isRegistered:a,{name:"if",hash:{},fn:e.program(224,s,0),inverse:e.program(226,s,0),data:s}))?a:""},224:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return'<a class="dropdown-toggle" data-toggle="dropdown"\nhref="#"><b class="caret"></b></a>\n<ul class="dropdown-menu">\n<li><a href="#" data-action="block-user">'+r(n.gettext.call(a,"Block User",{name:"gettext",hash:{},data:s}))+'</a></li>\n<li><a href="#" data-action="flag">'+r(n.gettext.call(a,"Flag as inappropriate",{name:"gettext",hash:{},data:s}))+"</a></li>\n</ul>\n"},226:function(e,t,n,i,s){return'<a class="dropdown-toggle" href="#" data-action="flag"\ndata-role="flag" title="'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Flag as inappropriate",{name:"gettext",hash:{},data:s}))+'">\n<i aria-hidden="true" class="icon icon-flag"></i>\n</a>\n'},228:function(e,t,n,i,s){var a,r=null!=t?t:{};return'<menu class="comment-footer__menu">\n<li class="voting" data-role="voting">\n'+(null!=(a=e.invokePartial(i.postVotes,t,{name:"postVotes",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+'</li>\n<li class="bullet" aria-hidden="true">•</li>\n\n'+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.post:t)?a.canBeEdited:a,{name:"if",hash:{},fn:e.program(229,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.post:t)?a.canBeRepliedTo:a,{name:"if",hash:{},fn:e.program(231,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.post:t)?a.isSponsored:a,{name:"if",hash:{},fn:e.program(233,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.post:t)?a.canBeShared:a,{name:"if",hash:{},fn:e.program(236,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.unless.call(r,null!=(a=null!=t?t.post:t)?a.isDeleted:a,{name:"unless",hash:{},fn:e.program(238,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.post:t)?a.isSponsored:a,{name:"if",hash:{},fn:e.program(240,s,0),inverse:e.noop,data:s}))?a:"")+"</menu>\n"},229:function(e,t,n,i,s){return'<li class="edit" data-role="edit-link">\n<a href="#" data-action="edit">\n<span class="text">'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Edit",{name:"gettext",hash:{},data:s}))+'</span></a></li>\n<li class="bullet" aria-hidden="true">•</li>\n'},231:function(e,t,n,i,s){return'<li class="reply" data-role="reply-link">\n<a href="#" data-action="reply">\n<span class="text">'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Reply",{
name:"gettext",hash:{},data:s}))+'</span></a></li>\n<li class="bullet" aria-hidden="true">•</li>\n'},233:function(e,t,n,i,s){var a;return null!=(a=n.unless.call(null!=t?t:{},null!=(a=null!=t?t.post:t)?a.hideViewAllComments:a,{name:"unless",hash:{},fn:e.program(234,s,0),inverse:e.noop,data:s}))?a:""},234:function(e,t,n,i,s){var a,r=e.escapeExpression,o=null!=t?t:{};return'<li class="thread-link" data-role="thread-link">\n<a href="'+r(e.lambda(null!=(a=null!=t?t.post:t)?a.permalink:a,t))+'" target="_blank" data-action="thread">\n<i class="icon icon-mobile"></i>\n<span class="text">'+r(n.gettext.call(o,"View all comments",{name:"gettext",hash:{},data:s}))+'</span>\n<span class="mobile-text">'+r(n.gettext.call(o,"All Comments",{name:"gettext",hash:{},data:s}))+'</span>\n</a>\n</li>\n<li class="bullet" aria-hidden="true">•</li>\n'},236:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression;return'<li class="comment__share">\n<a class="toggle"><span class="text">'+o(n.gettext.call(r,"Share",{name:"gettext",hash:{},data:s}))+' ›</span></a>\n<ul class="comment-share__buttons">\n<li class="twitter">\n<button class="share__button" data-action="share:twitter">Twitter</button>\n</li>\n<li class="facebook">\n<button class="share__button" data-action="share:facebook">Facebook</button>\n</li>\n<li class="link">\n<input class="share__button" value="'+o(e.lambda(null!=(a=null!=t?t.post:t)?a.shortLink:a,t))+'" name="'+o(n.gettext.call(r,"Link",{name:"gettext",hash:{},data:s}))+'" title="Click to copy post link" data-action="copy-link" readonly>\n</li>\n</ul>\n</li>\n'},238:function(e,t,n,i,s){var a;return'<li class="realtime" data-role="realtime-notification:'+e.escapeExpression(e.lambda(null!=(a=null!=t?t.post:t)?a.id:a,t))+'">\n<span style="display:none;" class="realtime-replies"></span>\n<a style="display:none;" href="#" class="realtime-button"></a>\n</li>\n'},240:function(e,t,n,i,s){return'<li class="feedback">\n<button data-action="feedback">'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Leave Feedback",{name:"gettext",hash:{},data:s}))+"</button>\n</li>\n"},242:function(e,t,n,i,s){var a,r=null!=t?t:{};return null!=(a=n.if_all.call(r,null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.isRegistered:a,n.ne.call(r,null!=(a=null!=t?t.post:t)?a.isMinimized:a,!0,{name:"ne",hash:{},data:s}),{name:"if_all",hash:{},fn:e.program(243,s,0),inverse:e.program(245,s,0),data:s}))?a:""},243:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<div class="avatar hovercard">\n<a href="'+o(r(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.profileUrl:a,t))+'" class="user"\ndata-action="profile" data-username="'+o(r(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.username:a,t))+'">\n<img data-role="user-avatar" data-user="'+o(r(null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.id:a,t))+'" src="'+o(r(null!=t?t.defaultAvatarUrl:t,t))+'" data-src="'+o(r(null!=(a=null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.avatar:a)?a.cache:a,t))+'"\nalt="'+o(n.gettext.call(null!=t?t:{},"Avatar",{name:"gettext",hash:{},data:s}))+'"/>\n</a>\n</div>\n'},245:function(e,t,n,i,s){var a;return(null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.hasSponsoredAvatar:a,{name:"if",hash:{},fn:e.program(246,s,0),inverse:e.program(248,s,0),data:s}))?a:"")+"\n"},246:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<div class="avatar">\n<div class="user"><img src="'+o(r(null!=t?t.defaultAvatarUrl:t,t))+'"  data-src="'+o(r(null!=(a=null!=(a=null!=(a=null!=t?t.post:t)?a.author:a)?a.avatar:a)?a.cache:a,t))+'"\nclass="user" alt="'+o(n.gettext.call(null!=t?t:{},"Avatar",{name:"gettext",hash:{},data:s}))+'"/></div>\n</div>\n'},248:function(e,t,n,i,s){var a=e.escapeExpression;return'<div class="avatar">\n<div class="user"><img src="'+a(e.lambda(null!=t?t.defaultAvatarUrl:t,t))+'"\nclass="user" alt="'+a(n.gettext.call(null!=t?t:{},"Avatar",{name:"gettext",hash:{},data:s}))+'"/></div>\n</div>\n'},250:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"You've featured a comment! This comment will now also appear at the top of the discussion.",{name:"gettext",hash:{},data:s}))+"\n"},252:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression;return(null!=(a=e.invokePartial(i.postWrapperTop,t,{name:"postWrapperTop",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+'\n<div class="avatar">\n<img data-src="'+o(n.urlfor.call(r,"avatar.generic",{name:"urlfor",hash:{},data:s}))+'" class="user" alt="'+o(n.gettext.call(r,"Avatar",{name:"gettext",hash:{},data:s}))+'" />\n</div>\n<div class="post-body">\n<div class="post-message">\n<p>'+o(n.gettext.call(r,"This user is blocked.",{name:"gettext",hash:{},data:s}))+"</p>\n</div>\n</div>\n\n"+(null!=(a=e.invokePartial(i.postWrapperBottom,t,{name:"postWrapperBottom",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")},254:function(e,t,n,i,s){var a,r=null!=t?t:{},o=e.escapeExpression;return(null!=(a=e.invokePartial(i.postWrapperTop,t,{name:"postWrapperTop",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+'\n<div class="avatar">\n<img data-src="'+o(n.urlfor.call(r,"avatar.generic",{name:"urlfor",hash:{},data:s}))+'" class="user" alt="'+o(n.gettext.call(r,"Avatar",{name:"gettext",hash:{},data:s}))+'" />\n</div>\n<div class="post-body">\n<div class="post-message">\n<p>'+o(n.gettext.call(r,"This comment was deleted.",{name:"gettext",hash:{},data:s}))+"</p>\n</div>\n\n<header>\n"+(null!=(a=e.invokePartial(i.postMenu,t,{name:"postMenu",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+"</header>\n</div>\n\n"+(null!=(a=e.invokePartial(i.postWrapperBottom,t,{name:"postWrapperBottom",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")},256:function(e,t,n,i,s){var a,r=null!=t?t:{};return(null!=(a=e.invokePartial(i.postWrapperTop,t,{name:"postWrapperTop",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+"\n"+(null!=(a=e.invokePartial(i.postUserAvatar,t,{name:"postUserAvatar",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+'<div class="post-body">\n<div class="post-message publisher-anchor-color">\n'+(null!=(a=n.if_any.call(r,null!=t?t.created:t,null!=(a=null!=t?t.post:t)?a.isApproved:a,{name:"if_any",hash:{},fn:e.program(257,s,0),inverse:e.program(262,s,0),data:s}))?a:"")+'</div>\n\n<header>\n<div class="post-meta">\n'+e.escapeExpression(n.gettext.call(r,"This comment is awaiting moderation.",{name:"gettext",hash:{},data:s}))+"\n</div>\n\n"+(null!=(a=e.invokePartial(i.postMenu,t,{name:"postMenu",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+"</header>\n</div>\n\n"+(null!=(a=e.invokePartial(i.postWrapperBottom,t,{name:"postWrapperBottom",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")},257:function(e,t,n,i,s){var a;return null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.post:t)?a.isApproved:a,{name:"if",hash:{},fn:e.program(258,s,0),inverse:e.program(260,s,0),data:s}))?a:""},258:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return"\n<p>"+r(n.gettext.call(a,"Comment score below threshold.",{name:"gettext",hash:{},data:s}))+' <a href="#" data-action="reveal">'+r(n.gettext.call(a,"Show comment.",{name:"gettext",hash:{},data:s}))+"</a></p>\n"},260:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return"\n<p>"+r(n.gettext.call(a,"Your comment is awaiting moderation.",{name:"gettext",hash:{},data:s}))+' <a href="#" data-action="reveal">'+r(n.gettext.call(a,"See your comment.",{name:"gettext",hash:{},data:s}))+'</a>  <a href="https://help.disqus.com/customer/portal/articles/466223" class="help-icon" title="'+r(n.gettext.call(a,"Why?",{name:"gettext",hash:{},data:s}))+'" target="_blank"></a> </p>\n'},262:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return"<p>"+r(n.gettext.call(a,"This comment is awaiting moderation.",{name:"gettext",hash:{},data:s}))+' <a href="#" data-action="reveal">'+r(n.gettext.call(a,"Show comment.",{name:"gettext",hash:{},data:s}))+"</a></p>\n"},264:function(e,t,n,i,s){var a,r=null!=t?t:{};return null!=(a=n["if"].call(r,n.eq.call(r,null!=t?t.comments:t,1,{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(265,s,0),inverse:e.program(267,s,0),data:s}))?a:""},265:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"Show One New Comment",{name:"gettext",hash:{},data:s}))+"\n"},267:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"Show %(comments)s New Comments",{name:"gettext",hash:{comments:null!=t?t.comments:t},data:s}))+"\n"},269:function(e,t,n,i,s){var a,r=null!=t?t:{};return null!=(a=n["if"].call(r,n.eq.call(r,null!=t?t.replies:t,1,{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(270,s,0),inverse:e.program(272,s,0),data:s}))?a:""},270:function(e,t,n,i,s){return'<span class="indicator"></span>'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Show 1 new reply",{name:"gettext",hash:{},data:s}))+"\n"},272:function(e,t,n,i,s){return'<span class="indicator"></span>'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Show %(replies)s new replies",{name:"gettext",hash:{replies:null!=t?t.replies:t},data:s}))+"\n"},274:function(e,t,n,i,s){var a=e.lambda,r=e.escapeExpression;return'<!DOCTYPE html>\n<html lang="'+r(a(null!=t?t.lang:t,t))+'">\n<head>\n<meta charset="utf-8">\n<title>Disqus Realtime Notification</title>\n</head>\n<body>\n<link rel="stylesheet" href="'+r("https://a.disquscdn.com/next/embed/styles/realtime.af77184dec69e96e69aff958ae2bb738.css")+'">\n<div class="'+r(a(null!=t?t.orientation:t,t))+'" id="message">-</div>\n</body>\n</html>\n'},276:function(e,t,n,i,s){var a,r=null!=t?t:{};return null!=(a=n["if"].call(r,n.eq.call(r,null!=t?t.orientation:t,"north",{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(277,s,0),inverse:e.program(282,s,0),data:s}))?a:""},277:function(e,t,n,i,s){var a,r=null!=t?t:{};return null!=(a=n["if"].call(r,n.eq.call(r,null!=t?t.num:t,1,{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(278,s,0),inverse:e.program(280,s,0),data:s}))?a:""},278:function(e,t,n,i,s){return"<p>"+e.escapeExpression(n.gettext.call(null!=t?t:{},"One new comment above.",{name:"gettext",hash:{},data:s}))+"</p>\n"},280:function(e,t,n,i,s){return"<p>"+e.escapeExpression(n.gettext.call(null!=t?t:{},"%(num)s new comments above.",{name:"gettext",hash:{num:null!=t?t.num:t},data:s}))+"</p>\n"},282:function(e,t,n,i,s){var a,r=null!=t?t:{};return null!=(a=n["if"].call(r,n.eq.call(r,null!=t?t.num:t,1,{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(283,s,0),inverse:e.program(285,s,0),data:s}))?a:""},283:function(e,t,n,i,s){return"<p>"+e.escapeExpression(n.gettext.call(null!=t?t:{},"One new comment below.",{name:"gettext",hash:{},data:s}))+"</p>\n"},285:function(e,t,n,i,s){return"<p>"+e.escapeExpression(n.gettext.call(null!=t?t:{},"%(num)s new comments below.",{name:"gettext",hash:{num:null!=t?t.num:t},data:s}))+"</p>\n"},287:function(e,t,n,i,s){return'<ul class="user-mention__list">\n<li class="header user-mention__header">\n<h5>'+e.escapeExpression(n.gettext.call(null!=t?t:{},"in this conversation",{name:"gettext",hash:{},data:s}))+"</h5>\n</li>\n</ul>\n"},289:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression,l=null!=t?t:{};return'<li class="user-mention__item" data-cid="'+o(r(null!=t?t.cid:t,t))+'">\n<img src="'+o(r(null!=(a=null!=t?t.avatar:t)?a.cache:a,t))+'" class="avatar" alt="'+o(n.gettext.call(l,"Avatar",{name:"gettext",hash:{},data:s}))+'">\n<span>'+o(n.any.call(l,null!=t?t.name:t,null!=t?t.username:t,{name:"any",hash:{},data:s}))+"</span>\n</li>\n"},291:function(e,t,n,i,s){var a,r=null!=t?t:{};return'<li class="top-user">\n<div class="avatar">\n'+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.user:t)?a.isRegistered:a,{name:"if",hash:{},fn:e.program(292,s,0),inverse:e.program(294,s,0),data:s}))?a:"")+'</div>\n\n<div class="profile-card-text">\n<h5>\n<span>\n'+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.user:t)?a.isRegistered:a,{name:"if",hash:{},fn:e.program(296,s,0),inverse:e.program(298,s,0),data:s}))?a:"")+'</span>\n</h5>\n\n<span class="post-count">\n'+(null!=(a=n["if"].call(r,n.eq.call(r,null!=(a=null!=t?t.user:t)?a.numPosts:a,1,{name:"eq",hash:{},data:s}),{name:"if",hash:{},fn:e.program(106,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,n.ge.call(r,null!=(a=null!=t?t.user:t)?a.numPosts:a,2,{name:"ge",hash:{},data:s}),{name:"if",hash:{},fn:e.program(108,s,0),inverse:e.noop,data:s}))?a:"")+"</span>\n\n"+(null!=(a=e.invokePartial(i.followButtonSmall,t,{name:"followButtonSmall",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+"\n</div>\n</li>\n"},292:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<a href="#" class="user" data-action="profile" data-username="'+o(r(null!=(a=null!=t?t.user:t)?a.username:a,t))+'">\n<img data-role="user-avatar" data-user="'+o(r(null!=(a=null!=t?t.user:t)?a.id:a,t))+'" data-src="'+o(r(null!=(a=null!=(a=null!=t?t.user:t)?a.avatar:a)?a.cache:a,t))+'" alt="'+o(n.gettext.call(null!=t?t:{},"Avatar",{name:"gettext",hash:{},data:s}))+'"/>\n</a>\n'},294:function(e,t,n,i,s){var a,r=e.escapeExpression;return'<div class="user">\n<img data-src="'+r(e.lambda(null!=(a=null!=(a=null!=t?t.user:t)?a.avatar:a)?a.cache:a,t))+'" class="user" alt="'+r(n.gettext.call(null!=t?t:{},"Avatar",{name:"gettext",hash:{},data:s}))+'"/>\n</div>\n'},296:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression;return'<a href="'+o(r(null!=(a=null!=t?t.user:t)?a.profileUrl:a,t))+'" data-action="profile" data-username="'+o(r(null!=(a=null!=t?t.user:t)?a.username:a,t))+'" data-role="username">\n'+o(n.any.call(null!=t?t:{},null!=(a=null!=t?t.user:t)?a.name:a,null!=(a=null!=t?t.user:t)?a.username:a,{name:"any",hash:{},data:s}))+"</a>\n"},298:function(e,t,n,i,s){var a;return e.escapeExpression(n.any.call(null!=t?t:{},null!=(a=null!=t?t.author:t)?a.name:a,null!=(a=null!=t?t.author:t)?a.username:a,{name:"any",hash:{},data:s}))+"\n"},300:function(e,t,n,i,s){var a,r=null!=t?t:{};return(null!=(a=n["if"].call(r,null!=(a=null!=(a=null!=t?t.user:t)?a.thread:a)?a.canReply:a,{name:"if",hash:{},fn:e.program(301,s,0),inverse:e.noop,data:s}))?a:"")+'<ul class="dropdown-menu">\n'+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.user:t)?a.isRegistered:a,{name:"if",hash:{},fn:e.program(306,s,0),inverse:e.program(309,s,0),data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,null!=(a=null!=(a=null!=t?t.user:t)?a.thread:a)?a.canModerate:a,{name:"if",hash:{},fn:e.program(312,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.user:t)?a.isGlobalAdmin:a,{name:"if",hash:{},fn:e.program(319,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.if_all.call(r,null!=(a=null!=t?t.user:t)?a.isRegistered:a,null!=(a=null!=(a=null!=t?t.user:t)?a.thread:a)?a.canReply:a,{name:"if_all",hash:{},fn:e.program(321,s,0),inverse:e.noop,data:s}))?a:"")+"</ul>\n"},301:function(e,t,n,i,s){var a;return'<a href="#" class="dropdown-toggle" data-toggle="dropdown">\n<span class="dropdown-toggle-wrapper">\n\n'+(null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.user:t)?a.isRegistered:a,{name:"if",hash:{},fn:e.program(302,s,0),inverse:e.program(304,s,0),data:s}))?a:"")+'\n</span> <span class="caret"></span>\n</a>\n'},302:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression,l=null!=t?t:{};return'<span class="avatar">\n<img data-role="user-avatar" data-user="'+o(r(null!=(a=null!=t?t.user:t)?a.id:a,t))+'" data-src="'+o(r(null!=(a=null!=(a=null!=t?t.user:t)?a.avatar:a)?a.cache:a,t))+'" alt="'+o(n.gettext.call(l,"Avatar",{name:"gettext",hash:{},data:s}))+'">\n</span>\n<span class="username" data-role="username" data-username="'+o(r(null!=(a=null!=t?t.user:t)?a.username:a,t))+'">\n'+o(n.any.call(l,null!=(a=null!=t?t.user:t)?a.name:a,null!=(a=null!=t?t.user:t)?a.username:a,{name:"any",hash:{},data:s}))+"\n</span>\n"},304:function(e,t,n,i,s){return"<span>\n"+e.escapeExpression(n.gettext.call(null!=t?t:{},"Login",{name:"gettext",hash:{},data:s}))+"\n</span>\n"},306:function(e,t,n,i,s){var a,r=e.lambda,o=e.escapeExpression,l=null!=t?t:{};return'<li>\n<a href="'+o(r(null!=(a=null!=t?t.user:t)?a.profileUrl:a,t))+'" data-role="user-profile-link" data-action="profile" data-username="'+o(r(null!=(a=null!=t?t.user:t)?a.username:a,t))+'">\n'+o(n.gettext.call(l,"Your Profile",{name:"gettext",hash:{},data:s}))+'\n</a>\n</li>\n<li>\n<a href="#" class="media-toggle-on" data-action="toggle-media">'+o(n.gettext.call(l,"Display Media",{name:"gettext",hash:{},data:s}))+'</a>\n<a href="#" class="media-toggle-off" data-action="toggle-media">'+o(n.gettext.call(l,"Hide Media",{name:"gettext",hash:{},data:s}))+"</a>\n</li>\n"+(null!=(a=n.unless.call(l,null!=(a=null!=t?t.user:t)?a.remote:a,{name:"unless",hash:{},fn:e.program(307,s,0),inverse:e.noop,data:s}))?a:"")},307:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return'<li>\n<a href="'+r(n.urlfor.call(a,"editProfile",{name:"urlfor",hash:{},data:s}))+'">'+r(n.gettext.call(a,"Edit Settings",{name:"gettext",hash:{},data:s}))+"</a>\n</li>\n"},309:function(e,t,n,i,s){var a;return"\n"+(null!=(a=n["if"].call(null!=t?t:{},null!=(a=null!=t?t.sso:t)?a.url:a,{name:"if",hash:{},fn:e.program(310,s,0),inverse:e.noop,data:s}))?a:"")+'\n<li>\n<a href="#" data-action="auth:disqus">Disqus</a>\n</li>\n<li>\n<a href="#" data-action="auth:facebook">Facebook</a>\n</li>\n<li>\n<a href="#" data-action="auth:twitter">Twitter</a>\n</li>\n<li>\n<a href="#" data-action="auth:google">Google</a>\n</li>\n'},310:function(e,t,n,i,s){var a;return'<li class="sso">\n<a href="#" data-action="auth:sso">'+e.escapeExpression(e.lambda(null!=(a=null!=t?t.sso:t)?a.name:a,t))+"</a>\n</li>\n"},312:function(e,t,n,i,s){var a,r=null!=t?t:{};return'<li data-role="toggle-thread">\n<a href="#" data-action="toggle-thread">\n'+(null!=(a=n["if"].call(r,null!=(a=null!=t?t.thread:t)?a.isClosed:a,{name:"if",hash:{},fn:e.program(313,s,0),inverse:e.program(315,s,0),data:s}))?a:"")+"</a>\n</li>\n\n"+(null!=(a=n.unless.call(r,null!=(a=null!=t?t.user:t)?a.isGlobalAdmin:a,{name:"unless",hash:{},fn:e.program(317,s,0),inverse:e.noop,data:s}))?a:"")+"\n"},313:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"Open Thread",{name:"gettext",hash:{},data:s}))+"\n"},315:function(e,t,n,i,s){return e.escapeExpression(n.gettext.call(null!=t?t:{},"Close Thread",{name:"gettext",hash:{},data:s}))+"\n"},317:function(e,t,n,i,s){return'<li>\n<a href="https://help.disqus.com/customer/portal/articles/2538045-commenter-launch-pad">'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Help",{name:"gettext",hash:{},data:s}))+"</a>\n</li>\n"},319:function(e,t,n,i,s){var a=null!=t?t:{},r=e.escapeExpression;return'<li>\n<a href="#" data-action="debug">'+r(n.gettext.call(a,"Debug",{name:"gettext",hash:{},data:s}))+'</a>\n</li>\n\n<li>\n<a href="#" data-action="repair">'+r(n.gettext.call(a,"Repair",{name:"gettext",hash:{},data:s}))+"</a>\n</li>\n"},321:function(e,t,n,i,s){return'<li>\n<a href="#" data-action="logout">'+e.escapeExpression(n.gettext.call(null!=t?t:{},"Logout",{name:"gettext",hash:{},data:s}))+"</a>\n</li>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a,r=null!=t?t:{};return(null!=(a=n.partial.call(r,"followButton",{name:"partial",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"anonDownvoteCard",{name:"partial",hash:{},fn:e.program(11,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"anonUpvoteCard",{name:"partial",hash:{},fn:e.program(13,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"blacklist",{name:"partial",hash:{},fn:e.program(15,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"blacklistErrorMessage",{name:"partial",hash:{},fn:e.program(22,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"communityForum",{name:"partial",hash:{},fn:e.program(24,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"contextCard",{name:"partial",hash:{},fn:e.program(26,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"edit",{name:"partial",hash:{},fn:e.program(37,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"emailVerifyAlert",{name:"partial",hash:{},fn:e.program(39,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"followButtonSmall",{name:"partial",hash:{},fn:e.program(41,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"formUser",{name:"partial",hash:{},fn:e.program(54,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"form",{name:"partial",hash:{},fn:e.program(56,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"loginForm",{name:"partial",hash:{},fn:e.program(68,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"loginButtons",{name:"partial",hash:{},fn:e.program(73,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"guestForm",{name:"partial",hash:{},fn:e.program(83,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"audienceSync",{name:"partial",hash:{},fn:e.program(94,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"highlightedPost",{name:"partial",hash:{},fn:e.program(96,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"hovercard",{name:"partial",hash:{},fn:e.program(98,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"hovercardCounters",{name:"partial",hash:{},fn:e.program(105,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"hovercardActions",{name:"partial",hash:{},fn:e.program(114,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"inthreadAd",{name:"partial",hash:{},fn:e.program(117,s,0),inverse:e.noop,data:s}))?a:"")+"\n\n"+(null!=(a=n.partial.call(r,"layout",{name:"partial",hash:{},fn:e.program(119,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"postSort",{name:"partial",hash:{},fn:e.program(124,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"postCount",{name:"partial",hash:{},fn:e.program(133,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"topNavigation",{name:"partial",hash:{},fn:e.program(136,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"threadVotes",{name:"partial",hash:{},fn:e.program(143,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"secondaryNavigation",{name:"partial",hash:{},fn:e.program(156,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"threadShareMenu",{name:"partial",hash:{},fn:e.program(159,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"notificationMenu",{name:"partial",hash:{},fn:e.program(161,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"onboard",{name:"partial",hash:{},fn:e.program(163,s,0),inverse:e.noop,data:s}))?a:"")+(null!=(a=n.partial.call(r,"post",{name:"partial",hash:{},fn:e.program(166,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"postWrapperTop",{name:"partial",hash:{},fn:e.program(191,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"postWrapperBottom",{name:"partial",hash:{},fn:e.program(198,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"postVotes",{name:"partial",hash:{},fn:e.program(200,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"postMenu",{name:"partial",hash:{},fn:e.program(205,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"postFooter",{name:"partial",hash:{},fn:e.program(228,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"postUserAvatar",{name:"partial",hash:{},fn:e.program(242,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"highlightedSuccessMessage",{name:"partial",hash:{},fn:e.program(250,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"postBlocked",{name:"partial",hash:{},fn:e.program(252,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"postDeleted",{name:"partial",hash:{},fn:e.program(254,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"postMinimized",{name:"partial",hash:{},fn:e.program(256,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"realtimeCommentNotification",{name:"partial",hash:{},fn:e.program(264,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"realtimeReplyNotification",{name:"partial",hash:{},fn:e.program(269,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"realtimeIndicator",{name:"partial",hash:{},fn:e.program(274,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"realtimeIndicatorText",{name:"partial",hash:{},fn:e.program(276,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"suggestions",{name:"partial",hash:{},fn:e.program(287,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"suggestedUser",{name:"partial",hash:{},fn:e.program(289,s,0),inverse:e.noop,data:s}))?a:"")+"\n\n"+(null!=(a=n.partial.call(r,"topUser",{name:"partial",hash:{},fn:e.program(291,s,0),inverse:e.noop,data:s}))?a:"")+"\n"+(null!=(a=n.partial.call(r,"userMenu",{name:"partial",hash:{},fn:e.program(300,s,0),inverse:e.noop,data:s}))?a:"")},usePartial:!0,useData:!0})}),define("common/collections/profile",["core/api","common/models","common/collections"],function(e,t,n){"use strict";var i=n.PaginatedCollection.extend({initialize:function(e,t){this.user=t.user,n.PaginatedCollection.prototype.initialize.apply(this,arguments)},fetch:function(e){return e=e||{},e.data=e.data||{},e.data.user=this.user.id,n.PaginatedCollection.prototype.fetch.call(this,e)}}),s=i.extend({model:t.SyncedUser,url:e.getURL("users/listFollowing"),PER_PAGE:20});return{SessionPaginatedCollection:i,FollowingCollection:s}}),define("lounge/views",["jquery","underscore","backbone","loglevel","stance","moment","core/analytics/identity","core/api","core/UniqueModel","core/mixins/withAlert","core/models/ThreadVote","core/models/Vote","remote/config","common/models","common/utils","core/bus","core/strings","common/urls","core/analytics/jester","common/views/mixins","common/Session","common/templates","common/keys","core/utils","core/utils/isIframed","core/utils/html/toRGBColorString","core/WindowBus","common/outboundlinkhandler","core/mixins/withEmailVerifyLink","shared/urls","lounge/common","lounge/menu-handler","lounge/mixins","lounge/realtime","lounge/ads/ads","lounge/views/posts/PostReplyView","lounge/views/posts/collection","lounge/views/media","lounge/views/onboard-alert","lounge/views/notification-menu","lounge/views/highlighted-post","lounge/views/realtime","lounge/views/posts/UserSuggestionsManager","lounge/views/sidebar","lounge/views/recommend-button","lounge/tracking","templates/lounge","common/main","common/collections/profile"],function(e,t,n,i,s,a,r,o,l,c,u,d,h,p,m,f,g,v,w,b,y,x,_,C,S,k,E,T,P,A,M,N,O,R,U,I,V,D,L,H,F,q,B,j,$,z,G,W){"use strict";var K=window.document,J=g.get,Y=C.preventDefaultHandler,X=new E,Q=n.View.extend({events:{"click [data-action=subscribe]":"subscribe","keydown #thread-subscribe-email":"subscribeKeypress"},initialize:function(e){this.thread=e.thread,this.session=e.session,this.listenTo(this.thread,"change:userSubscription",this.updateStatus),this.updateStatus(),this._boundDocumentClickHandler=t.bind(this._documentClickHandler,this)},updateStatus:function(){this.thread.get("userSubscription")?this.$el.addClass("subscribed"):this.$el.removeClass("subscribed")},subscribe:Y(function(){var e=this.thread.get("userSubscription");this.session.isLoggedOut()&&!e?this.showForm():this.thread.subscribe(!e)}),showForm:function(){var n=this;this._unbindDocumentClickHandler(),t.defer(function(){e(K.body).on("click",n._boundDocumentClickHandler)}),n.$el.addClass("show-form").find("input")[0].focus()},_documentClickHandler:function(e){"thread-subscribe-email"!==e.target.id&&this.hideForm()},_unbindDocumentClickHandler:function(){e(K.body).off("click",this._boundDocumentClickHandler)},hideForm:function(){this._unbindDocumentClickHandler(),this.$el.removeClass("show-form").find("input")[0].blur()},subscribeKeypress:function(e){var t=this.$el.find("input");if(t.removeClass("alert error"),"Esc"===e.key||27===e.keyCode)return void this.hideForm();if("Enter"===e.key||13===e.keyCode){var n=e.target.value;if(!C.validateEmail(n))return void t.addClass("alert error");this.hideForm(),this.thread.subscribe(!0,n)}}}),Z=n.View.extend({topEdgeOffset:function(){return-M.getLounge().getPosition().height},initialize:function(e){this.options=e,this.hasLoaded=null,this.listenToOnce(s(this),"enter",this.loadImage)},loadImage:function(){var e=this;if(!e.hasLoaded){var t=function(t){return function(){e.trigger(t),e.$el.off(".deferredMediaView"),e.relatedPost&&M.getLounge().postsView.onDeferredViewReady(e.relatedPost)}};e.$el.on("load.deferredMediaView",t("load")),e.$el.on("error.deferredMediaView",t("error")),e.$el.attr("src",e.options.url),e.hasLoaded=!0}}}),ee=n.View.extend({tagName:"ul",className:"debug",initialize:function(e){this.values=e},render:function(){return this.$el.html(t.reduce(this.values,function(e,t,n){return e+"<li><strong>"+n+"</strong>: "+t+"</li>"},"")),this}}),te=n.View.extend({initialize:function(e){t.extend(this,e),this.listenTo(this.session,"change:id",this.render),this.listenTo(D.settings,"change:collapsed",this.onMediaCollapseChange)},render:function(){var e=x.render("userMenu",{user:this.session.toJSON(),thread:this.thread.toJSON(),feedbackUrl:this.getSurveyMonkeyUrl(),sso:this.session.get("sso")});return this.$el.html(e),this.onMediaCollapseChange(),this},onMediaCollapseChange:function(){D.settings.get("collapsed")?this.$el.addClass("media-collapsed"):this.$el.removeClass("media-collapsed")},getSurveyMonkeyUrl:function(){var e,t="https://www.surveymonkey.com/s/5RBPTTZ",n=this.referrerUrl,i=this.session.user.id;e=i?[i,n]:[n];var s="?c="+encodeURIComponent(e.join(";"));return t+s}}),ne=n.View.extend({events:{"click [data-action=share\\:twitter]":"_onShare","click [data-action=share\\:facebook]":"_onShare"},_onShare:Y(function(e){var t=m.extractService(e.target,"share");t&&this.sharers[t]&&(M.getLounge().trigger("uiAction:threadShare",t),this.share(t))}),render:function(){return this.$el.html(x.render("threadShareMenu")),this}});t.extend(ne.prototype,O.ShareMixin);var ie=n.View.extend({events:{"click [data-action^=auth\\:]":"handleAuth","click [data-action=logout]":"handleLogout","click [data-action=audiencesync]":"audienceSync","click [data-action=profile]":"handleShowProfile","click [data-action=community-sidebar]":"handleShowCommunitySidebar","click [data-action=sort]":"handleSort","click [data-action=toggle-thread]":"toggleThread","click [data-action=debug]":"renderDebugInfo","click [data-action=repair]":"repairThread","click [data-action=toggle-media]":"toggleMedia","click a":"handleLinkClick"},initialize:function(n){M.setLounge(this),n=n||{};var i=n.jsonData||{};this.language=K.documentElement.lang,this.initialData=i.response||{},this.cleanInitialData(this.initialData),this.onboardWindowName=m.globalUniqueId("disqus_"),this.initialData.forum&&this.initialData.forum.id&&(v.moderate=m.updateURL(v.moderate,{hostname:this.initialData.forum.id+"."})),this.deferredViews=[],this.unsortedDeferredViews=[],this.inthreadAdApps=[],this.adPromise=e.Deferred().resolve(),y.setDefaults(this.initialData.session),this.session=y.get(),this.forum=new p.Forum,this.forum.set(this.initialData.forum),this.thread=new p.Thread(this.initialData.thread,{forum:this.forum,postCursor:i.cursor,moderators:(this.initialData.thread||{}).moderators,order:i.order}),this.initUserSuggestionsManager(),this.postsView=new V.PostCollectionView({posts:this.thread.posts,thread:this.thread,lounge:this,session:this.session,el:this.el,userSuggestions:this.userSuggestions}),this.states={fullyVisible:!1,realtimeIndicatorsCreated:!1,streamingPaused:!1,discoveryLoaded:!1,inViewport:!1},W.timings.loungeStart=e.now();var s=t.bind(this.bootstrap,this);
S(window)?this.listenTo(f.frame,"init",s):t.defer(s),this.setAlertSelector("#layout"),this.initResizeHandler(),this.initAlertListeners()},cleanInitialData:function(e){var n=e.thread&&e.thread.highlightedPost;n&&(n.isHighlighted=!0),t.each(e.posts,function(e){n?e.isHighlighted=e.id===n.id:e.isHighlighted=!1})},initAlertListeners:function(){this.listenTo(this.session,"alert",this.alert)},initOnboardAlert:function(){var e=this.onboardAlert=new L.OnboardAlert({session:this.session,forum:this.forum});this.proxyViewEvents(this.onboardAlert),this.listenTo(this.session,"change:id",function(){e.setInitialCookie(),e.render().$el.appendTo("#onboard")})},bootstrap:function(n){var i,s=this,a={};s.config=n=n||m.getConfigFromHash(window),s.states.fullyVisible=n.startedFullyVisible,n.discovery||(n.discovery={}),n.experiment||(n.experiment={}),n.apiKey&&(a["X-Disqus-Publisher-API-Key"]=n.apiKey),t.isObject(n.remoteAuthS3)&&t.isEmpty(n.remoteAuthS3)?n.remoteAuthS3=null:a["X-Disqus-Remote-Auth"]=n.remoteAuthS3,t.isEmpty(a)||o.headers(a),n.anchorColor&&(i=k(n.anchorColor),m.addStylesheetRules([[".publisher-anchor-color a",["color",i,!0]],["a.publisher-anchor-color",["color",i,!0]],[".publisher-anchor-hover a:hover",["color",i,!0]],["a.publisher-anchor-hover:hover",["color",i,!0]],[".active .publisher-nav-color:after",["background",i,!0]],[".media-preview .active.publisher-border-color",["border-color",i,!0]],[".publisher-color",["color",i,!1]],[".publisher-color:hover",["color",i,!1]],[".publisher-background-color",["background-color",i,!1]],[".publisher-border-color",["border-color",i,!1]]])),n.impressionId&&r.impression.setImpressionId(n.impressionId),m.injectBaseElement(),n.referrer&&(s.thread.currentUrl=n.referrer),!this.config.inthreadLeadingCommentCount&&this.config.inthreadShowAfterComment?(this.config.inthreadMultipleAds=!1,this.config.inthreadLeadingCommentCount=Number(this.config.inthreadShowAfterComment),this.config.inthreadRepeatCommentCount=Number.MAX_VALUE,this.config.inthreadTrailingCommentCount=Number(this.config.inthreadMinimumCommentCount)-Number(this.config.inthreadShowAfterComment)):this.config.inthreadLeadingCommentCount&&(this.config.inthreadLeadingCommentCount=Number(this.config.inthreadLeadingCommentCount),this.config.inthreadRepeatCommentCount=Number(this.config.inthreadRepeatCommentCount),this.config.inthreadTrailingCommentCount=Number(this.config.inthreadTrailingCommentCount));var l=this.getPermalinkOptions(n.parentWindowHash);l&&f.frame.once("embed.rendered",t.bind(s.scrollToPost,s,l.postId,l.options)),n.sso&&s.session.set("sso",n.sso),n.initialPosition?s.position=n.initialPosition:s.position=m.calculatePositionFullscreen(),s.initLinkAffiliation(),s.updateModeratorText(),s.initUI(),s.bindBusListeners(),s.initHighlightedPost(),s.loadDiscovery();var c=W.timings;c.hostStart=n.timestamp||c.initStart,c.embedLoadTime=n.embedLoadTime,s.listenToOnce(s.postsView,"render:start",function(){c.renderStart=e.now()}),s.listenToOnce(s.postsView,"render:end",s.sendTelemetry),c.bootstrapStart=e.now(),s.postsView.bootstrap(s.initialData,l),s.initAfterPostCreateHandler(),s.initSession(),s.initLinkHandler(),s.initialized=!0,s.trigger("bootstrap:complete",s)},_isInHome:function(e,t){var n=/^(?:https?:)?\/\/(?:www.)?/;return e=e.replace(n,""),t=t.replace(n,""),0===e.indexOf(t)},isInHome:function(){var e=this.config.referrer;if(e)return this._isInHome(e,A.apps.home+"home/")},initSession:function(){var e=this.config,t=this.session,n=this.thread;t.start({remoteAuthS3:e.remoteAuthS3,sso:e.sso,apiKey:e.apiKey,thread:n})},initLinkAffiliation:function(){this.isLinkAffiliatorEnabled()&&!this.initLinkAffiliatorCalled&&(this.initLinkAffiliatorCalled=!0,f.frame.sendHostMessage("viglink:init",{clientUrl:v.linkAffiliatorClient,apiUrl:v.linkAffiliatorAPI,key:_.viglinkAPI,id:this.forum.get("pk")}))},initAfterPostCreateHandler:function(){this.listenTo(this.thread,"create",function(e){var n=e.toJSON();f.frame.sendHostMessage("posts.create",n),X.broadcast("posts.create",t.pick(n,"forum","parent","id"))})},sendTelemetry:function(){if(m.shouldSample(h.lounge.telemetry_sample_percent)){var n=e.now(),i=W.timings,s={embed:i.embedLoadTime,frame:i.initStart-i.hostStart,asset:i.downloadEnd-i.initStart,render:n-i.renderStart,total:n-i.hostStart-(i.renderStart-i.bootstrapStart)},a=window.performance;if(a){var r=a.timing;r.responseStart&&(s.frame_rtt=r.responseStart-r.navigationStart);var o=t.find(a.getEntries&&a.getEntries()||[],function(e){return e.name.indexOf("/next/config.js")>-1});o&&o.responseStart&&(s.config_rtt=o.responseStart-o.startTime)}var l="lounge_"+("static"===this.config.experiment.service?"static":"dynamic");return w.telemetry(l,s)}},initUI:function(){this.applyPublisherClasses(),G(),this.renderLayout(),this.setAlertSelector("#global-alert"),this.bindUIUpdateHandlers(),this.initDeferredViews(),this.postsView.once("render:end",function(){var e=m.getPageHeight();f.frame.sendHostMessage("rendered",{height:e}),this._lastHeight=e,this.initRealtime()},this),t.defer(t.bind(this.initUIComponents,this))},initUIComponents:function(){this.initMainPostBox(),this.updatePostCount(),this.isInHome()||(this.initUserMenu(),this.initOnboardAlert(),this.initNotificationMenu(),this.initRecommendButton(),this.initThreadShareMenu()),this.initThreadSubscribe(),this.bindProfileUIListeners(this.session)},initHighlightedPost:function(){var t=this.thread.get("highlightedPost");t&&this.thread.posts.add(t),this.highlightedPostView=new F.HighlightedPostView({el:e("#highlighted-post"),thread:this.thread,session:this.session,userSuggestions:this.userSuggestions}),this.highlightedPostView.reset()},bindUIUpdateHandlers:function(){var e=this,t=e.thread,n=e.session;e.listenTo(t,{"change:posts":e.updatePostCount}),e.listenTo(t.queue,"add reset",e.toggleRealtimeNotifications),e.postsView.bindUIUpdateHandlers(),e.listenTo(n,"change:id",e.updateThreadSessionData),e.listenTo(e,"scrollOffViewport",function(){this.states.realtimeIndicatorsCreated&&f.frame.sendHostMessage("indicator:hide")}),e.listenTo(e,"scroll",function(e){this.position=e}),e.listenTo(e,"scroll",e.handleRealtimeScroll),e.listenTo(e.postsView,"render:end",function(){e.toggleRealtimeNotifications(),e.config.inthreadPlacementUrl&&e.loadInthreadAd()})},whenFullyVisible:function(){var t=e.Deferred();return this.states.fullyVisible?t.resolve():this.listenTo(this,"frame.visible",function(){t.resolve()}),t.promise()},canShowInthreadAd:function(e,t){if(!this.config.inthreadMultipleAds&&e>0)return!1;var n=this.config.inthreadLeadingCommentCount+this.config.inthreadRepeatCommentCount*e,i=n+this.config.inthreadTrailingCommentCount;return t>=i},inthreadAdInit:function(t,n){var i=e.Deferred();return this.inthreadAdApps[t].init(),this.listenToOnce(this.inthreadAdApps[t],"frame:ready",function(){n.css("height","auto"),i.resolve()}),i.promise()},loadInthreadAd:function(){var n=this.postsView.$el.find("#post-list");if(!n.hasClass("loading"))for(var i=this.config.inthreadCountChildren?n.find(".post:not(.advertisement)"):n.children(":not(.advertisement)"),s=this.inthreadAdApps.length;this.canShowInthreadAd(s,i.length);s++){var a=this.config.inthreadLeadingCommentCount+this.config.inthreadRepeatCommentCount*s,r=e(x.render("inthreadAd"));r.insertBefore(i[a]),this.inthreadAdApps[s]=U.Ads(t.extend({adUrl:this.config.inthreadPlacementUrl,placement:"inthread",container:r.find("[data-role=post-content]")[0],isInHome:this.isInHome(),forumId:this.forum.get("pk"),version:this.config.version},this.config));var o=this.inthreadAdInit.bind(this,s,r);0===s?this.adPromise=this.whenFullyVisible().then(o):this.adPromise=this.adPromise.then(o)}},relayScrollToStance:function(e){s.scroll({top:e.pageOffset-e.frameOffset.top,height:e.height})},initDeferredViews:function(){this.listenTo(this,"scroll",this.createDeferredViewsForImages),this.listenTo(this,"domReflow",function(){s.invalidate(),this.position&&(this.createDeferredViewsForImages(),this.relayScrollToStance(this.position))})},bindBusListeners:function(){this.listenTo(f.frame,{"window.hashchange":function(e){var t=this.getPermalinkOptions(e);t&&this.scrollToPost(t.postId,t.options)},"window.scroll":function(e){this.trigger("scroll",e),this.relayScrollToStance(e)},"window.inViewport":function(){this.states.inViewport=!0,this.trigger("inViewport")},"window.scrollOffViewport":function(){this.states.inViewport=!1,this.trigger("scrollOffViewport")},"frame.visible":function(){this.states.fullyVisible=!0,this.trigger("frame.visible")},"window.resize":this.resize,"indicator:click":this.handleRealtimeClick}),this.listenToOnce(this.session,"change:id",this.initSidebar)},isLinkAffiliatorEnabled:function(){return this.forum.get("settings").linkAffiliationEnabled&&!this.isInHome()},initLinkHandler:function(){this.outboundLinkHandler=new T,this.outboundLinkHandler.registerBeforeNavigationHandler(this.logLinkClick,this)},handleLinkClick:function(e){this.outboundLinkHandler.handleClick(e)},initRealtimeIndicators:function(){var e=this;if(!e.states.realtimeIndicatorsCreated){var t=["north","south"].reduce(function(t,n){return t[n]={contents:x.render("realtimeIndicator",{lang:e.language,orientation:n})},t},{});f.frame.sendHostMessage("indicator:init",t),e.states.realtimeIndicatorsCreated=!0}},insertStreamingComments:t.throttle(function(){var e=this.thread.queue;e.drain(),t.each(e.counters.replies,function(t,n){e.drain(n)})},1e3),updateModeratorText:function(){var e=this.forum.get("settings");e.moderatorText&&(g.translations.Mod=e.moderatorText)},logLinkClick:function(t){var n=e(t.currentTarget);if(C.clickShouldBeLogged(t,n))return w.client.emit({verb:"click",object_type:"link",object_id:n[0].href,area:z.getEventTrackingArea(t)})},handleRealtimeScroll:function(e){if(this.states.inViewport&&this.states.realtimeIndicatorsCreated){var n=t.union([this.queueView],t.values(this.postsView.subViews)),i=0,s=0;t.each(n,function(t){if(t&&!t.getDirection&&(t=t.queueView),t&&!(t.options.count<=0)){var n=t.getDirection(e);1===n?i+=t.options.count:-1===n&&(s+=t.options.count)}});var a,r;r={type:"north"},i>0?(a="indicator:show",r.content=x.render("realtimeIndicatorText",{num:i,orientation:"north"})):a="indicator:hide",f.frame.sendHostMessage(a,r),r={type:"south"},s>0?(r.content=x.render("realtimeIndicatorText",{num:s,orientation:"south"}),a="indicator:show"):a="indicator:hide",f.frame.sendHostMessage(a,r)}},handleRealtimeClick:function(e){var n=this;f.frame.sendHostMessage("indicator:hide",{type:e});var i,s,a,r=t.union([n],t.toArray(n.postsView.subViews));r=t.filter(r,function(t){if(t=t.queueView,!t||t.options.count<=0)return!1;var i="north"===e?1:-1;return t.getDirection(n.position)===i}),r=t.sortBy(r,function(e){return e===n?0:e.offset.top}),i="north"===e?t.last(r):t.first(r),s=i.queueView,i===n?(a=0,s.handleDrain()):(a=i.offset.top-100,s.handleDrain()),M.getLounge().once("domReflow",t.bind(f.frame.sendHostMessage,f.frame,"scrollTo",{top:a}))},toggleRealtimeNotifications:function(){var n=this,i=n.thread.queue;if(t.defer(function(){f.frame.sendHostMessage("fakeScroll")}),!i.length)return void e("[data-role=realtime-notification]").hide();if(n.thread.get("hasStreaming"))return void n.insertStreamingComments();if(i.counters.comments){var s=n.queueView||new q.QueuedPostView({model:n.thread,el:n.$el.find("button[data-role=realtime-notification]")});n.queueView=s,s.setCount(i.counters.comments),s.render()}t.each(i.counters.replies,function(e,t){var i=n.thread.posts.get(t);if(i){var s=n.postsView.getPostView(i.cid);if(s){var a=s.queueView;a||(a=new q.QueuedReplyView({thread:n.thread,postView:s,model:i,el:s.$el.find("[data-role=realtime-notification\\:"+t+"] a")}),s.queueView=a),a.setCount(e),a.render()}}})},renderDebugInfo:Y(function(){if(this.session.user.get("isGlobalAdmin")){var e=this.thread.forum.get("settings",{}),t=new ee({Shortname:this.thread.get("forum"),"Thread ID":this.thread.get("id"),"Thread slug":this.thread.get("slug"),"Anchor color":k(this.config.anchorColor),Language:this.thread.forum.get("language"),"Ads enabled":e.adsEnabled,"Ads top enabled":e.adsPositionTopEnabled,"Ads bottom enabled":e.adsPositionBottomEnabled,"Ads in-thread enabled":e.adsPositionInthreadEnabled,"In iframe":this.config.isHostIframed,"Behind click":this.config.isBehindClick,"Height restricted":this.config.isHeightRestricted});t.render();var n=K.body;n.insertBefore(t.el,n.firstChild)}}),repairThread:Y(function(){this.session.user.get("isGlobalAdmin")&&o.call("internal/threads/repair.json",{method:"GET",data:{thread:this.thread.get("id")},success:t.bind(this.alert,this,"Thread repair has been queued. Refresh in a few seconds."),error:t.bind(this.alert,this,"An error occurred while repairing thread. Please try again.",{type:"error"})})}),getPermalinkOptions:function(e){var t=e&&e.match(/(comment|reply|edit)\-([0-9]+)/);if(t)return{postId:t[2],options:{highlight:!0,openReply:"reply"===t[1],openEdit:"edit"===t[1]}}},scrollToPost:function(e,n){n=n||{},n.padding=n.padding||90;var i=this,s=i.$el.find("#post-"+e);return s.length?(n.highlight&&(i.$el.find(".post-content.target").removeClass("target"),s.find(".post-content").first().addClass("target")),n.openReply&&i.postsView.openReply(e),n.openEdit&&i.postsView.openEdit(e),void f.frame.sendHostMessage("scrollTo",{top:s.offset().top-n.padding,force:n.force||null})):void p.Post.fetchContext(e,i.thread,{requestedByPermalink:!0}).done(function(){f.frame.once("embed.resized",t.bind(i.scrollToPost,i,e,n))})},updateThreadSessionData:function(e){if(e){e.get("thread")&&this.thread.set(e.get("thread"));var n=e.get("votes");n&&"object"==typeof n&&t.each(n,function(e,t){var n=this.postsView.posts.get(t);n&&n.set("userScore",e)},this)}},initSidebar:function(){this.sidebar=new j({session:this.session,forum:this.forum})},initNotificationMenu:function(){var e=this.notificationMenu=new H.NotificationMenuView({el:this.$el.find("[data-role=notification-menu]")[0],session:this.session,forum:this.forum});e.render()},initUserMenu:function(){var e=this.userMenu=new te({el:this.$el.find("[data-role=logout]")[0],session:this.session,thread:this.thread,referrerUrl:this.config.referrer});e.render()},initThreadShareMenu:function(){var t=this.threadShareMenu=new ne({el:e("#thread-share-menu")[0],model:this.thread});t.render()},loadDiscovery:function(){var e=this;e.config.discoveryDisabled||(!e.config.discovery||!e.config.discovery.disable_all||e.forum.get("settings").discoveryLocked&&!e.isInHome())&&e.forum.get("settings").organicDiscoveryEnabled&&(e.states.discoveryLoaded||(e.states.discoveryLoaded=!0,W.loadCss("rtl"===K.documentElement.dir?"https://a.disquscdn.com/next/embed/styles/discovery_rtl.6f57ebca1d85ff1f9033753e1067f97d.css":"https://a.disquscdn.com/next/embed/styles/discovery.ec9371c4ef39ecee074c2acf24d5e0e2.css"),require(["discovery/main"],function(t){e.initDiscovery(t)},function(){w.logStat("lounge.discovery.module_load_fail")})))},initDiscovery:function(e){var t=this.config.experiment||{},n=e.init(this.thread,{experiment:t.experiment,variant:t.variant,service:t.service});return n?n:void i.debug("Discovery seems not enabled. Check switches or forum settings.")},isRealtimeEnabled:function(){var e=h.lounge.REALTIME||{},t=e.THREAD_STALE_DAYS||7,n=a.unix(this.initialData.lastModified);return!this.thread.get("isClosed")&&a().diff(n,"days")<=t},realtimeHandlers:{Post:function(e){var t=e.data,n=this.thread;if(!this.thread.get("hasStreaming")||!this.states.streamingPaused){if(!t.id)return void i.warn("RT: no post ID");if(!t.author||!t.author.id)return void i.warn("RT: no author or author ID");if(!t.author.name)return void i.warn("RT: no author name or email hash");if(!t.post||!t.post.message)return void i.warn("RT: no post message");if(n.posts.get(t.id)||n.queue.get(t.id))return void i.info("RT: duplicate: ",t.id);if("approved"!==t.type)return void i.info("RT: unnaproved: ",t.id);if(t.type===t.type_prev)return void i.info("RT: Post change message, ignoring for now ",t.id);this.thread.incrementPostCount(1);var s=t.post.parent_post.id;if("0"===s&&(s=null),s&&!n.posts.get(s)&&!n.queue.get(s))return void i.info("RT: parent is not on this page: ",t.id);var a=t.author.name,r=t.author.avatar,o=t.author.id;"0"===o&&(o=void 0);var c=new l(p.User,{id:o,name:a,profileUrl:v.root+"/by/"+a+"/",isAnonymous:!o,avatar:{cache:r,permalink:r}});if(c.get("isBlocked"))return void i.info("RT: blocked: ",t.id);n.users.add(c,{merge:!0}),n.queue.add({id:t.id,user:c,parentId:s,message:t.post.message,createdAt:t.date,media:t.post.media})}},Vote:function(e){var t=e.data;if(t.id&&t.vote){var n=this.thread,s=n.posts.get(t.vote.recipient_post_id);if(s){i.debug("RT: Vote for post ",s.id);var a=s.votes.get(t.id);a||(i.debug("RT: Creating new vote with id ",t.id),a=new d({id:t.id}),s.votes.add(a));var r=s._vote(t.vote.vote,a.get("score"),t.voter);0!==r&&a.set("score",r)}}},ThreadVote:function(e){var t=e.data,n=this.thread;if(t.id&&t.vote&&(!this.session.user.id||t.vote.voter_id!==this.session.user.id)){var i=n.votes.get(t.id);if(i||(i=new u({id:t.id}),n.votes.add(i)),!i.get("currentUser")){var s=n._vote(t.vote.vote,i.get("score"));0!==s&&i.set("score",s)}}},typing:function(e){var n=e.data,i=this.thread,s=n.typing,a=n.post;if(n.thread===i.id&&a){var r=i.posts.get(a);r&&(r.usersTyping.count()<=0&&!s||r.usersTyping.add(p.TypingUser.make(t.extend({client_context:e.lastEventId},n))))}}},initRealtime:function(){var e=R.Manager;if(!e.pipe&&this.isRealtimeEnabled()){this.initRealtimeIndicators(),e.initialize("thread/"+this.thread.id,this.realtimeHandlers,this);var t=function(e){return"POST"===e.method},n=0;this.listenTo(o,"call",function(i){t(i)&&(n+=1,e.pause())}),this.listenTo(o,"complete",function(i){t(i)&&(0>=n||(n-=1,n||e.resume()))})}},initRecommendButton:function(){this.recommendButton&&this.recommendButton.remove();var n=this.recommendButton=new $({thread:this.thread,session:this.session});this.listenTo(n,{"vote:like":t.bind(this.trigger,this,"uiAction:threadLike"),"vote:unlike":t.bind(this.trigger,this,"uiAction:threadUnlike")}),n.render(),e("#recommend-button").append(n.el)},initThreadSubscribe:function(){this.threadSubscribeButton=new Q({session:this.session,thread:this.thread,el:e("#thread-subscribe-button")[0]})},updatePostCount:function(){var e=this.thread.get("posts");this.isInHome()||(this.$postCountContainer=this.$postCountContainer||this.$("li[data-role=post-count]"),this.$postCountContainer.html(x.render("postCount",{count:e}))),f.frame.sendHostMessage("posts.count",e)},renderLayout:function(){this.addFeatureDetectionClasses(),N.init();var t=this.isInHome(),n=this.config.experiment,i=e(x.render("layout",{thread:this.thread.toJSON(),forum:this.forum.toJSON(),order:this.thread.posts.getOrder(),inHome:t,hideFooter:t||n&&"adsapart"===n.experiment&&"force_gamma_nofooter"===n.variant}));i.appendTo(this.$el),this.postsView.renderLayout(),h.readonly&&this.alert(J("The Disqus comment system is temporarily in maintenance mode. You can still read comments during this time, however posting comments and other actions are temporarily delayed."),{type:"info"})},addFeatureDetectionClasses:function(){var t=e(K.documentElement);(this.config.forceMobile||C.isMobileUserAgent())&&t.addClass("mobile"),C.isMobileUserAgent()||t.addClass("use-opacity-transitions")},initMainPostBox:function(){if(this.dismissAlert(),this.form&&(this.form.remove(),this.form=null),this.thread.get("isClosed"))return void this.alert(J("Comments for this thread are now closed."));if(!this.session.get("canReply"))return void this.session.once("change:id",this.initMainPostBox,this);var t=this.form=new I({thread:this.thread,userSuggestions:this.userSuggestions,session:this.session});t.render(),e("#form").prepend(t.$el),t.resize()},initUserSuggestionsManager:function(){this.userSuggestions=new B,this.userSuggestions.addRemote(this.thread.users),this.listenTo(this.session,"change:id",function(){this.session.isLoggedIn()&&(this.session.user.getFollowing(),this.session.user.following.PER_PAGE=100,this.userSuggestions.addRemote(this.session.user.following))})},handleShowProfile:function(t){if(!C.willOpenNewWindow(t)){t.preventDefault();var n=e(t.currentTarget).attr("data-username");this.isInHome()?f.frame.sendHostMessage("home.open",A.apps.home+"by/"+n+"/"):this.showProfileSidebar(n)}},handleShowCommunitySidebar:function(t){if(!C.willOpenNewWindow(t)){t.preventDefault();var n=e(t.currentTarget).attr("data-forum");f.trigger("sidebar:open","home/forums/"+n+"/")}},handleSort:Y(function(t){var n=e(t.currentTarget).attr("data-sort");this.$el.find('[data-role="post-sort"]').replaceWith(x.render("postSort",{order:n})),this.thread.posts.setOrder(n),this.thread.posts.fetch({reset:!0}),f.frame.sendHostMessage("change:sort",n),this.postsView.handleSort()}),toggleThread:Y(function(){var e=this.thread.get("isClosed"),n=J(e?"An error occurred while opening the thread. Please try again.":"An error occurred while closing the thread. Please try again."),i={success:function(){window.location.reload(!0)},error:t.bind(this.alert,this,n,{type:"error"})};e?this.thread.open(i):this.thread.close(i)}),createDeferredViewsForImages:function(){e("img[data-src]").each(function(t,n){var i=e(n),s=new Z({el:n,url:i.attr("data-src")});s.relatedPost=i.attr("data-post"),i.removeAttr("data-src")})},getPosition:function(){return this.position},showProfileSidebar:function(e){f.trigger("sidebar:open","by/"+e+"/")},initResizeHandler:function(){var e,t=this;if(window.MutationObserver)new window.MutationObserver(function(){e||(e=window.requestAnimationFrame(function(){e=null,t.resize()}))}).observe(K.body,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["class","style"]});else{var n=function i(){t.resize(),window.requestAnimationFrame(i)};window.requestAnimationFrame(n)}},resize:function(){var e=m.getPageHeight();this._lastHeight!==e&&(this._lastHeight=e,this.trigger("domReflow"),f.frame.sendHostMessage("resize",{height:e}))},handleAuth:Y(function(e){this.session.authenticate(m.extractService(e.target,"auth"))}),handleLogout:Y(function(){this.session.logout()}),audienceSync:Y(function(){this.session.audienceSync()}),toggleMedia:Y(function(){var e=D.settings,t=!e.get("collapsed");e.set("collapsed",t)})});return t.extend(ie.prototype,O.ShareMixin),c.call(ie.prototype),m.mixin(ie,b.UiActionEventProxy),b.appliesPublisherClasses.call(ie.prototype),m.mixin(ie,b.ProfileHtmlHelpers),P.call(ie.prototype),{Lounge:ie,UserMenuView:te,ThreadSubscribeButton:Q,DeferredMediaView:Z,DebugInfoView:ee}}),define("lounge/main",["jquery","core/utils/getEmbeddedData","lounge/tracking","lounge/views"],function(e,t,n,i){"use strict";return{init:function(){var s=t("threadData");if(!s)return{code:"no_thread_data"};if(s.code)return 2===s.code?"Endpoint resource not valid."===s.response&&(s.code="invalid_endpoint_resource"):15===s.code&&"Thread creations from embed disabled."===s.response&&(s.code="thread_creations_disabled"),s;e.extend(s.response,t("forumData")),e("#postCompatContainer").remove();var a=new i.Lounge({jsonData:s,el:window.document.body});n.init(a)}}}),define("lounge.bundle",function(){});
//# sourceMappingURL=maps/lounge_002.js.map
